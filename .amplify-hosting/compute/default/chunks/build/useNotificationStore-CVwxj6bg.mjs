import{useSSRContext as t,defineComponent as a,computed as i,mergeProps as n,createSlots as e,withCtx as o,createTextVNode as s,toDisplayString as r,createVNode as c}from"vue";import{ssrRenderComponent as d,ssrInterpolate as l}from"vue/server-renderer";import{u as f}from"./useDateFormatter-W2Hui1rv.mjs";import{V as u,a as m,b as p}from"./VListItem-jTLuICGb.mjs";import{V as h}from"./VAvatar-JL8WKjry.mjs";import{d as _,u as g,V as v,_ as y}from"./server.mjs";import{a as w}from"./VChip-f_o2BAA4.mjs";const x=a({__name:"NotificationItem",__ssrInlineRender:!0,props:{notification:{}},emits:["read","action"],setup(t,{emit:a}){const _=t,g=a,{formatRelativeDate:y}=f(),x=i((()=>y(_.notification.created_at))),N=i((()=>({transfer:"primary",payment:"secondary",deposit:"success",withdrawal:"warning",refund:"error"}[_.notification.data.type]||"grey"))),$=i((()=>({transfer:"mdi-bank-transfer",payment:"mdi-credit-card",deposit:"mdi-bank-transfer-in",withdrawal:"mdi-bank-transfer-out",refund:"mdi-cash-refund"}[_.notification.data.type]||"mdi-bell"))),b=i((()=>({completed:"success",pending:"warning",failed:"error",reversed:"error"}[_.notification.data.status]||"grey"))),markAsRead=()=>{_.notification.is_read||g("read",_.notification.id)};return(t,a,i,f)=>{a(d(u,n({class:[{unread:!t.notification.is_read},"notification-item"],onClick:markAsRead},f),e({prepend:o(((t,a,i,n)=>{if(!a)return[c(h,{color:N.value,size:"40"},{default:o((()=>[c(v,null,{default:o((()=>[s(r($.value),1)])),_:1})])),_:1},8,["color"])];a(d(h,{color:N.value,size:"40"},{default:o(((t,a,i,n)=>{if(!a)return[c(v,null,{default:o((()=>[s(r($.value),1)])),_:1})];a(d(v,null,{default:o(((t,a,i,n)=>{if(!a)return[s(r($.value),1)];a(`${l($.value)}`)})),_:1},i,n))})),_:1},i,n))})),default:o(((a,i,n,e)=>{if(!i)return[c(m,{class:"text-subtitle-1 mb-1"},{default:o((()=>[s(r(t.notification.data.title),1)])),_:1}),c(p,null,{default:o((()=>[s(r(t.notification.data.message),1)])),_:1}),c(p,{class:"d-flex align-center mt-1"},{default:o((()=>[c(w,{size:"x-small",color:b.value,class:"me-2"},{default:o((()=>[s(r(t.notification.data.status),1)])),_:1},8,["color"]),c("span",{class:"text-caption text-grey"},r(x.value),1)])),_:1})];i(d(m,{class:"text-subtitle-1 mb-1"},{default:o(((a,i,n,e)=>{if(!i)return[s(r(t.notification.data.title),1)];i(`${l(t.notification.data.title)}`)})),_:1},n,e)),i(d(p,null,{default:o(((a,i,n,e)=>{if(!i)return[s(r(t.notification.data.message),1)];i(`${l(t.notification.data.message)}`)})),_:1},n,e)),i(d(p,{class:"d-flex align-center mt-1"},{default:o(((a,i,n,e)=>{if(!i)return[c(w,{size:"x-small",color:b.value,class:"me-2"},{default:o((()=>[s(r(t.notification.data.status),1)])),_:1},8,["color"]),c("span",{class:"text-caption text-grey"},r(x.value),1)];i(d(w,{size:"x-small",color:b.value,class:"me-2"},{default:o(((a,i,n,e)=>{if(!i)return[s(r(t.notification.data.status),1)];i(`${l(t.notification.data.status)}`)})),_:1},n,e)),i(`<span class="text-caption text-grey" data-v-394349ca${e}>${l(x.value)}</span>`)})),_:1},n,e))})),_:2},[t.notification.data.order_id?{name:"append",fn:o(((a,i,n,e)=>{if(!i)return[c(w,{size:"small",variant:"outlined",class:"text-caption"},{default:o((()=>[s(r(t.notification.data.order_id),1)])),_:1})];i(d(w,{size:"small",variant:"outlined",class:"text-caption"},{default:o(((a,i,n,e)=>{if(!i)return[s(r(t.notification.data.order_id),1)];i(`${l(t.notification.data.order_id)}`)})),_:1},n,e))})),key:"0"}:void 0]),i))}}}),N=x.setup;x.setup=(a,i)=>{const n=t();return(n.modules||(n.modules=new Set)).add("components/notification/NotificationItem.vue"),N?N(a,i):void 0};const $=y(x,[["__scopeId","data-v-394349ca"]]),b=_("notification",{state:()=>({notifications:[],unreadCount:0,loading:!1,hasNewNotifications:!1,lastFetchTime:0,pagination:{current_page:1,last_page:1,per_page:10,total:0},error:null}),getters:{unreadNotifications(){return this.notifications.filter((t=>!t.is_read))},hasUnread(){return this.unreadCount>0},hasMorePages(){return this.pagination.current_page<this.pagination.last_page}},actions:{async fetchNotifications(t=1){if(1===t&&Date.now()-this.lastFetchTime<3e4)return;const{$axios:a}=g();this.loading=!0,this.error=null;try{const i=await a.get("/api/notifications",{params:{page:t,per_page:10}}),{notifications:n,unread_count:e,pagination:o}=i.data;if(1===t){const t=this.notifications.length>0&&n.some((t=>!this.notifications.find((a=>a.id===t.id))));this.hasNewNotifications=t,this.notifications=n}else this.notifications=[...this.notifications,...n];this.unreadCount=e,this.pagination=o,this.lastFetchTime=Date.now()}catch(t){this.error=t instanceof Error?t.message:"Failed to fetch notifications",console.error("Error fetching notifications:",t)}finally{this.loading=!1}},async fetchUnreadCount(){const{$axios:t}=g();try{const a=await t.get("/api/notifications/unread-count");this.unreadCount=a.data.unread_count}catch(t){console.error("Error fetching unread count:",t)}},async markAsRead(t){const{$axios:a}=g();try{const i=await a.post(`/api/notifications/${t}/read`),n=this.notifications.find((a=>a.id===t));n&&(n.is_read=!0,n.read_at=(new Date).toISOString()),this.unreadCount=i.data.unread_count}catch(t){console.error("Error marking notification as read:",t)}},async markAllAsRead(){const{$axios:t}=g();try{const a=await t.post("/api/notifications/mark-all-read");this.notifications=this.notifications.map((t=>({...t,is_read:!0,read_at:(new Date).toISOString()}))),this.unreadCount=a.data.unread_count,this.hasNewNotifications=!1}catch(t){console.error("Error marking all notifications as read:",t)}},async handleAction(t,a,i){const{$axios:n}=g();try{await n.post(`/api/notifications/${t}/action`,{action:a,payload:i}),await this.fetchNotifications(1)}catch(t){console.error("Error handling notification action:",t)}},setHasNewNotifications(t){this.hasNewNotifications=t},clearError(){this.error=null},resetStore(){this.$reset()}}});export{$ as _,b as u};
