import{_ as e}from"./EmptyStateCard-3UqWseqH.mjs";import{_ as t}from"./nuxt-link-CU98Qcmd.mjs";import{useSSRContext as a,defineComponent as r,computed as i,mergeProps as c,withCtx as o,createVNode as s,createTextVNode as d,openBlock as l,createBlock as n,Fragment as p,toDisplayString as u,renderSlot as m,createCommentVNode as v,withModifiers as h,renderList as _,createSlots as f}from"vue";import{ssrRenderAttrs as y,ssrRenderComponent as g,ssrInterpolate as j,ssrRenderSlot as x,ssrRenderList as C}from"vue/server-renderer";import{V as $}from"./VCard-CsohsM82.mjs";import{V as z}from"./VImg-B2jcJjnn.mjs";import{d as b,u as w,V as k,b as S,U as M,_ as G}from"./server.mjs";import{V as L}from"./VAvatar-JL8WKjry.mjs";import{_ as A}from"./TipButton-DzVv7844.mjs";import{V as T}from"./VSkeletonLoader-CXOx9RZQ.mjs";import{V}from"./VList-CcwwrkQR.mjs";import{V as B}from"./VListItem-jTLuICGb.mjs";const I="/images/default-avatar.png",P=r({__name:"ProjectCreditCard",__ssrInlineRender:!0,props:{credit:{},variant:{default:"default"},size:{default:"md"},showActions:{type:Boolean,default:!1}},emits:["click","edit","delete"],setup(e,{emit:a}){const r=e,_=a,f={sm:{iconSize:32,avatarSize:40},md:{iconSize:40,avatarSize:48},lg:{iconSize:48,avatarSize:56},xl:{iconSize:56,avatarSize:64}},C=i((()=>f[r.size].iconSize)),b=i((()=>f[r.size].avatarSize)),handleCardClick=e=>{_("click",e,r.credit)},handleEdit=()=>{_("edit",r.credit)},handleDelete=()=>{_("delete",r.credit)};return(e,a,r,i)=>{const _=t;a(`<div${y(c({class:["project-credit-card",[`project-credit-card--${e.size}`,`project-credit-card--${e.variant}`]]},i))} data-v-f8ab0d36>`),a(g($,{elevation:"compact"===e.variant?2:8,class:["project-credit-card__inner",{"project-credit-card__inner--compact":"compact"===e.variant,"project-credit-card__inner--default":"default"===e.variant}]},{default:o(((t,a,r,i)=>{var c,f,y,$,w,M,G,A,T,V,B,P,E,U,F,R;if(!a)return["default"===e.variant?(l(),n(p,{key:0},[s("div",{class:"project-credit-card__image-wrapper"},[s(z,{src:(null==(T=e.credit.user)?void 0:T.profile_photo)||I,alt:(null==(V=e.credit.user)?void 0:V.display_name)||"Cast Member",class:"project-credit-card__image",cover:"","lazy-src":(null==(B=e.credit.user)?void 0:B.profile_photo)||I},{placeholder:o((()=>[s("div",{class:"project-credit-card__image-placeholder"},[s(k,{icon:"mdi-account",size:C.value,color:"white",class:"placeholder-icon"},null,8,["size"])])])),_:1},8,["src","alt","lazy-src"])]),s("div",{class:"project-credit-card__content"},[s("div",{class:"project-credit-card__role"},[s("span",{class:"role-text"},u((null==(P=e.credit.role)?void 0:P.name)||"Uncredited"),1)]),s("h3",{class:"project-credit-card__name"},u((null==(E=e.credit.user)?void 0:E.display_name)||"Cast Member"),1),e.$slots.action?(l(),n("div",{key:0,class:"project-credit-card__action"},[m(e.$slots,"action",{},void 0,!0)])):v("",!0)])],64)):"compact"===e.variant?(l(),n("div",{key:1,class:"project-credit-card__compact-content"},[s("div",{class:"project-credit-card__avatar"},[s(L,{size:b.value,class:"credit-avatar"},{default:o((()=>{var t,a;return[s(z,{src:(null==(t=e.credit.user)?void 0:t.profile_photo)||I,alt:(null==(a=e.credit.user)?void 0:a.display_name)||"Cast Member",cover:""},{placeholder:o((()=>[s("div",{class:"avatar-placeholder"},[s(k,{icon:"mdi-account",size:.6*b.value,color:"white"},null,8,["size"])])])),_:1},8,["src","alt"])]})),_:1},8,["size"])]),s("div",{class:"project-credit-card__text-content"},[s("h3",{class:"project-credit-card__name project-credit-card__name--compact"},u((null==(U=e.credit.user)?void 0:U.display_name)||"Cast Member"),1),s("div",{class:"project-credit-card__role project-credit-card__role--compact"},[s("span",{class:"role-text role-text--compact"},u((null==(F=e.credit.role)?void 0:F.name)||"Uncredited"),1)])]),e.$slots.action&&"compact"===e.variant?(l(),n("div",{key:0,class:"project-credit-card__action-compact"},[m(e.$slots,"action",{},void 0,!0)])):v("",!0),e.showActions&&"compact"===e.variant?(l(),n("div",{key:1,class:"project-credit-card__actions-compact"},[s(S,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:h(handleEdit,["stop"]),class:"mr-1"},{default:o((()=>[s(k,{size:"18"},{default:o((()=>[d("mdi-pencil")])),_:1})])),_:1}),s(S,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:h(handleDelete,["stop"])},{default:o((()=>[s(k,{size:"18"},{default:o((()=>[d("mdi-delete")])),_:1})])),_:1})])):v("",!0),e.showActions?v("",!0):(l(),n("div",{key:2,class:"project-credit-card__arrow"},[s(k,{icon:"mdi-chevron-right",size:"20",color:"grey-darken-1"})]))])):v("",!0),s(_,{to:`/${(null==(R=e.credit.user)?void 0:R.username)||""}`,class:"project-credit-card__link",onClick:handleCardClick},null,8,["to"])];"default"===e.variant?(a(`\x3c!--[--\x3e<div class="project-credit-card__image-wrapper" data-v-f8ab0d36${i}>`),a(g(z,{src:(null==(c=e.credit.user)?void 0:c.profile_photo)||I,alt:(null==(f=e.credit.user)?void 0:f.display_name)||"Cast Member",class:"project-credit-card__image",cover:"","lazy-src":(null==(y=e.credit.user)?void 0:y.profile_photo)||I},{placeholder:o(((e,t,a,r)=>{if(!t)return[s("div",{class:"project-credit-card__image-placeholder"},[s(k,{icon:"mdi-account",size:C.value,color:"white",class:"placeholder-icon"},null,8,["size"])])];t(`<div class="project-credit-card__image-placeholder" data-v-f8ab0d36${r}>`),t(g(k,{icon:"mdi-account",size:C.value,color:"white",class:"placeholder-icon"},null,a,r)),t("</div>")})),_:1},r,i)),a(`</div><div class="project-credit-card__content" data-v-f8ab0d36${i}><div class="project-credit-card__role" data-v-f8ab0d36${i}><span class="role-text" data-v-f8ab0d36${i}>${j((null==($=e.credit.role)?void 0:$.name)||"Uncredited")}</span></div><h3 class="project-credit-card__name" data-v-f8ab0d36${i}>${j((null==(w=e.credit.user)?void 0:w.display_name)||"Cast Member")}</h3>`),e.$slots.action?(a(`<div class="project-credit-card__action" data-v-f8ab0d36${i}>`),x(e.$slots,"action",{},null,a,r,i),a("</div>")):a("\x3c!----\x3e"),a("</div>\x3c!--]--\x3e")):"compact"===e.variant?(a(`<div class="project-credit-card__compact-content" data-v-f8ab0d36${i}><div class="project-credit-card__avatar" data-v-f8ab0d36${i}>`),a(g(L,{size:b.value,class:"credit-avatar"},{default:o(((t,a,r,i)=>{var c,d,l,n;if(!a)return[s(z,{src:(null==(l=e.credit.user)?void 0:l.profile_photo)||I,alt:(null==(n=e.credit.user)?void 0:n.display_name)||"Cast Member",cover:""},{placeholder:o((()=>[s("div",{class:"avatar-placeholder"},[s(k,{icon:"mdi-account",size:.6*b.value,color:"white"},null,8,["size"])])])),_:1},8,["src","alt"])];a(g(z,{src:(null==(c=e.credit.user)?void 0:c.profile_photo)||I,alt:(null==(d=e.credit.user)?void 0:d.display_name)||"Cast Member",cover:""},{placeholder:o(((e,t,a,r)=>{if(!t)return[s("div",{class:"avatar-placeholder"},[s(k,{icon:"mdi-account",size:.6*b.value,color:"white"},null,8,["size"])])];t(`<div class="avatar-placeholder" data-v-f8ab0d36${r}>`),t(g(k,{icon:"mdi-account",size:.6*b.value,color:"white"},null,a,r)),t("</div>")})),_:1},r,i))})),_:1},r,i)),a(`</div><div class="project-credit-card__text-content" data-v-f8ab0d36${i}><h3 class="project-credit-card__name project-credit-card__name--compact" data-v-f8ab0d36${i}>${j((null==(M=e.credit.user)?void 0:M.display_name)||"Cast Member")}</h3><div class="project-credit-card__role project-credit-card__role--compact" data-v-f8ab0d36${i}><span class="role-text role-text--compact" data-v-f8ab0d36${i}>${j((null==(G=e.credit.role)?void 0:G.name)||"Uncredited")}</span></div></div>`),e.$slots.action&&"compact"===e.variant?(a(`<div class="project-credit-card__action-compact" data-v-f8ab0d36${i}>`),x(e.$slots,"action",{},null,a,r,i),a("</div>")):a("\x3c!----\x3e"),e.showActions&&"compact"===e.variant?(a(`<div class="project-credit-card__actions-compact" data-v-f8ab0d36${i}>`),a(g(S,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:handleEdit,class:"mr-1"},{default:o(((e,t,a,r)=>{if(!t)return[s(k,{size:"18"},{default:o((()=>[d("mdi-pencil")])),_:1})];t(g(k,{size:"18"},{default:o(((e,t,a,r)=>{if(!t)return[d("mdi-pencil")];t("mdi-pencil")})),_:1},a,r))})),_:1},r,i)),a(g(S,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:handleDelete},{default:o(((e,t,a,r)=>{if(!t)return[s(k,{size:"18"},{default:o((()=>[d("mdi-delete")])),_:1})];t(g(k,{size:"18"},{default:o(((e,t,a,r)=>{if(!t)return[d("mdi-delete")];t("mdi-delete")})),_:1},a,r))})),_:1},r,i)),a("</div>")):a("\x3c!----\x3e"),e.showActions?a("\x3c!----\x3e"):(a(`<div class="project-credit-card__arrow" data-v-f8ab0d36${i}>`),a(g(k,{icon:"mdi-chevron-right",size:"20",color:"grey-darken-1"},null,r,i)),a("</div>")),a("</div>")):a("\x3c!----\x3e"),a(g(_,{to:`/${(null==(A=e.credit.user)?void 0:A.username)||""}`,class:"project-credit-card__link",onClick:handleCardClick},null,r,i))})),_:3},r)),a("</div>")}}}),E=P.setup;P.setup=(e,t)=>{const r=a();return(r.modules||(r.modules=new Set)).add("components/project/ProjectCreditCard.vue"),E?E(e,t):void 0};const U=G(P,[["__scopeId","data-v-f8ab0d36"]]),F=b("projectCredits",{state:()=>({categoryGroups:[],isLoading:!1,error:null,page:1,hasMorePages:!0,perPage:16,totalMembers:0}),actions:{async fetchCredits(e,t=1){var a,r;this.isLoading=!0,this.error=null;const{$axios:i}=w();try{const{data:a}=await i.get(`/guest/projects/${e}/credits`,{params:{page:t,per_page:this.perPage}});return this.totalMembers=a.meta.total_members,this.hasMorePages=a.meta.current_page<a.meta.last_page,this.page=a.meta.current_page,1===t?this.categoryGroups=a.data:this.mergeNewGroups(a.data),a.data}catch(e){throw this.error=(null==(r=null==(a=null==e?void 0:e.response)?void 0:a.data)?void 0:r.message)||e.message,e}finally{this.isLoading=!1}},async addCredit(e,t){var a,r;this.isLoading=!0,this.error=null;const{$axios:i}=w();try{const{data:a}=await i.post(`/api/projects/${e}/credits`,t,{headers:{Accept:"application/json"}});return this.addCreditToState(a.data),a.data}catch(e){throw this.error=(null==(r=null==(a=null==e?void 0:e.response)?void 0:a.data)?void 0:r.message)||"Failed to add credit",e}finally{this.isLoading=!1}},async updateCredit(e,t,a){var r,i;this.isLoading=!0,this.error=null;const{$axios:c}=w();try{const{data:r}=await c.patch(`/api/projects/${e}/credits/${t}`,a,{headers:{Accept:"application/json"}});return this.updateCreditInState(r.data),r.data}catch(e){throw this.error=(null==(i=null==(r=null==e?void 0:e.response)?void 0:r.data)?void 0:i.message)||"Failed to update credit",e}finally{this.isLoading=!1}},async deleteCredit(e,t){var a,r;this.isLoading=!0,this.error=null;const{$axios:i}=w();try{return await i.delete(`/api/projects/${e}/credits/${t}`,{headers:{Accept:"application/json"}}),this.removeCreditFromState(t),!0}catch(e){throw this.error=(null==(r=null==(a=null==e?void 0:e.response)?void 0:a.data)?void 0:r.message)||"Failed to delete credit",e}finally{this.isLoading=!1}},addCreditToState(e){var t,a,r,i;const c=null==(a=null==(t=e.role)?void 0:t.category)?void 0:a.id,o=(null==(i=null==(r=e.role)?void 0:r.category)?void 0:i.name)||"Uncategorized";let s=this.categoryGroups.find((e=>e.category.id===c));s?s.credits.unshift(e):this.categoryGroups.unshift({category:{id:c||0,name:o},credits:[e]}),this.totalMembers++},updateCreditInState(e){var t,a;for(const r of this.categoryGroups){const i=r.credits.findIndex((t=>t.id===e.id));if(-1!==i){(null==(a=null==(t=e.role)?void 0:t.category)?void 0:a.id)!==r.category.id?(r.credits.splice(i,1),this.addCreditToState(e),this.totalMembers--,this.cleanupEmptyCategories()):r.credits[i]=e;break}}},removeCreditFromState(e){let t=!1;for(const a of this.categoryGroups){const r=a.credits.findIndex((t=>t.id===e));if(-1!==r){a.credits.splice(r,1),t=!0;break}}t&&(this.totalMembers=Math.max(0,this.totalMembers-1),this.cleanupEmptyCategories())},cleanupEmptyCategories(){this.categoryGroups=this.categoryGroups.filter((e=>e.credits.length>0))},mergeNewGroups(e){e.forEach((e=>{const t=this.categoryGroups.find((t=>t.category.id===e.category.id));if(t){const a=new Set(t.credits.map((e=>e.id))),r=e.credits.filter((e=>!a.has(e.id)));t.credits.push(...r)}else this.categoryGroups.push(e)}))},resetState(){this.categoryGroups=[],this.page=1,this.hasMorePages=!0,this.isLoading=!1,this.error=null,this.totalMembers=0}},getters:{getTotalCredits:e=>e.categoryGroups.reduce(((e,t)=>e+t.credits.length),0),getCreditById:e=>t=>{for(const a of e.categoryGroups){const e=a.credits.find((e=>e.id===t));if(e)return e}return null},hasCredits:e=>e.getTotalCredits>0,getCreditsByCategory:e=>t=>{const a=e.categoryGroups.find((e=>e.category.id===t));return a?a.credits:[]},getAllCategories:e=>e.categoryGroups.map((e=>e.category))}}),R=r({__name:"ProjectCreditGrid",__ssrInlineRender:!0,props:{isLoading:{type:Boolean},isLoadingMore:{type:Boolean},hasMore:{type:Boolean},showActions:{type:Boolean},showTipButton:{type:Boolean},emptyStateTitle:{},emptyStateMessage:{},showEmptyStateAction:{type:Boolean},emptyStateActionText:{}},emits:["delete-credit","edit-credit","empty-state-action","tip-complete","credit-click"],setup(t,{emit:a}){const r=t,d=a,handleCreditClick=(e,t)=>{d("credit-click",t)},handleEditCredit=e=>{d("edit-credit",e)},handleDeleteCredit=e=>{d("delete-credit",e)},u=F(),m=i((()=>u.categoryGroups)),v=i((()=>r.emptyStateTitle||"No Cast & Crew Members Yet")),h=i((()=>r.emptyStateMessage||"This project doesn't have any members yet.")),x=i((()=>r.showEmptyStateAction?{actionText:r.emptyStateActionText||"Add First Member",onActionClick:()=>d("empty-state-action")}:{}));return(t,a,r,i)=>{const u=e,$=U,z=A;a(`<div${y(c({class:"credits-container"},i))} data-v-ea4f8d41>`),t.isLoading&&!m.value.length?(a("\x3c!--[--\x3e"),C(2,(e=>{a('<div class="mb-8" data-v-ea4f8d41>'),a(g(T,{type:"heading",class:"mb-4",width:"200"},null,r)),a(g(V,null,{default:o(((t,a,r,i)=>{if(!a)return[(l(),n(p,null,_(3,(t=>s(B,{key:`credit-${e}-${t}`},{default:o((()=>[s(T,{type:"list-item-avatar-two-line",height:"84"})])),_:2},1024))),64))];a("\x3c!--[--\x3e"),C(3,(t=>{a(g(B,{key:`credit-${e}-${t}`},{default:o(((e,t,a,r)=>{if(!t)return[s(T,{type:"list-item-avatar-two-line",height:"84"})];t(g(T,{type:"list-item-avatar-two-line",height:"84"},null,a,r))})),_:2},r,i))})),a("\x3c!--]--\x3e")})),_:2},r)),a("</div>")})),a("\x3c!--]--\x3e")):t.isLoading||m.value.length?(a("\x3c!--[--\x3e\x3c!--[--\x3e"),C(m.value,(e=>{a(`<div class="category-group mb-8" data-v-ea4f8d41><h2 class="text-h5 mb-4 category-title" data-v-ea4f8d41>${j(e.category.name)}</h2><div class="credits-list" data-v-ea4f8d41>\x3c!--[--\x3e`),C(e.credits,(e=>{a(g($,{key:e.id,credit:e,variant:"compact","show-actions":t.showActions,class:"credit-list-item",onClick:handleCreditClick,onEdit:handleEditCredit,onDelete:handleDeleteCredit},f({_:2},[t.showTipButton?{name:"action",fn:o(((t,a,r,i)=>{if(!a)return[s(z,{entity:e.user,"entity-type":"user",size:"small",onTransactionComplete:()=>d("tip-complete",e)},null,8,["entity","onTransactionComplete"])];a(g(z,{entity:e.user,"entity-type":"user",size:"small",onTransactionComplete:()=>d("tip-complete",e)},null,r,i))})),key:"0"}:void 0]),r))})),a("\x3c!--]--\x3e</div></div>")})),a('\x3c!--]--\x3e<div class="text-center py-4" data-v-ea4f8d41>'),t.isLoadingMore?a(g(M,{indeterminate:"",color:"primary",size:"24"},null,r)):t.hasMore?a("\x3c!----\x3e"):(a('<div class="text-medium-emphasis" data-v-ea4f8d41>'),a(g(k,{icon:"mdi-check-circle",class:"mr-2"},null,r)),a(" You&#39;ve reached the end of the list </div>")),a("</div>\x3c!--]--\x3e")):a(g(u,c({icon:"mdi-account-group-outline",title:v.value,message:h.value},x.value),null,r)),a("</div>")}}}),N=R.setup;R.setup=(e,t)=>{const r=a();return(r.modules||(r.modules=new Set)).add("views/projects/ProjectCreditGrid.vue"),N?N(e,t):void 0};const Q=G(R,[["__scopeId","data-v-ea4f8d41"]]);export{Q as _,F as u};
