import{ref as e,shallowRef as l,computed as a,watch as o,nextTick as t,createVNode as u,mergeProps as n,Fragment as s,createTextVNode as i}from"vue";import{m as r,u as v,a as c}from"./VSelect-BWLkvD3S.mjs";import{m as d,V as m}from"./VTextField-rd-VvEF8.mjs";import{p,$ as f,h as b,a7 as h,a2 as x,X as y,aF as V,j as g,V as k,aI as w,o as C,aJ as _,b9 as j}from"./server.mjs";import{m as D,u as I}from"./filter-BWdoXH_J.mjs";import{f as S}from"./VInput-DRJS2l97.mjs";import{f as A}from"./forwardRefs-BSTjJZPU.mjs";import{u as M,t as F,V as B}from"./VList-CcwwrkQR.mjs";import{m as E}from"./VImg-B2jcJjnn.mjs";import{V as L}from"./VMenu-BpdBiT5v.mjs";import{V as R}from"./VListItem-jTLuICGb.mjs";import{V as T}from"./VCheckboxBtn-v4ZZzD80.mjs";import{a as P}from"./VChip-f_o2BAA4.mjs";const U=p({autoSelectFirst:{type:[Boolean,String]},delimiters:Array,...D({filterKeys:["title"]}),...r({hideNoData:!0,returnObject:!0}),...f(d({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...E({transition:!1})},"VCombobox"),K=b()({name:"VCombobox",props:U(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(r,d){var p,f;let{emit:b,slots:D}=d;const{t:E}=h(),U=e(),K=l(!1),N=l(!0),J=l(!1),O=e(),z=e(),Z=x(r,"menu"),H=a({get:()=>Z.value,set:e=>{var l;Z.value&&!e&&(null==(l=O.value)?void 0:l.Î¨openChildren)||(Z.value=e)}}),W=l(-1);let X=!1;const $=a((()=>{var e;return null==(e=U.value)?void 0:e.color})),G=a((()=>H.value?r.closeText:r.openText)),{items:Q,transformIn:q,transformOut:Y}=M(r),{textColorClasses:ee,textColorStyles:le}=y($),ae=x(r,"modelValue",[],(e=>q(V(e))),(e=>{var l;const a=Y(e);return r.multiple?a:null!=(l=a[0])?l:null})),oe=S(),te=l(r.multiple?"":null!=(p=null==(f=ae.value[0])?void 0:f.title)?p:""),ue=a({get:()=>te.value,set:e=>{var l;if(te.value=null!=e?e:"",r.multiple||(ae.value=[F(r,e)]),e&&r.multiple&&(null==(l=r.delimiters)?void 0:l.length)){const l=e.split(new RegExp(`(?:${r.delimiters.join("|")})+`));l.length>1&&(l.forEach((e=>{(e=e.trim())&&select(F(r,e))})),te.value="")}e||(W.value=-1),N.value=!e}}),ne=a((()=>"function"==typeof r.counterValue?r.counterValue(ae.value):"number"==typeof r.counterValue?r.counterValue:r.multiple?ae.value.length:ue.value.length));o(te,(e=>{X?t((()=>X=!1)):K.value&&!H.value&&(H.value=!0),b("update:search",e)})),o(ae,(e=>{var l,a;r.multiple||(te.value=null!=(l=null==(a=e[0])?void 0:a.title)?l:"")}));const{filteredItems:se,getMatches:ie}=I(r,Q,(()=>N.value?"":ue.value)),re=a((()=>r.hideSelected?se.value.filter((e=>!ae.value.some((l=>l.value===e.value)))):se.value)),ve=a((()=>ae.value.map((e=>e.value)))),ce=a((()=>{var e;return(!0===r.autoSelectFirst||"exact"===r.autoSelectFirst&&ue.value===(null==(e=re.value[0])?void 0:e.title))&&re.value.length>0&&!N.value&&!J.value})),de=a((()=>r.hideNoData&&!Q.value.length||r.readonly||(null==oe?void 0:oe.isReadonly.value))),me=e(),{onListScroll:pe,onListKeydown:fe}=v(me,U);function onClear(e){X=!0,r.openOnClear&&(H.value=!0)}function onMousedownControl(){de.value||(H.value=!0)}function onMousedownMenuIcon(e){de.value||(K.value&&(e.preventDefault(),e.stopPropagation()),H.value=!H.value)}function onKeydown(e){var l;if(j(e)||r.readonly||(null==oe?void 0:oe.isReadonly.value))return;const a=U.value.selectionStart,o=ae.value.length;if((W.value>-1||["Enter","ArrowDown","ArrowUp"].includes(e.key))&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(H.value=!0),["Escape"].includes(e.key)&&(H.value=!1),["Enter","Escape","Tab"].includes(e.key)&&(ce.value&&["Enter","Tab"].includes(e.key)&&select(se.value[0]),N.value=!0),"ArrowDown"===e.key&&ce.value&&(null==(l=me.value)||l.focus("next")),r.multiple){if(["Backspace","Delete"].includes(e.key)){if(W.value<0)return void("Backspace"!==e.key||ue.value||(W.value=o-1));const l=W.value,a=ae.value[W.value];a&&!a.props.disabled&&select(a),W.value=l>=o-1?o-2:l}if("ArrowLeft"===e.key){if(W.value<0&&a>0)return;const e=W.value>-1?W.value-1:o-1;ae.value[e]?W.value=e:(W.value=-1,U.value.setSelectionRange(ue.value.length,ue.value.length))}if("ArrowRight"===e.key){if(W.value<0)return;const e=W.value+1;ae.value[e]?W.value=e:(W.value=-1,U.value.setSelectionRange(0,0))}"Enter"===e.key&&ue.value&&(select(F(r,ue.value)),ue.value="")}}function onAfterLeave(){var e;K.value&&(N.value=!0,null==(e=U.value)||e.focus())}function select(e){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(r.multiple){const a=ae.value.findIndex((l=>r.valueComparator(l.value,e.value))),o=null==l?!~a:l;if(~a){const l=o?[...ae.value,e]:[...ae.value];l.splice(a,1),ae.value=l}else o&&(ae.value=[...ae.value,e]);ue.value=""}else{const a=!1!==l;ae.value=a?[e]:[],te.value=a?e.title:"",t((()=>{H.value=!1,N.value=!0}))}}function onFocusin(e){K.value=!0,setTimeout((()=>{J.value=!0}))}function onFocusout(e){J.value=!1}function onUpdateModelValue(e){(null==e||""===e&&!r.multiple)&&(ae.value=[])}return o(se,(e=>{!e.length&&r.hideNoData&&(H.value=!1)})),o(K,((e,l)=>{e||e===l||(W.value=-1,H.value=!1,!ce.value||J.value||ae.value.some((e=>{let{value:l}=e;return l===re.value[0].value}))?r.multiple&&ue.value&&select(F(r,ue.value)):select(re.value[0]))})),o(H,(()=>{!r.hideSelected&&H.value&&ae.value.length&&re.value.findIndex((e=>ae.value.some((l=>r.valueComparator(l.value,e.value)))))})),g((()=>{const e=!(!r.chips&&!D.chip),l=!!(!r.hideNoData||re.value.length||D["prepend-item"]||D["append-item"]||D["no-data"]),a=ae.value.length>0,o=m.filterProps(r);return u(m,n({ref:U},o,{modelValue:ue.value,"onUpdate:modelValue":[e=>ue.value=e,onUpdateModelValue],focused:K.value,"onUpdate:focused":e=>K.value=e,validationValue:ae.externalValue,counterValue:ne.value,dirty:a,class:["v-combobox",{"v-combobox--active-menu":H.value,"v-combobox--chips":!!r.chips,"v-combobox--selection-slot":!!D.selection,"v-combobox--selecting-index":W.value>-1,["v-combobox--"+(r.multiple?"multiple":"single")]:!0},r.class],style:r.style,readonly:r.readonly,placeholder:a?void 0:r.placeholder,"onClick:clear":onClear,"onMousedown:control":onMousedownControl,onKeydown:onKeydown}),{...D,default:()=>u(s,null,[u(L,n({ref:O,modelValue:H.value,"onUpdate:modelValue":e=>H.value=e,activator:"parent",contentClass:"v-combobox__content",disabled:de.value,eager:r.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:r.transition,onAfterLeave:onAfterLeave},r.menuProps),{default:()=>{var e;return[l&&u(B,{ref:me,selected:ve.value,selectStrategy:r.multiple?"independent":"single-independent",onMousedown:e=>e.preventDefault(),onKeydown:fe,onFocusin:onFocusin,onFocusout:onFocusout,onScrollPassive:pe,tabindex:"-1",color:null!=(e=r.itemColor)?e:r.color},{default:()=>{var e,l,a,o;return[null==(l=D["prepend-item"])?void 0:l.call(D),!re.value.length&&!r.hideNoData&&(null!=(e=null==(a=D["no-data"])?void 0:a.call(D))?e:u(R,{title:E(r.noDataText)},null)),u(c,{ref:z,renderless:!0,items:re.value},{default:e=>{var l,a;let{item:o,index:t,itemRef:i}=e;const v=n(o.props,{ref:i,key:t,active:!(!ce.value||0!==t)||void 0,onClick:()=>select(o,null)});return null!=(l=null==(a=D.item)?void 0:a.call(D,{item:o,index:t,props:v}))?l:u(R,v,{prepend:e=>{let{isSelected:l}=e;return u(s,null,[r.multiple&&!r.hideSelected?u(T,{key:o.value,modelValue:l,ripple:!1,tabindex:"-1"},null):void 0,o.props.prependIcon&&u(k,{icon:o.props.prependIcon},null)])},title:()=>{var e,l,a;return N.value?o.title:function(e,l,a){if(null==l)return e;if(Array.isArray(l))throw new Error("Multiple matches is not implemented");return"number"==typeof l&&~l?u(s,null,[u("span",{class:"v-combobox__unmask"},[e.substr(0,l)]),u("span",{class:"v-combobox__mask"},[e.substr(l,a)]),u("span",{class:"v-combobox__unmask"},[e.substr(l+a)])]):e}(o.title,null==(l=ie(o))?void 0:l.title,null!=(e=null==(a=ue.value)?void 0:a.length)?e:0)}})}}),null==(o=D["append-item"])?void 0:o.call(D)]}})]}}),ae.value.map(((l,a)=>{const o={"onClick:close":function(e){e.stopPropagation(),e.preventDefault(),select(l,!1)},onMousedown(e){e.preventDefault(),e.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},t=e?!!D.chip:!!D.selection,s=t?w(e?D.chip({item:l,index:a,props:o}):D.selection({item:l,index:a})):void 0;if(!t||s)return u("div",{key:l.value,class:["v-combobox__selection",a===W.value&&["v-combobox__selection--selected",ee.value]],style:a===W.value?le.value:{}},[e?D.chip?u(C,{key:"chip-defaults",defaults:{VChip:{closable:r.closableChips,size:"small",text:l.title}}},{default:()=>[s]}):u(P,n({key:"chip",closable:r.closableChips,size:"small",text:l.title,disabled:l.props.disabled},o),null):null!=s?s:u("span",{class:"v-combobox__selection-text"},[l.title,r.multiple&&a<ae.value.length-1&&u("span",{class:"v-combobox__selection-comma"},[i(",")])])])}))]),"append-inner":function(){for(var e,l=arguments.length,a=new Array(l),o=0;o<l;o++)a[o]=arguments[o];return u(s,null,[null==(e=D["append-inner"])?void 0:e.call(D,...a),r.hideNoData&&!r.items.length||!r.menuIcon?void 0:u(k,{class:"v-combobox__menu-icon",icon:r.menuIcon,onMousedown:onMousedownMenuIcon,onClick:_,"aria-label":E(G.value),title:E(G.value)},null)])}})})),A({isFocused:K,isPristine:N,menu:H,search:ue,selectionIndex:W,filteredItems:se,select:select},U)}});export{K as V};
