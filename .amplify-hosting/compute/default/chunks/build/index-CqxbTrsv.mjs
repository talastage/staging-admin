import{e}from"./server.mjs";function unpackToArray(e,t){const a=[],r=t.resolveKeyData||(e=>e.key),o=t.resolveValueData||(e=>e.value);for(const[n,i]of Object.entries(e))a.push(...(Array.isArray(i)?i:[i]).map((e=>{const a={key:n,value:e},i=o(a);return"object"==typeof i?unpackToArray(i,t):Array.isArray(i)?i:{["function"==typeof t.key?t.key(a):t.key]:r(a),["function"==typeof t.value?t.value(a):t.value]:i}})).flat());return a}function unpackToString(e,t){return Object.entries(e).map((([e,a])=>{if("object"==typeof a&&(a=unpackToString(a,t)),t.resolve){const r=t.resolve({key:e,value:a});if(void 0!==r)return r}return"number"==typeof a&&(a=a.toString()),"string"==typeof a&&t.wrapValue&&(a=a.replace(new RegExp(t.wrapValue,"g"),`\\${t.wrapValue}`),a=`${t.wrapValue}${a}${t.wrapValue}`),`${e}${t.keyValueSeparator||""}${a}`})).join(t.entrySeparator||"")}const p=e=>({keyValue:e,metaKey:"property"}),k=e=>({keyValue:e}),t={appleItunesApp:{unpack:{entrySeparator:", ",resolve:({key:e,value:t})=>`${fixKeyCase(e)}=${t}`}},articleExpirationTime:p("article:expiration_time"),articleModifiedTime:p("article:modified_time"),articlePublishedTime:p("article:published_time"),bookReleaseDate:p("book:release_date"),charset:{metaKey:"charset"},contentSecurityPolicy:{unpack:{entrySeparator:"; ",resolve:({key:e,value:t})=>`${fixKeyCase(e)} ${t}`},metaKey:"http-equiv"},contentType:{metaKey:"http-equiv"},defaultStyle:{metaKey:"http-equiv"},fbAppId:p("fb:app_id"),msapplicationConfig:k("msapplication-Config"),msapplicationTileColor:k("msapplication-TileColor"),msapplicationTileImage:k("msapplication-TileImage"),ogAudioSecureUrl:p("og:audio:secure_url"),ogAudioUrl:p("og:audio"),ogImageSecureUrl:p("og:image:secure_url"),ogImageUrl:p("og:image"),ogSiteName:p("og:site_name"),ogVideoSecureUrl:p("og:video:secure_url"),ogVideoUrl:p("og:video"),profileFirstName:p("profile:first_name"),profileLastName:p("profile:last_name"),profileUsername:p("profile:username"),refresh:{metaKey:"http-equiv",unpack:{entrySeparator:";",resolve({key:e,value:t}){if("seconds"===e)return`${t}`}}},robots:{unpack:{entrySeparator:", ",resolve:({key:e,value:t})=>"boolean"==typeof t?`${fixKeyCase(e)}`:`${fixKeyCase(e)}:${t}`}},xUaCompatible:{metaKey:"http-equiv"}},a=new Set(["og","book","article","profile"]);function resolveMetaKeyType(e){var r;const o=fixKeyCase(e),n=o.indexOf(":");return a.has(o.substring(0,n))?"property":(null==(r=t[e])?void 0:r.metaKey)||"name"}function fixKeyCase(e){const t=e.replace(/([A-Z])/g,"-$1").toLowerCase(),r=t.indexOf("-"),o=t.substring(0,r);return"twitter"===o||a.has(o)?e.replace(/([A-Z])/g,":$1").toLowerCase():t}function changeKeyCasingDeep(e){if(Array.isArray(e))return e.map((e=>changeKeyCasingDeep(e)));if("object"!=typeof e||Array.isArray(e))return e;const t={};for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[fixKeyCase(a)]=changeKeyCasingDeep(e[a]));return t}function resolvePackedMetaObjectValue(e,a){const r=t[a];return"refresh"===a?`${e.seconds};url=${e.url}`:unpackToString(changeKeyCasingDeep(e),{keyValueSeparator:"=",entrySeparator:", ",resolve:({value:e,key:t})=>null===e?"":"boolean"==typeof e?`${t}`:void 0,...null==r?void 0:r.unpack})}const r=new Set(["og:image","og:video","og:audio","twitter:image"]);function sanitize(e){const t={};for(const a in e){if(!Object.prototype.hasOwnProperty.call(e,a))continue;const r=e[a];"false"!==String(r)&&a&&(t[a]=r)}return t}function handleObjectEntry(e,t){const a=sanitize(t),o=fixKeyCase(e),n=resolveMetaKeyType(o);if(r.has(o)){const t={};for(const r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[`${e}${"url"===r?"":`${r[0].toUpperCase()}${r.slice(1)}`}`]=a[r]);return unpackMeta(t).sort(((e,t)=>{var a,r;return((null==(a=e[n])?void 0:a.length)||0)-((null==(r=t[n])?void 0:r.length)||0)}))}return[{[n]:o,...a}]}function unpackMeta(e){const a=[],o={};for(const t in e){if(!Object.prototype.hasOwnProperty.call(e,t))continue;const n=e[t];if(Array.isArray(n))for(const e of n)a.push(..."string"==typeof e?unpackMeta({[t]:e}):handleObjectEntry(t,e));else if("object"==typeof n&&n){if(r.has(fixKeyCase(t))){a.push(...handleObjectEntry(t,n));continue}o[t]=sanitize(n)}else o[t]=n}const n=unpackToArray(o,{key:({key:e})=>resolveMetaKeyType(e),value:({key:e})=>"charset"===e?"charset":"content",resolveKeyData:({key:e})=>function(e){var a;return(null==(a=t[e])?void 0:a.keyValue)||fixKeyCase(e)}(e),resolveValueData:({value:e,key:t})=>null===e?"_null":"object"==typeof e?resolvePackedMetaObjectValue(e,t):"number"==typeof e?e.toString():e});return[...a,...n].map((e=>("_null"===e.content&&(e.content=null),e)))}function useSeoMeta(t,a){const{title:r,titleTemplate:o,...n}=t;return e({title:r,titleTemplate:o,_flatMeta:n},{...a,transform(e){const t=unpackMeta({...e._flatMeta});return delete e._flatMeta,{...e,meta:t}}})}function useServerSeoMeta(e,t){return useSeoMeta(e,{...t,mode:"server"})}export{useServerSeoMeta as a,useSeoMeta as u};
