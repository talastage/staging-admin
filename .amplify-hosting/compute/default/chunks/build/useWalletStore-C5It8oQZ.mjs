import{d as e,u as l}from"./server.mjs";import{ref as t,computed as a}from"vue";import{isAxiosError as u}from"axios";const n=e("wallet",(()=>{const{$axios:e}=l(),n=t(null),r=t(!1),o=t(!1),s=t(null),i=t(null),v=t(null),c=t(null),d=a((()=>{var e,l;return"active"===(null==(l=null==(e=n.value)?void 0:e.data)?void 0:l.status)})),p=a((()=>{var e,l,t;return null!=(e=null==(t=null==(l=n.value)?void 0:l.data)?void 0:t.balance)?e:"0"})),f=a((()=>{var e,l;return null==(l=null==(e=n.value)?void 0:e.data)?void 0:l.currency})),m=a((()=>!!s.value&&new Date<s.value));function setError(e){v.value=e}function clearAuth(){o.value=!1,s.value=null,i.value=null,v.value=null,n.value=null,c.value=null}return{wallet:n,isFetching:r,isAuthenticated:o,sessionExpiry:s,intendedRoute:i,error:v,lastUpdated:c,isWalletActive:d,currentBalance:p,currentCurrency:f,isSessionValid:m,fetchWallet:async function(){var l,t,a,o,s;r.value=!0;try{const{data:l}=await e.get("/api/wallet");return n.value=l,c.value=new Date,l}catch(e){return u(e)?setError({message:(null==(t=null==(l=e.response)?void 0:l.data)?void 0:t.message)||e.message,status:null==(a=e.response)?void 0:a.status,code:null==(s=null==(o=e.response)?void 0:o.data)?void 0:s.code}):setError({message:"An unexpected error occurred"}),null}finally{r.value=!1}},setError:setError,setAuthenticated:function(e){o.value=e,e||(n.value=null)},setSessionExpiry:function(e){s.value="string"==typeof e?new Date(e):e},setIntendedRoute:function(e){i.value=e},clearAuth:clearAuth,logout:async function(){try{await e.post("/api/wallet/logout")}catch(e){}finally{clearAuth()}}}}));export{n as u};
