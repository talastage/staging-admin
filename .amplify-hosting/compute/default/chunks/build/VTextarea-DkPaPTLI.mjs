import{computed as e,ref as t,shallowRef as a,watchEffect as o,watch as l,createVNode as n,mergeProps as r,Fragment as u,withDirectives as s,resolveDirective as i,vModelText as c,nextTick as d}from"vue";import{V as p}from"./VCounter-BZE6l8kb.mjs";import{m as v,f,V as m}from"./VField-ZM6yOiXp.mjs";import{m as x,u as g,V as h}from"./VInput-DRJS2l97.mjs";import{f as V}from"./forwardRefs-BSTjJZPU.mjs";import{p as w,h as y,a2 as C,j as I,ac as F,ad as b,Q as S,ap as k}from"./server.mjs";import{I as j}from"./VImg-B2jcJjnn.mjs";const B=w({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...x(),...v()},"VTextarea"),P=y()({name:"VTextarea",directives:{Intersect:j},inheritAttrs:!1,props:B(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(v,x){let{attrs:w,emit:y,slots:j}=x;const B=C(v,"modelValue"),{isFocused:P,focus:R,blur:H}=g(v),M=e((()=>"function"==typeof v.counterValue?v.counterValue(B.value):(B.value||"").toString().length)),N=e((()=>w.maxlength?w.maxlength:!v.counter||"number"!=typeof v.counter&&"string"!=typeof v.counter?void 0:v.counter));function onIntersect(e,t){var a,o;v.autofocus&&e&&(null==(o=null==(a=t[0].target)?void 0:a.focus)||o.call(a))}const z=t(),G=t(),_=a(""),E=t(),A=e((()=>v.persistentPlaceholder||P.value||v.active));function onFocus(){var e;E.value!==(void 0).activeElement&&(null==(e=E.value)||e.focus()),P.value||R()}function onControlClick(e){onFocus(),y("click:control",e)}function onControlMousedown(e){y("mousedown:control",e)}function onClear(e){e.stopPropagation(),onFocus(),d((()=>{B.value="",b(v["onClick:clear"],e)}))}function onInput(e){var t;const a=e.target;if(B.value=a.value,null==(t=v.modelModifiers)?void 0:t.trim){const e=[a.selectionStart,a.selectionEnd];d((()=>{a.selectionStart=e[0],a.selectionEnd=e[1]}))}}const D=t(),J=t(+v.rows),O=e((()=>["plain","underlined"].includes(v.variant)));function calculateInputHeight(){v.autoGrow&&d((()=>{if(!D.value||!G.value)return;const e=getComputedStyle(D.value),t=getComputedStyle(G.value.$el),a=parseFloat(e.getPropertyValue("--v-field-padding-top"))+parseFloat(e.getPropertyValue("--v-input-padding-top"))+parseFloat(e.getPropertyValue("--v-field-padding-bottom")),o=D.value.scrollHeight,l=parseFloat(e.lineHeight),n=Math.max(parseFloat(v.rows)*l+a,parseFloat(t.getPropertyValue("--v-input-control-height"))),r=parseFloat(v.maxRows)*l+a||1/0,u=k(null!=o?o:0,n,r);J.value=Math.floor((u-a)/l),_.value=S(u)}))}let T;return o((()=>{v.autoGrow||(J.value=+v.rows)})),l(B,calculateInputHeight),l((()=>v.rows),calculateInputHeight),l((()=>v.maxRows),calculateInputHeight),l((()=>v.density),calculateInputHeight),l(D,(e=>{e?(T=new ResizeObserver(calculateInputHeight),T.observe(D.value)):null==T||T.disconnect()})),I((()=>{const e=!!(j.counter||v.counter||v.counterValue),t=!(!e&&!j.details),[a,o]=F(w),{modelValue:l,...d}=h.filterProps(v),x=f(v);return n(h,r({ref:z,modelValue:B.value,"onUpdate:modelValue":e=>B.value=e,class:["v-textarea v-text-field",{"v-textarea--prefixed":v.prefix,"v-textarea--suffixed":v.suffix,"v-text-field--prefixed":v.prefix,"v-text-field--suffixed":v.suffix,"v-textarea--auto-grow":v.autoGrow,"v-textarea--no-resize":v.noResize||v.autoGrow,"v-input--plain-underlined":O.value},v.class],style:v.style},a,d,{centerAffix:1===J.value&&!O.value,focused:P.value}),{...j,default:e=>{let{id:t,isDisabled:a,isDirty:l,isReadonly:d,isValid:p}=e;return n(m,r({ref:G,style:{"--v-textarea-control-height":_.value},onClick:onControlClick,onMousedown:onControlMousedown,"onClick:clear":onClear,"onClick:prependInner":v["onClick:prependInner"],"onClick:appendInner":v["onClick:appendInner"]},x,{id:t.value,active:A.value||l.value,centerAffix:1===J.value&&!O.value,dirty:l.value||v.dirty,disabled:a.value,focused:P.value,error:!1===p.value}),{...j,default:e=>{let{props:{class:t,...l}}=e;return n(u,null,[v.prefix&&n("span",{class:"v-text-field__prefix"},[v.prefix]),s(n("textarea",r({ref:E,class:t,value:B.value,onInput:onInput,autofocus:v.autofocus,readonly:d.value,disabled:a.value,placeholder:v.placeholder,rows:v.rows,name:v.name,onFocus:onFocus,onBlur:H},l,o),null),[[i("intersect"),{handler:onIntersect},null,{once:!0}]]),v.autoGrow&&s(n("textarea",{class:[t,"v-textarea__sizer"],id:`${l.id}-sizer`,"onUpdate:modelValue":e=>B.value=e,ref:D,readonly:!0,"aria-hidden":"true"},null),[[c,B.value]]),v.suffix&&n("span",{class:"v-text-field__suffix"},[v.suffix])])}})},details:t?t=>{var a;return n(u,null,[null==(a=j.details)?void 0:a.call(j,t),e&&n(u,null,[n("span",null,null),n(p,{active:v.persistentCounter||P.value,value:M.value,max:N.value},j.counter)])])}:void 0})})),V({},z,G,E)}});export{P as V};
