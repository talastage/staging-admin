import{watch as e,createVNode as l,Fragment as t,mergeProps as a,toRef as n,onScopeDispose as o,ref as u,computed as s,shallowRef as i,createTextVNode as r,watchEffect as c,nextTick as v}from"vue";import{m as d,V as m}from"./VTextField-rd-VvEF8.mjs";import{f as p}from"./VInput-DRJS2l97.mjs";import{f}from"./forwardRefs-BSTjJZPU.mjs";import{p as h,m as g,h as y,aK as V,j as w,r as I,P as x,F as S,as as b,Q as C,I as k,$ as T,a7 as B,a2 as A,aF as _,V as R,aI as j,o as D,aL as F,aM as P,ap as M,ar as O}from"./server.mjs";import{m as L,u as E,V as U}from"./VList-CcwwrkQR.mjs";import{m as H}from"./VImg-B2jcJjnn.mjs";import{V as K}from"./dialog-transition-BU2TTOTj.mjs";import{V as q}from"./VMenu-BpdBiT5v.mjs";import{V as z}from"./VListItem-jTLuICGb.mjs";import{V as $}from"./VCheckboxBtn-v4ZZzD80.mjs";import{a as N}from"./VChip-f_o2BAA4.mjs";const J=h({renderless:Boolean,...g()},"VVirtualScrollItem"),Z=y()({name:"VVirtualScrollItem",inheritAttrs:!1,props:J(),emits:{"update:height":e=>!0},setup(n,o){let{attrs:u,emit:s,slots:i}=o;const{resizeRef:r,contentRect:c}=V();e((()=>{var e;return null==(e=c.value)?void 0:e.height}),(e=>{null!=e&&s("update:height",e)})),w((()=>{var e,o;return n.renderless?l(t,null,[null==(e=i.default)?void 0:e.call(i,{itemRef:r})]):l("div",a({ref:r,class:["v-virtual-scroll__item",n.class],style:n.style},u),[null==(o=i.default)?void 0:o.call(i)])}))}}),Q=h({itemHeight:{type:[Number,String],default:null},height:[Number,String]},"virtual");const G=h({items:{type:Array,default:()=>[]},renderless:Boolean,...Q(),...g(),...I()},"VVirtualScroll"),W=y()({name:"VVirtualScroll",props:G(),setup(a,r){let{slots:d}=r;x("VVirtualScroll");const{dimensionStyles:m}=S(a),{containerRef:p,markerRef:f,handleScroll:h,handleScrollend:g,handleItemResize:y,scrollToIndex:I,paddingTop:k,paddingBottom:T,computedItems:B}=function(l,t){const a=F(),n=i(0);c((()=>{n.value=parseFloat(l.itemHeight||0)}));const r=i(0),d=i(Math.ceil((parseInt(l.height)||a.height.value)/(n.value||16))||1),m=i(0),p=i(0),f=u(),h=u();let g=0;const{resizeRef:y,contentRect:w}=V();c((()=>{y.value=f.value}));const I=s((()=>{var e;return f.value===(void 0).documentElement?a.height.value:(null==(e=w.value)?void 0:e.height)||parseInt(l.height)||0})),x=s((()=>!!(f.value&&h.value&&I.value&&n.value)));let S=Array.from({length:t.value.length}),b=Array.from({length:t.value.length});const C=i(0);let k=-1;const T=P((()=>{const e=performance.now();b[0]=0;const l=t.value.length;for(let e=1;e<=l-1;e++)b[e]=(b[e-1]||0)+(S[e-1]||n.value);C.value=Math.max(C.value,performance.now()-e)}),C),B=e(x,(e=>{e&&(B(),g=h.value.offsetTop,T.immediate(),calculateVisibleItems(),~k&&v((()=>{})))}));function calculateOffset(e){return e=M(e,0,t.value.length-1),b[e]||0}function calculateIndex(e){return function(e,l){let t=e.length-1,a=0,n=0,o=null,u=-1;if(e[t]<l)return t;for(;a<=t;)if(n=a+t>>1,o=e[n],o>l)t=n-1;else{if(!(o<l))return o===l?n:a;u=n,a=n+1}return u}(b,e)}e(I,((e,l)=>{l&&calculateVisibleItems()})),o((()=>{T.clear()}));let A=0,_=0,R=0,j=-1;function calculateVisibleItems(){cancelAnimationFrame(j),j=requestAnimationFrame(_calculateVisibleItems)}function _calculateVisibleItems(){if(!f.value||!I.value)return;const e=A-g,l=Math.sign(_),a=Math.max(0,e-100),n=M(calculateIndex(a),0,t.value.length),o=e+I.value+100,u=M(calculateIndex(o)+1,n+1,t.value.length);if((-1!==l||n<r.value)&&(1!==l||u>d.value)){const e=calculateOffset(r.value)-calculateOffset(n),l=calculateOffset(u)-calculateOffset(d.value);Math.max(e,l)>100?(r.value=n,d.value=u):(n<=0&&(r.value=n),u>=t.value.length&&(d.value=u))}m.value=calculateOffset(r.value),p.value=calculateOffset(t.value.length)-calculateOffset(d.value)}const D=s((()=>t.value.slice(r.value,d.value).map(((e,l)=>({raw:e,index:l+r.value})))));return e(t,(()=>{S=Array.from({length:t.value.length}),b=Array.from({length:t.value.length}),T.immediate(),calculateVisibleItems()}),{deep:!0}),{containerRef:f,markerRef:h,computedItems:D,paddingTop:m,paddingBottom:p,scrollToIndex:function(e){const l=calculateOffset(e);!f.value||e&&!l?k=e:f.value.scrollTop=l},handleScroll:function(){if(!f.value||!h.value)return;const e=f.value.scrollTop,l=performance.now();l-R>500?(_=Math.sign(e-A),g=h.value.offsetTop):_=e-A,A=e,R=l,calculateVisibleItems()},handleScrollend:function(){f.value&&h.value&&(_=0,R=0,calculateVisibleItems())},handleItemResize:function(e,l){const t=S[e],a=n.value;n.value=a?Math.min(n.value,l):l,t===l&&a===n.value||(S[e]=l,T())}}}(a,n(a,"items"));return b((()=>a.renderless),(()=>{o((function(){var e,l;const t=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"addEventListener":"removeEventListener";p.value===(void 0).documentElement?((void 0)[t]("scroll",h,{passive:!0}),(void 0)[t]("scrollend",g)):(null==(e=p.value)||e[t]("scroll",h,{passive:!0}),null==(l=p.value)||l[t]("scrollend",g))}))})),w((()=>{const e=B.value.map((e=>l(Z,{key:e.index,renderless:a.renderless,"onUpdate:height":l=>y(e.index,l)},{default:l=>{var t;return null==(t=d.default)?void 0:t.call(d,{item:e.raw,index:e.index,...l})}})));return a.renderless?l(t,null,[l("div",{ref:f,class:"v-virtual-scroll__spacer",style:{paddingTop:C(k.value)}},null),e,l("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:C(T.value)}},null)]):l("div",{ref:p,class:["v-virtual-scroll",a.class],onScrollPassive:h,onScrollend:g,style:[m.value,a.style]},[l("div",{ref:f,class:"v-virtual-scroll__container",style:{paddingTop:C(k.value),paddingBottom:C(T.value)}},[e])])})),{scrollToIndex:I}}});function useScrolling(l,t){const a=i(!1);let n;return{onListScroll:function(e){cancelAnimationFrame(n),a.value=!0,n=requestAnimationFrame((()=>{n=requestAnimationFrame((()=>{a.value=!1}))}))},onListKeydown:async function(n){var o,u;if("Tab"===n.key&&(null==(o=t.value)||o.focus()),!["PageDown","PageUp","Home","End"].includes(n.key))return;const s=null==(u=l.value)?void 0:u.$el;if(!s)return;"Home"!==n.key&&"End"!==n.key||s.scrollTo({top:"Home"===n.key?0:s.scrollHeight,behavior:"smooth"}),await async function(){await new Promise((e=>requestAnimationFrame(e))),await new Promise((e=>requestAnimationFrame(e))),await new Promise((e=>requestAnimationFrame(e))),await new Promise((l=>{if(a.value){const t=e(a,(()=>{t(),l()}))}else l()}))}();const i=s.querySelectorAll(":scope > :not(.v-virtual-scroll__spacer)");if("PageDown"===n.key||"Home"===n.key){const e=s.getBoundingClientRect().top;for(const l of i)if(l.getBoundingClientRect().top>=e){l.focus();break}}else{const e=s.getBoundingClientRect().bottom;for(const l of[...i].reverse())if(l.getBoundingClientRect().bottom<=e){l.focus();break}}}}}const X=h({chips:Boolean,closableChips:Boolean,closeText:{type:String,default:"$vuetify.close"},openText:{type:String,default:"$vuetify.open"},eager:Boolean,hideNoData:Boolean,hideSelected:Boolean,menu:Boolean,menuIcon:{type:k,default:"$dropdown"},menuProps:{type:Object},multiple:Boolean,noDataText:{type:String,default:"$vuetify.noDataText"},openOnClear:Boolean,itemColor:String,...L({itemChildren:!1})},"Select"),Y=h({...X(),...T(d({modelValue:null,role:"button"}),["validationValue","dirty","appendInnerIcon"]),...H({transition:{component:K}})},"VSelect"),ee=y()({name:"VSelect",props:Y(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(n,o){let{slots:c}=o;const{t:v}=B(),d=u(),h=u(),g=u(),y=A(n,"menu"),V=s({get:()=>y.value,set:e=>{var l;y.value&&!e&&(null==(l=h.value)?void 0:l.Î¨openChildren)||(y.value=e)}}),{items:I,transformIn:x,transformOut:S}=E(n),b=A(n,"modelValue",[],(e=>x(null===e?[null]:_(e))),(e=>{var l;const t=S(e);return n.multiple?t:null!=(l=t[0])?l:null})),C=s((()=>"function"==typeof n.counterValue?n.counterValue(b.value):"number"==typeof n.counterValue?n.counterValue:b.value.length)),k=p(),T=s((()=>b.value.map((e=>e.value)))),F=i(!1),P=s((()=>V.value?n.closeText:n.openText));let M,L="";const H=s((()=>n.hideSelected?I.value.filter((e=>!b.value.some((l=>l===e)))):I.value)),K=s((()=>n.hideNoData&&!I.value.length||n.readonly||(null==k?void 0:k.isReadonly.value))),J=u(),{onListScroll:Z,onListKeydown:Q}=useScrolling(J,d);function onClear(e){n.openOnClear&&(V.value=!0)}function onMousedownControl(){K.value||(V.value=!V.value)}function onKeydown(e){var l,t;if(!e.key||n.readonly||(null==k?void 0:k.isReadonly.value))return;["Enter"," ","ArrowDown","ArrowUp","Home","End"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"," "].includes(e.key)&&(V.value=!0),["Escape","Tab"].includes(e.key)&&(V.value=!1),"Home"===e.key?null==(l=J.value)||l.focus("first"):"End"===e.key&&(null==(t=J.value)||t.focus("last"));if(n.multiple||!function(e){const l=1===e.key.length,t=!e.ctrlKey&&!e.metaKey&&!e.altKey;return l&&t}(e))return;const a=performance.now();a-M>1e3&&(L=""),L+=e.key.toLowerCase(),M=a;const o=I.value.find((e=>e.title.toLowerCase().startsWith(L)));void 0!==o&&(b.value=[o])}function select(e){if(n.multiple){const l=b.value.findIndex((l=>n.valueComparator(l.value,e.value)));if(-1===l)b.value=[...b.value,e];else{const e=[...b.value];e.splice(l,1),b.value=e}}else b.value=[e],V.value=!1}function onBlur(e){var l;(null==(l=J.value)?void 0:l.$el.contains(e.relatedTarget))||(V.value=!1)}function onAfterLeave(){var e;F.value&&(null==(e=d.value)||e.focus())}function onFocusin(e){F.value=!0}function onModelUpdate(e){null==e?b.value=[]:O(d.value)||O(d.value)||d.value&&(d.value.value="")}return e(V,(()=>{!n.hideSelected&&V.value&&b.value.length&&H.value.findIndex((e=>b.value.some((l=>n.valueComparator(l.value,e.value)))))})),w((()=>{const e=!(!n.chips&&!c.chip),o=!!(!n.hideNoData||H.value.length||c["prepend-item"]||c["append-item"]||c["no-data"]),u=b.value.length>0,s=m.filterProps(n),i=u||!F.value&&n.label&&!n.persistentPlaceholder?void 0:n.placeholder;return l(m,a({ref:d},s,{modelValue:b.value.map((e=>e.props.value)).join(", "),"onUpdate:modelValue":onModelUpdate,focused:F.value,"onUpdate:focused":e=>F.value=e,validationValue:b.externalValue,counterValue:C.value,dirty:u,class:["v-select",{"v-select--active-menu":V.value,"v-select--chips":!!n.chips,["v-select--"+(n.multiple?"multiple":"single")]:!0,"v-select--selected":b.value.length,"v-select--selection-slot":!!c.selection},n.class],style:n.style,inputmode:"none",placeholder:i,"onClick:clear":onClear,"onMousedown:control":onMousedownControl,onBlur:onBlur,onKeydown:onKeydown,"aria-label":v(P.value),title:v(P.value)}),{...c,default:()=>l(t,null,[l(q,a({ref:h,modelValue:V.value,"onUpdate:modelValue":e=>V.value=e,activator:"parent",contentClass:"v-select__content",disabled:K.value,eager:n.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:n.transition,onAfterLeave:onAfterLeave},n.menuProps),{default:()=>{var e;return[o&&l(U,{ref:J,selected:T.value,selectStrategy:n.multiple?"independent":"single-independent",onMousedown:e=>e.preventDefault(),onKeydown:Q,onFocusin:onFocusin,onScrollPassive:Z,tabindex:"-1",color:null!=(e=n.itemColor)?e:n.color},{default:()=>{var e,o,u,s;return[null==(o=c["prepend-item"])?void 0:o.call(c),!H.value.length&&!n.hideNoData&&(null!=(e=null==(u=c["no-data"])?void 0:u.call(c))?e:l(z,{title:v(n.noDataText)},null)),l(W,{ref:g,renderless:!0,items:H.value},{default:e=>{var o,u;let{item:s,index:i,itemRef:r}=e;const v=a(s.props,{ref:r,key:i,onClick:()=>select(s)});return null!=(o=null==(u=c.item)?void 0:u.call(c,{item:s,index:i,props:v}))?o:l(z,a(v,{role:"option"}),{prepend:e=>{let{isSelected:a}=e;return l(t,null,[n.multiple&&!n.hideSelected?l($,{key:s.value,modelValue:a,ripple:!1,tabindex:"-1"},null):void 0,s.props.prependIcon&&l(R,{icon:s.props.prependIcon},null)])}})}}),null==(s=c["append-item"])?void 0:s.call(c)]}})]}}),b.value.map(((t,o)=>{const u={"onClick:close":function(e){e.stopPropagation(),e.preventDefault(),select(t)},onMousedown(e){e.preventDefault(),e.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},s=e?!!c.chip:!!c.selection,i=s?j(e?c.chip({item:t,index:o,props:u}):c.selection({item:t,index:o})):void 0;if(!s||i)return l("div",{key:t.value,class:"v-select__selection"},[e?c.chip?l(D,{key:"chip-defaults",defaults:{VChip:{closable:n.closableChips,size:"small",text:t.title}}},{default:()=>[i]}):l(N,a({key:"chip",closable:n.closableChips,size:"small",text:t.title,disabled:t.props.disabled},u),null):null!=i?i:l("span",{class:"v-select__selection-text"},[t.title,n.multiple&&o<b.value.length-1&&l("span",{class:"v-select__selection-comma"},[r(",")])])])}))]),"append-inner":function(){for(var e,a=arguments.length,o=new Array(a),u=0;u<a;u++)o[u]=arguments[u];return l(t,null,[null==(e=c["append-inner"])?void 0:e.call(c,...o),n.menuIcon?l(R,{class:"v-select__menu-icon",icon:n.menuIcon},null):void 0])}})})),f({isFocused:F,menu:V,select:select},d)}});export{ee as V,W as a,X as m,useScrolling as u};
