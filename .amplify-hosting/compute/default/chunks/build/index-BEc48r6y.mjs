import{ref as e,computed as r,mergeProps as o,useSSRContext as u}from"vue";import{ssrRenderAttrs as t}from"vue/server-renderer";import{useRouter as a,useRoute as l}from"vue-router";import{d as n,u as s,a as i,_ as d}from"./server.mjs";import"node:http";import"node:https";import"node:zlib";import"node:stream";import"node:buffer";import"node:util";import"node:url";import"node:net";import"node:fs";import"node:path";import"../_/nitro.mjs";import"consola/core";import"nuxt-site-config/urls";import"ipx";import"unhead";import"pinia-plugin-persistedstate";const p=n("profile",(()=>{const o=s(),u=o.$axios||o.$api||null,t=i(),a=e(!1),l=e(null),n=e(null),d=r((()=>{var e,r,o;return(null==(r=null==(e=t.user)?void 0:e.value)?void 0:r.username)===(null==(o=n.value)?void 0:o.username)}));return{loading:a,error:l,userProfile:n,isProfileOwner:d,fetchProfile:async e=>{var r,t,s,i,d,p;if(!e)return l.value="Username is required",!1;if((null==(d=n.value)?void 0:d.username)===e)return!0;a.value=!0,l.value=null;try{if(u&&"function"==typeof u.get){const{data:o}=await u.get(`/api/user/${e}`);n.value=null!=(t=null!=(r=null==o?void 0:o.user)?r:null==o?void 0:o.data)?t:o}else{const r=await o.$fetch(`/api/user/${e}`);n.value=null!=(i=null!=(s=null==r?void 0:r.user)?s:null==r?void 0:r.data)?i:r}return!0}catch(e){return 404===(null==(p=null==e?void 0:e.response)?void 0:p.status)||(l.value=e instanceof Error?e.message:"Failed to load profile",console.error("Error fetching profile:",e)),!1}finally{a.value=!1}},updateUserPhoto:async e=>{var r;if(!(null==(r=t.user)?void 0:r.value))throw new Error("User must be logged in to update photo");try{await u.post("/api/profile/update-photo",{photo:e}),t.user&&t.user.value&&(t.user.value.profile_photo=e),n.value&&d.value&&(n.value.profile_photo=e);try{t.user&&t.user.value&&localStorage.setItem("user",JSON.stringify(t.user.value))}catch(e){}return!0}catch(e){throw console.error("Error updating user photo:",e),e}},updateUsername:async e=>{var r;if(!(null==(r=t.user)?void 0:r.value))throw new Error("User must be logged in to update username");try{await u.post("/api/profile/update-username",{username:e});const r=new Date(Date.now()+2592e6).toISOString().split("T")[0];t.user&&t.user.value&&(t.user.value.username=e,t.user.value.can_change_username=!1,t.user.value.next_username_change_date=r),n.value&&d.value&&(n.value.username=e);try{t.user&&t.user.value&&localStorage.setItem("user",JSON.stringify(t.user.value))}catch(e){}return!0}catch(e){throw console.error("Error updating username:",e),e}},clearProfile:()=>{n.value=null,l.value=null,a.value=!1}}})),v={__name:"index",__ssrInlineRender:!0,setup:e=>(a(),l(),p(),(e,r,u,a)=>{r(`<div${t(o({class:"profile-redirect"},a))} data-v-85bd2bd1><div class="loading-spinner" data-v-85bd2bd1></div></div>`)})},m=v.setup;v.setup=(e,r)=>{const o=u();return(o.modules||(o.modules=new Set)).add("pages/[username]/index.vue"),m?m(e,r):void 0};const c=d(v,[["__scopeId","data-v-85bd2bd1"]]);export{c as default};
