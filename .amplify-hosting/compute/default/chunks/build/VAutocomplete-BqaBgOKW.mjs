import{ref as e,shallowRef as l,computed as a,watch as t,nextTick as u,createVNode as o,mergeProps as n,Fragment as s,createTextVNode as i}from"vue";import{m as r,u as v,a as c}from"./VSelect-BWLkvD3S.mjs";import{m as p,V as d}from"./VTextField-rd-VvEF8.mjs";import{p as m,$ as f,h,a7 as y,a2 as V,X as g,aF as C,j as k,V as w,aI as x,o as b,aJ as I,ar as S}from"./server.mjs";import{m as _,u as j}from"./filter-BWdoXH_J.mjs";import{f as A}from"./VInput-DRJS2l97.mjs";import{f as D}from"./forwardRefs-BSTjJZPU.mjs";import{u as M,V as F}from"./VList-CcwwrkQR.mjs";import{m as B}from"./VImg-B2jcJjnn.mjs";import{V as L}from"./VMenu-BpdBiT5v.mjs";import{V as R}from"./VListItem-jTLuICGb.mjs";import{V as T}from"./VCheckboxBtn-v4ZZzD80.mjs";import{a as P}from"./VChip-f_o2BAA4.mjs";const U=m({autoSelectFirst:{type:[Boolean,String]},search:String,..._({filterKeys:["title"]}),...r(),...f(p({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...B({transition:!1})},"VAutocomplete"),E=h()({name:"VAutocomplete",props:U(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(r,p){let{slots:m}=p;const{t:f}=y(),h=e(),_=l(!1),B=l(!0),U=l(!1),E=e(),K=e(),J=V(r,"menu"),O=a({get:()=>J.value,set:e=>{var l;J.value&&!e&&(null==(l=E.value)?void 0:l.Î¨openChildren)||(J.value=e)}}),z=l(-1),N=a((()=>{var e;return null==(e=h.value)?void 0:e.color})),Z=a((()=>O.value?r.closeText:r.openText)),{items:H,transformIn:W,transformOut:X}=M(r),{textColorClasses:G,textColorStyles:Q}=g(N),$=V(r,"search",""),q=V(r,"modelValue",[],(e=>W(null===e?[null]:C(e))),(e=>{var l;const a=X(e);return r.multiple?a:null!=(l=a[0])?l:null})),Y=a((()=>"function"==typeof r.counterValue?r.counterValue(q.value):"number"==typeof r.counterValue?r.counterValue:q.value.length)),ee=A(),{filteredItems:le,getMatches:ae}=j(r,H,(()=>B.value?"":$.value)),te=a((()=>r.hideSelected?le.value.filter((e=>!q.value.some((l=>l.value===e.value)))):le.value)),ue=a((()=>q.value.map((e=>e.props.value)))),oe=a((()=>{var e;return(!0===r.autoSelectFirst||"exact"===r.autoSelectFirst&&$.value===(null==(e=te.value[0])?void 0:e.title))&&te.value.length>0&&!B.value&&!U.value})),ne=a((()=>r.hideNoData&&!H.value.length||r.readonly||(null==ee?void 0:ee.isReadonly.value))),se=e(),{onListScroll:ie,onListKeydown:re}=v(se,h);function onClear(e){r.openOnClear&&(O.value=!0),$.value=""}function onMousedownControl(){ne.value||(O.value=!0)}function onMousedownMenuIcon(e){ne.value||(_.value&&(e.preventDefault(),e.stopPropagation()),O.value=!O.value)}function onKeydown(e){var l,a,t;if(r.readonly||(null==ee?void 0:ee.isReadonly.value))return;const u=h.value.selectionStart,o=q.value.length;if((z.value>-1||["Enter","ArrowDown","ArrowUp"].includes(e.key))&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(O.value=!0),["Escape"].includes(e.key)&&(O.value=!1),oe.value&&["Enter","Tab"].includes(e.key)&&select(te.value[0]),"ArrowDown"===e.key&&oe.value&&(null==(l=se.value)||l.focus("next")),r.multiple){if(["Backspace","Delete"].includes(e.key)){if(z.value<0)return void("Backspace"!==e.key||$.value||(z.value=o-1));const l=z.value,a=q.value[z.value];a&&!a.props.disabled&&select(a),z.value=l>=o-1?o-2:l}if("ArrowLeft"===e.key){if(z.value<0&&u>0)return;const e=z.value>-1?z.value-1:o-1;q.value[e]?z.value=e:(z.value=-1,h.value.setSelectionRange(null==(a=$.value)?void 0:a.length,null==(t=$.value)?void 0:t.length))}if("ArrowRight"===e.key){if(z.value<0)return;const e=z.value+1;q.value[e]?z.value=e:(z.value=-1,h.value.setSelectionRange(0,0))}}}function onInput(e){$.value=e.target.value}function onChange(e){S(h.value)||S(h.value)}function onAfterLeave(){var e;_.value&&(B.value=!0,null==(e=h.value)||e.focus())}function onFocusin(e){_.value=!0,setTimeout((()=>{U.value=!0}))}function onFocusout(e){U.value=!1}function onUpdateModelValue(e){(null==e||""===e&&!r.multiple)&&(q.value=[])}const ve=l(!1);function select(e){if(r.multiple){const l=q.value.findIndex((l=>r.valueComparator(l.value,e.value)));if(-1===l)q.value=[...q.value,e];else{const e=[...q.value];e.splice(l,1),q.value=e}}else q.value=[e],ve.value=!0,$.value=e.title,O.value=!1,B.value=!0,u((()=>ve.value=!1))}return t(_,((e,l)=>{var a,t;e!==l&&(e?(ve.value=!0,$.value=r.multiple?"":String(null!=(a=null==(t=q.value.at(-1))?void 0:t.props.title)?a:""),B.value=!0,u((()=>ve.value=!1))):(r.multiple||null!=$.value?!oe.value||U.value||q.value.some((e=>{let{value:l}=e;return l===te.value[0].value}))||select(te.value[0]):q.value=[],O.value=!1,$.value="",z.value=-1))})),t($,(e=>{_.value&&!ve.value&&(e&&(O.value=!0),B.value=!e)})),t(O,(()=>{!r.hideSelected&&O.value&&q.value.length&&te.value.findIndex((e=>q.value.some((l=>e.value===l.value))))})),k((()=>{const e=!(!r.chips&&!m.chip),l=!!(!r.hideNoData||te.value.length||m["prepend-item"]||m["append-item"]||m["no-data"]),a=q.value.length>0,t=d.filterProps(r);return o(d,n({ref:h},t,{modelValue:$.value,"onUpdate:modelValue":onUpdateModelValue,focused:_.value,"onUpdate:focused":e=>_.value=e,validationValue:q.externalValue,counterValue:Y.value,dirty:a,onInput:onInput,onChange:onChange,class:["v-autocomplete","v-autocomplete--"+(r.multiple?"multiple":"single"),{"v-autocomplete--active-menu":O.value,"v-autocomplete--chips":!!r.chips,"v-autocomplete--selection-slot":!!m.selection,"v-autocomplete--selecting-index":z.value>-1},r.class],style:r.style,readonly:r.readonly,placeholder:a?void 0:r.placeholder,"onClick:clear":onClear,"onMousedown:control":onMousedownControl,onKeydown:onKeydown}),{...m,default:()=>o(s,null,[o(L,n({ref:E,modelValue:O.value,"onUpdate:modelValue":e=>O.value=e,activator:"parent",contentClass:"v-autocomplete__content",disabled:ne.value,eager:r.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:r.transition,onAfterLeave:onAfterLeave},r.menuProps),{default:()=>{var e;return[l&&o(F,{ref:se,selected:ue.value,selectStrategy:r.multiple?"independent":"single-independent",onMousedown:e=>e.preventDefault(),onKeydown:re,onFocusin:onFocusin,onFocusout:onFocusout,onScrollPassive:ie,tabindex:"-1",color:null!=(e=r.itemColor)?e:r.color},{default:()=>{var e,l,a,t;return[null==(l=m["prepend-item"])?void 0:l.call(m),!te.value.length&&!r.hideNoData&&(null!=(e=null==(a=m["no-data"])?void 0:a.call(m))?e:o(R,{title:f(r.noDataText)},null)),o(c,{ref:K,renderless:!0,items:te.value},{default:e=>{var l,a;let{item:t,index:u,itemRef:i}=e;const v=n(t.props,{ref:i,key:u,active:!(!oe.value||0!==u)||void 0,onClick:()=>select(t)});return null!=(l=null==(a=m.item)?void 0:a.call(m,{item:t,index:u,props:v}))?l:o(R,v,{prepend:e=>{let{isSelected:l}=e;return o(s,null,[r.multiple&&!r.hideSelected?o(T,{key:t.value,modelValue:l,ripple:!1,tabindex:"-1"},null):void 0,t.props.prependIcon&&o(w,{icon:t.props.prependIcon},null)])},title:()=>{var e,l,a;return B.value?t.title:function(e,l,a){if(null==l)return e;if(Array.isArray(l))throw new Error("Multiple matches is not implemented");return"number"==typeof l&&~l?o(s,null,[o("span",{class:"v-autocomplete__unmask"},[e.substr(0,l)]),o("span",{class:"v-autocomplete__mask"},[e.substr(l,a)]),o("span",{class:"v-autocomplete__unmask"},[e.substr(l+a)])]):e}(t.title,null==(l=ae(t))?void 0:l.title,null!=(e=null==(a=$.value)?void 0:a.length)?e:0)}})}}),null==(t=m["append-item"])?void 0:t.call(m)]}})]}}),q.value.map(((l,a)=>{const t={"onClick:close":function(e){e.stopPropagation(),e.preventDefault(),select(l)},onMousedown(e){e.preventDefault(),e.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},u=e?!!m.chip:!!m.selection,s=u?x(e?m.chip({item:l,index:a,props:t}):m.selection({item:l,index:a})):void 0;if(!u||s)return o("div",{key:l.value,class:["v-autocomplete__selection",a===z.value&&["v-autocomplete__selection--selected",G.value]],style:a===z.value?Q.value:{}},[e?m.chip?o(b,{key:"chip-defaults",defaults:{VChip:{closable:r.closableChips,size:"small",text:l.title}}},{default:()=>[s]}):o(P,n({key:"chip",closable:r.closableChips,size:"small",text:l.title,disabled:l.props.disabled},t),null):null!=s?s:o("span",{class:"v-autocomplete__selection-text"},[l.title,r.multiple&&a<q.value.length-1&&o("span",{class:"v-autocomplete__selection-comma"},[i(",")])])])}))]),"append-inner":function(){for(var e,l=arguments.length,a=new Array(l),t=0;t<l;t++)a[t]=arguments[t];return o(s,null,[null==(e=m["append-inner"])?void 0:e.call(m,...a),r.menuIcon?o(w,{class:"v-autocomplete__menu-icon",icon:r.menuIcon,onMousedown:onMousedownMenuIcon,onClick:I,"aria-label":f(Z.value),title:f(Z.value)},null):void 0])}})})),D({isFocused:_,isPristine:B,menu:O,search:$,filteredItems:le,select:select},h)}});export{E as V};
