import{_ as e}from"./MediaThumbnail-jyEgcC54.mjs";import{_ as i}from"./CountdownDateTimer-Ca5jMvj-.mjs";import{useSSRContext as a,defineComponent as r,computed as t,mergeProps as o,withCtx as n,createTextVNode as s,createVNode as c,openBlock as l,createBlock as d,toDisplayString as m,createCommentVNode as p,ref as u,watch as v}from"vue";import{ssrRenderAttrs as f,ssrRenderComponent as g,ssrInterpolate as _}from"vue/server-renderer";import{u as y}from"./useDateFormatter-W2Hui1rv.mjs";import{u as h,V as w,b,a_ as N,_ as $,aA as P}from"./server.mjs";import{_ as x}from"./UserAvatar-DFFlBvus.mjs";import{u as D}from"./useSnackMessage-PVLwAm7x.mjs";import{V as B}from"./VCard-CsohsM82.mjs";const U=r({__name:"UpcomingPremiereTimeDisplay",__ssrInlineRender:!0,props:{premiereDate:{}},setup(e){const i=e,{formatRelativeDate:a}=y(),r=t((()=>{const e=a(i.premiereDate);return e.startsWith("in ")?`Premieres ${e}`:e})),c=t((()=>{const e=new Date(i.premiereDate),formatTimeUnit=e=>e.toString().padStart(2,"0");return`${e.getDate()} ${["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]} at ${formatTimeUnit(e.getHours())}:${formatTimeUnit(e.getMinutes())}`}));return(e,i,a,t)=>{i(`<div${f(o({class:"premiere-time-display"},t))} data-v-1b0af014>`),i(g(w,{size:"small",class:"mr-1"},{default:n(((e,i,a,r)=>{if(!i)return[s("mdi-clock-outline")];i("mdi-clock-outline")})),_:1},a)),i(`<div class="premiere-time-display__content" data-v-1b0af014><div class="premiere-time-display__relative" data-v-1b0af014>${_(r.value)}</div><div class="premiere-time-display__exact" data-v-1b0af014>${_(c.value)}</div></div></div>`)}}}),I=U.setup;U.setup=(e,i)=>{const r=a();return(r.modules||(r.modules=new Set)).add("components/upcoming/UpcomingPremiereTimeDisplay.vue"),I?I(e,i):void 0};const k=$(U,[["__scopeId","data-v-1b0af014"]]),z=r({__name:"NotifyMeButton",__ssrInlineRender:!0,props:{isNotified:{type:Boolean},loading:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},isPending:{type:Boolean,default:!1},itemId:{default:""}},emits:["toggle","update:isNotified"],setup(e,{emit:i}){const a=e,r=i,s=t((()=>a.isPending?(a.isNotified,"Saving..."):a.isNotified?"Notification On":"Notify me")),handleClick=e=>{e.stopPropagation(),r("toggle",e),r("update:isNotified",!a.isNotified)};return(e,i,a,r)=>{i(g(b,o({loading:e.loading,color:e.isNotified?"primary":"grey-darken-2","text-color":e.isNotified?"white":"black",variant:"flat",size:e.compact?"x-small":"small",class:["notify-me-button",{"notify-me-button--compact":e.compact,"notify-me-button--pending":e.isPending}],onClick:handleClick},r),{default:n(((i,a,r,t)=>{if(!a)return[c(w,{icon:e.isNotified?"mdi-bell":"mdi-bell-outline",class:!e.compact&&"mr-2",size:(e.compact,"small"),color:e.isNotified?"white":"black"},null,8,["icon","class","size","color"]),e.compact?p("",!0):(l(),d("span",{key:0,class:"text-subtitle-2"},m(s.value),1))];a(g(w,{icon:e.isNotified?"mdi-bell":"mdi-bell-outline",class:!e.compact&&"mr-2",size:(e.compact,"small"),color:e.isNotified?"white":"black"},null,r,t)),e.compact?a("\x3c!----\x3e"):a(`<span class="text-subtitle-2" data-v-67c3f1d9${t}>${_(s.value)}</span>`)})),_:1},a))}}}),C=z.setup;z.setup=(e,i)=>{const r=a();return(r.modules||(r.modules=new Set)).add("components/notification/NotifyMeButton.vue"),C?C(e,i):void 0};const M=$(z,[["__scopeId","data-v-67c3f1d9"]]);const T=r({__name:"UpcomingPremiereNotifyMeCard",__ssrInlineRender:!0,props:{premiereDate:{},showNotifyButton:{type:Boolean,default:!1},isNotified:{type:Boolean,default:!1},notifyLoading:{type:Boolean,default:!1},position:{default:"bottom"},useCountdown:{type:Boolean,default:!1},showLocalDate:{type:Boolean,default:!1},premiereId:{default:""}},emits:["notifyToggle","countdownFinished","update:isNotified"],setup(e,{emit:a}){const r=e,n=a,{formatLocalDateTime:s}=y(),{isUpdatePending:c,toggleNotification:l}=function(){const e=u({}),i=u({});return{toggleNotification:async(a,r,t)=>{const o=!r;e.value[a]=!0,i.value[a]&&delete i.value[a];try{return await t(o),o}catch(e){return i.value[a]=e,console.error(`Failed to update notification for ${a}:`,e),r}finally{delete e.value[a]}},isUpdatePending:i=>!!e.value[i],getUpdateError:e=>i.value[e],pendingRequests:e,notificationErrors:i}}(),d=u(r.isNotified),m=t((()=>!!r.premiereId&&c(r.premiereId)));v((()=>r.isNotified),(e=>{d.value=e})),v(d,(e=>{n("update:isNotified",e)}));const p=t((()=>r.premiereDate?s(r.premiereDate):"")),onNotifyToggle=async e=>{if(n("notifyToggle",e),r.premiereId){const saveCallback=async e=>{await new Promise((e=>setTimeout(e,1e3))),n("update:isNotified",e)};await l(r.premiereId,d.value,saveCallback)}};return(e,a,r,t)=>{const n=i,s=k,c=M;a(`<div${f(o({class:["upcoming-premiere-overlay",{"position-bottom":"bottom"===e.position,"position-top-right":"top-right"===e.position}]},t))} data-v-3a0c4152><div class="upcoming-premiere-overlay__content" data-v-3a0c4152>`),e.useCountdown?(a('<div class="premiere-text" data-v-3a0c4152><div class="countdown" data-v-3a0c4152><strong data-v-3a0c4152>Premieres in</strong></div><div class="countdown-display" data-v-3a0c4152>'),a(g(n,{"target-date":e.premiereDate,"short-format":!0,onFinished:i=>e.$emit("countdownFinished")},null,r)),a("</div>"),e.showLocalDate?a(`<div class="premiere-date" data-v-3a0c4152>${_(p.value)}</div>`):a("\x3c!----\x3e"),a("</div>")):a(g(s,{premiereDate:e.premiereDate,class:"upcoming-premiere-overlay__time-badge"},null,r)),e.showNotifyButton?a(g(c,{isNotified:d.value,"onUpdate:isNotified":e=>d.value=e,"is-pending":m.value,compact:"bottom"===e.position,class:"upcoming-premiere-overlay__notify-button",onToggle:onNotifyToggle},null,r)):a("\x3c!----\x3e"),a("</div></div>")}}}),j=T.setup;T.setup=(e,i)=>{const r=a();return(r.modules||(r.modules=new Set)).add("components/upcoming/UpcomingPremiereNotifyMeCard.vue"),j?j(e,i):void 0};const A=$(T,[["__scopeId","data-v-3a0c4152"]]),F=r({__name:"UpcomingPremiereCard",__ssrInlineRender:!0,props:{premiere:{},loading:{type:Boolean,default:!1},showPremiereBadge:{type:Boolean,default:!0}},setup(i){const a=i,r=D(),s=N(),{$protectedAction:u}=h(),v=t((()=>s.isNotified(a.premiere.id))),f=t((()=>s.isLoading(a.premiere.id))),y=t((()=>{var e,i,r,t;return Boolean((null==(i=null==(e=a.premiere)?void 0:e.premiering)?void 0:i.is_future)&&"published"===(null==(r=a.premiere)?void 0:r.status)&&"completed"===(null==(t=a.premiere)?void 0:t.payment_status))})),handleNotificationToggle=async e=>{await u((async()=>{try{await s.toggleNotification(a.premiere),r.success(s.isNotified(a.premiere.id)?"You will be notified when this premiere starts":"Notification removed successfully")}catch(e){r.error("Failed to update notification settings"),console.error("Notification toggle error:",e)}}),{requiresAuth:!0})},navigateToPremiere=()=>{P(`/watch/${a.premiere.access_uuid}`)};return(i,a,r,t)=>{const s=e,u=A,h=x;a(g(B,o({class:"upcoming-premiere-card",elevation:2,loading:i.loading,onClick:navigateToPremiere},t),{default:n(((e,a,r,t)=>{var o,n,b,N,$,P;if(!a)return[c("div",{class:"upcoming-premiere-card__thumbnail-container"},[c(s,{thumbnailUrl:i.premiere.thumbnail_url,videoUrl:i.premiere.video_url,showViews:!1,showDuration:!0,size:"2xl",class:"upcoming-premiere-card__thumbnail"},null,8,["thumbnailUrl","videoUrl"]),i.showPremiereBadge?(l(),d(u,{key:0,premiereDate:i.premiere.premiering.localized,showNotifyButton:y.value,isNotified:v.value,notifyLoading:f.value,position:"bottom",useCountdown:!1,onNotifyToggle:handleNotificationToggle},null,8,["premiereDate","showNotifyButton","isNotified","notifyLoading"])):p("",!0),c("div",{class:"upcoming-premiere-card__play-overlay"},[c(w,{icon:"mdi-play-circle",size:"x-large",color:"white"})])]),c("div",{class:"upcoming-premiere-card__wrapper"},[i.premiere.creator?(l(),d("div",{key:0,class:"upcoming-premiere-card__avatar-container"},[c(h,{username:i.premiere.creator.username,profile_photo:i.premiere.creator.profile_photo,size:40,class:"upcoming-premiere-card__avatar"},null,8,["username","profile_photo"])])):p("",!0),c("div",{class:"upcoming-premiere-card__info-container"},[c("div",{class:"upcoming-premiere-card__title-container"},[c("h3",{class:"upcoming-premiere-card__title"},m(i.premiere.name),1)]),c("div",{class:"upcoming-premiere-card__creator-container"},[c("span",{class:"upcoming-premiere-card__creator-name"},m(null==(N=i.premiere.creator)?void 0:N.display_name),1),(null==(P=null==($=i.premiere)?void 0:$.premiering)?void 0:P.is_future)?(l(),d("div",{key:0,class:"upcoming-premiere-card__premiere-badge"},[c(w,{icon:"mdi-clock-outline",size:"x-small",class:"mr-1"}),c("span",null,"Premiering soon")])):p("",!0)])])])];a(`<div class="upcoming-premiere-card__thumbnail-container" data-v-8a7f4cda${t}>`),a(g(s,{thumbnailUrl:i.premiere.thumbnail_url,videoUrl:i.premiere.video_url,showViews:!1,showDuration:!0,size:"2xl",class:"upcoming-premiere-card__thumbnail"},null,r,t)),i.showPremiereBadge?a(g(u,{premiereDate:i.premiere.premiering.localized,showNotifyButton:y.value,isNotified:v.value,notifyLoading:f.value,position:"bottom",useCountdown:!1,onNotifyToggle:handleNotificationToggle},null,r,t)):a("\x3c!----\x3e"),a(`<div class="upcoming-premiere-card__play-overlay" data-v-8a7f4cda${t}>`),a(g(w,{icon:"mdi-play-circle",size:"x-large",color:"white"},null,r,t)),a(`</div></div><div class="upcoming-premiere-card__wrapper" data-v-8a7f4cda${t}>`),i.premiere.creator?(a(`<div class="upcoming-premiere-card__avatar-container" data-v-8a7f4cda${t}>`),a(g(h,{username:i.premiere.creator.username,profile_photo:i.premiere.creator.profile_photo,size:40,class:"upcoming-premiere-card__avatar"},null,r,t)),a("</div>")):a("\x3c!----\x3e"),a(`<div class="upcoming-premiere-card__info-container" data-v-8a7f4cda${t}><div class="upcoming-premiere-card__title-container" data-v-8a7f4cda${t}><h3 class="upcoming-premiere-card__title" data-v-8a7f4cda${t}>${_(i.premiere.name)}</h3></div><div class="upcoming-premiere-card__creator-container" data-v-8a7f4cda${t}><span class="upcoming-premiere-card__creator-name" data-v-8a7f4cda${t}>${_(null==(o=i.premiere.creator)?void 0:o.display_name)}</span>`),(null==(b=null==(n=i.premiere)?void 0:n.premiering)?void 0:b.is_future)?(a(`<div class="upcoming-premiere-card__premiere-badge" data-v-8a7f4cda${t}>`),a(g(w,{icon:"mdi-clock-outline",size:"x-small",class:"mr-1"},null,r,t)),a(`<span data-v-8a7f4cda${t}>Premiering soon</span></div>`)):a("\x3c!----\x3e"),a("</div></div></div>")})),_:1},r))}}}),L=F.setup;F.setup=(e,i)=>{const r=a();return(r.modules||(r.modules=new Set)).add("components/upcoming/UpcomingPremiereCard.vue"),L?L(e,i):void 0};const S=$(F,[["__scopeId","data-v-8a7f4cda"]]);function useUpcomingPremieres(){const e=h();return{fetchUpcomingPremieres:async i=>{if(!e.$api)throw new Error("API plugin not available");try{return await e.$api.get("/api/upcoming/premieres",{params:{page:i,per_page:12}})}catch(e){throw console.error("Error fetching premieres:",e),e}},fetchNotifiedUpcomingPremieres:async i=>{if(!e.$api)throw new Error("API plugin not available");try{return await e.$api.get("/api/upcoming/premieres/notified",{params:{page:i,per_page:12}})}catch(e){throw console.error("Error fetching notified premieres:",e),e}}}}export{S as _,useUpcomingPremieres as u};
