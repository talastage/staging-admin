import{B as e}from"./BaseDialog-DsGYlnLZ.mjs";import{useSSRContext as a,defineComponent as t,ref as l,computed as s,watch as n,mergeProps as u,withCtx as r,createTextVNode as c,openBlock as i,createBlock as o,createCommentVNode as d,unref as m,createVNode as p,toDisplayString as v,withModifiers as y}from"vue";import{ssrRenderComponent as f,ssrInterpolate as b}from"vue/server-renderer";import{V as x}from"./VTextField-rd-VvEF8.mjs";import{V as g,u as h,U as w,b as _}from"./server.mjs";import{useRouter as V}from"vue-router";import{u as k}from"./useWalletStore-C5It8oQZ.mjs";import{u as B}from"./useCurrencyFormatter-Dfs2ioxk.mjs";import{u as N}from"./useSnackMessage-PVLwAm7x.mjs";import{a as C,V as F,c as T}from"./VCard-CsohsM82.mjs";import{V as W}from"./VForm-HRC00ryg.mjs";import{V as j}from"./VSkeletonLoader-CXOx9RZQ.mjs";import{V as S}from"./VAlert-DneVUU3Q.mjs";import{V as A}from"./VSpacer-_gFExeVk.mjs";const U=t({__name:"EnterAmount",__ssrInlineRender:!0,props:{modelValue:{type:Number,default:0},currencySymbol:{type:String,required:!0},max:{type:Number,default:Number.MAX_SAFE_INTEGER},min:{type:Number,default:0}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,m=a,p=l(null),v=l(""),y=l(""),b=s({get:()=>function(e){if(!e)return"";const a=e.split(".");return a[0]=a[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),a.join(".")}(v.value),set:e=>{v.value=e.replace(/[^\d.]/g,""),handleInput()}}),h=s((()=>{const e=parseFloat(v.value);return!isNaN(e)&&e>=t.min&&e<=t.max}));function handleInput(){const e=parseFloat(v.value);isNaN(e)?m("update:modelValue",0):m("update:modelValue",e),validateInput(!1)}function handleBlur(){const e=parseFloat(v.value);isNaN(e)?(v.value="0.00",m("update:modelValue",0)):(v.value=e.toFixed(2),m("update:modelValue",e)),validateInput(!0)}function handleFocus(e){const a=e.target;a.setSelectionRange(0,a.value.length)}function validateInput(e){const a=parseFloat(v.value);e&&isNaN(a)?y.value="Invalid amount":e&&a<t.min?y.value=`Amount too small (min: ${formatAmount(t.min)})`:e&&a>t.max?y.value=`Amount too large (max: ${formatAmount(t.max)})`:y.value=""}function formatAmount(e){return e.toLocaleString("en-US",{style:"currency",currency:"USD"}).replace("$",t.currencySymbol)}return n((()=>t.modelValue),(function(e){v.value=e.toString(),validateInput(!1)}),{immediate:!0}),(a,t,l,s)=>{t(f(x,u({modelValue:b.value,"onUpdate:modelValue":e=>b.value=e,label:"Enter amount",prefix:e.currencySymbol,type:"text",class:"mb-4",outlined:"",dense:"","error-messages":y.value,onInput:handleInput,onBlur:handleBlur,onFocus:handleFocus,ref_key:"input",ref:p},s),{append:r(((e,a,t,l)=>{if(!a)return[h.value?(i(),o(g,{key:0,color:"success"},{default:r((()=>[c("mdi-check-circle")])),_:1})):b.value&&!h.value?(i(),o(g,{key:1,color:"error"},{default:r((()=>[c("mdi-alert-circle")])),_:1})):d("",!0)];h.value?a(f(g,{color:"success"},{default:r(((e,a,t,l)=>{if(!a)return[c("mdi-check-circle")];a("mdi-check-circle")})),_:1},t,l)):b.value&&!h.value?a(f(g,{color:"error"},{default:r(((e,a,t,l)=>{if(!a)return[c("mdi-alert-circle")];a("mdi-alert-circle")})),_:1},t,l)):a("\x3c!----\x3e")})),_:1},l))}}}),$=U.setup;U.setup=(e,t)=>{const l=a();return(l.modules||(l.modules=new Set)).add("components/common/EnterAmount.vue"),$?$(e,t):void 0};const I=t({__name:"BalanceTransferDialog",__ssrInlineRender:!0,props:{modelValue:{type:Boolean},availableBalance:{},currencySymbol:{},currencyCode:{},transferEndpoint:{}},emits:["update:modelValue","transfer-success"],setup(a,{emit:t}){const x=a,$=t,{$axios:I}=h(),E=N(),{currencyFormatter:L}=B(),D=k(),R=V(),Y=s({get:()=>x.modelValue,set:e=>$("update:modelValue",e)}),z=l(null),M=l(!0),Q=l(0),Z=l(""),G=l(!1),P=l(!1),X=s((()=>Q.value>0&&Q.value<=x.availableBalance)),formatAmount=e=>L(e,x.currencySymbol,x.currencyCode),closeDialog=()=>{Y.value=!1,resetForm()},resetForm=()=>{Q.value=0,Z.value="",G.value=!1,P.value=!1,z.value&&z.value.resetValidation()};async function ensureWalletLoaded(){D.wallet||D.isFetching||await D.fetchWallet()}function navigateToActivate(){R.push("/wallet/activate"),closeDialog()}async function handleTransfer(){var e,a;if(X.value){G.value=!0,Z.value="";try{await ensureWalletLoaded();const e=await I.post(x.transferEndpoint,{amount:Q.value,currency_code:x.currencyCode});if(!e.data.success)throw new Error(e.data.message||"Transfer failed");await D.fetchWallet(),$("transfer-success",Q.value),P.value=!0,E.success("Transfer completed successfully")}catch(t){t instanceof Error?Z.value=(null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||t.message:Z.value="Transfer failed. Please try again."}finally{G.value=!1}}}return n((()=>x.modelValue),(e=>{e&&(resetForm(),ensureWalletLoaded())})),(a,t,l,s)=>{const n=U;t(f(e,u({modelValue:Y.value,"onUpdate:modelValue":e=>Y.value=e,title:"Transfer to Wallet","max-width":"400px"},s),{default:r(((e,t,l,s)=>{if(!t)return[m(D).isFetching?(i(),o(C,{key:0,class:"text-center py-6"},{default:r((()=>[p(w,{indeterminate:"",color:"primary",class:"mb-3"}),p("p",{class:"text-body-2"},"Loading wallet...")])),_:1})):m(D).isWalletActive?(i(),o(W,{key:2,ref_key:"form",ref:z,modelValue:M.value,"onUpdate:modelValue":e=>M.value=e,onSubmit:y(handleTransfer,["prevent"])},{default:r((()=>[p(C,{class:"pb-2"},{default:r((()=>[p(n,{modelValue:Q.value,"onUpdate:modelValue":e=>Q.value=e,"currency-symbol":a.currencySymbol,max:a.availableBalance,min:1,class:"mb-4"},null,8,["modelValue","onUpdate:modelValue","currency-symbol","max"]),Q.value>0?(i(),o(F,{key:0,variant:"outlined",class:"bg-surface-variant",elevation:"0"},{default:r((()=>[p(C,{class:"pa-3"},{default:r((()=>[p("div",{class:"d-flex align-center justify-space-between mb-2"},[p("span",{class:"text-body-2"},"Current Wallet Balance"),m(D).isFetching?(i(),o(j,{key:0,type:"text",width:"80",height:"16"})):(i(),o("span",{key:1,class:"text-body-2"},v(formatAmount(Number(m(D).currentBalance))),1))]),p("div",{class:"d-flex align-center justify-space-between"},[p("span",{class:"text-body-2 font-weight-medium"},"New Wallet Balance"),m(D).isFetching?(i(),o(j,{key:0,type:"text",width:"80",height:"16"})):(i(),o("span",{key:1,class:"text-body-2 font-weight-bold text-success"},v(formatAmount(Number(m(D).currentBalance)+Q.value)),1))])])),_:1})])),_:1})):d("",!0),Z.value?(i(),o(S,{key:1,type:"error",variant:"tonal",class:"mt-3",density:"compact"},{default:r((()=>[c(v(Z.value),1)])),_:1})):d("",!0),P.value?(i(),o(S,{key:2,type:"success",variant:"tonal",class:"mt-3",density:"compact"},{default:r((()=>[c(" Transfer completed successfully! ")])),_:1})):d("",!0)])),_:1}),p(T,{class:"pt-2"},{default:r((()=>[p(A),p(_,{variant:"text",onClick:closeDialog,disabled:G.value},{default:r((()=>[c(" Cancel ")])),_:1},8,["disabled"]),p(_,{color:"primary",type:"submit",loading:G.value,disabled:!M.value||!X.value||P.value},{default:r((()=>[c(v(P.value?"Completed":"Transfer Now"),1)])),_:1},8,["loading","disabled"])])),_:1})])),_:1},8,["modelValue","onUpdate:modelValue"])):(i(),o(C,{key:1,class:"text-center py-6"},{default:r((()=>[p(g,{color:"warning",size:"48",class:"mb-3"},{default:r((()=>[c("mdi-wallet-outline")])),_:1}),p("p",{class:"text-body-1 mb-4"},"Your wallet is currently inactive."),p(_,{color:"primary",variant:"elevated",onClick:navigateToActivate},{default:r((()=>[c(" Activate Wallet ")])),_:1})])),_:1}))];m(D).isFetching?t(f(C,{class:"text-center py-6"},{default:r(((e,a,t,l)=>{if(!a)return[p(w,{indeterminate:"",color:"primary",class:"mb-3"}),p("p",{class:"text-body-2"},"Loading wallet...")];a(f(w,{indeterminate:"",color:"primary",class:"mb-3"},null,t,l)),a(`<p class="text-body-2"${l}>Loading wallet...</p>`)})),_:1},l,s)):m(D).isWalletActive?t(f(W,{ref_key:"form",ref:z,modelValue:M.value,"onUpdate:modelValue":e=>M.value=e,onSubmit:handleTransfer},{default:r(((e,t,l,s)=>{if(!t)return[p(C,{class:"pb-2"},{default:r((()=>[p(n,{modelValue:Q.value,"onUpdate:modelValue":e=>Q.value=e,"currency-symbol":a.currencySymbol,max:a.availableBalance,min:1,class:"mb-4"},null,8,["modelValue","onUpdate:modelValue","currency-symbol","max"]),Q.value>0?(i(),o(F,{key:0,variant:"outlined",class:"bg-surface-variant",elevation:"0"},{default:r((()=>[p(C,{class:"pa-3"},{default:r((()=>[p("div",{class:"d-flex align-center justify-space-between mb-2"},[p("span",{class:"text-body-2"},"Current Wallet Balance"),m(D).isFetching?(i(),o(j,{key:0,type:"text",width:"80",height:"16"})):(i(),o("span",{key:1,class:"text-body-2"},v(formatAmount(Number(m(D).currentBalance))),1))]),p("div",{class:"d-flex align-center justify-space-between"},[p("span",{class:"text-body-2 font-weight-medium"},"New Wallet Balance"),m(D).isFetching?(i(),o(j,{key:0,type:"text",width:"80",height:"16"})):(i(),o("span",{key:1,class:"text-body-2 font-weight-bold text-success"},v(formatAmount(Number(m(D).currentBalance)+Q.value)),1))])])),_:1})])),_:1})):d("",!0),Z.value?(i(),o(S,{key:1,type:"error",variant:"tonal",class:"mt-3",density:"compact"},{default:r((()=>[c(v(Z.value),1)])),_:1})):d("",!0),P.value?(i(),o(S,{key:2,type:"success",variant:"tonal",class:"mt-3",density:"compact"},{default:r((()=>[c(" Transfer completed successfully! ")])),_:1})):d("",!0)])),_:1}),p(T,{class:"pt-2"},{default:r((()=>[p(A),p(_,{variant:"text",onClick:closeDialog,disabled:G.value},{default:r((()=>[c(" Cancel ")])),_:1},8,["disabled"]),p(_,{color:"primary",type:"submit",loading:G.value,disabled:!M.value||!X.value||P.value},{default:r((()=>[c(v(P.value?"Completed":"Transfer Now"),1)])),_:1},8,["loading","disabled"])])),_:1})];t(f(C,{class:"pb-2"},{default:r(((e,t,l,s)=>{if(!t)return[p(n,{modelValue:Q.value,"onUpdate:modelValue":e=>Q.value=e,"currency-symbol":a.currencySymbol,max:a.availableBalance,min:1,class:"mb-4"},null,8,["modelValue","onUpdate:modelValue","currency-symbol","max"]),Q.value>0?(i(),o(F,{key:0,variant:"outlined",class:"bg-surface-variant",elevation:"0"},{default:r((()=>[p(C,{class:"pa-3"},{default:r((()=>[p("div",{class:"d-flex align-center justify-space-between mb-2"},[p("span",{class:"text-body-2"},"Current Wallet Balance"),m(D).isFetching?(i(),o(j,{key:0,type:"text",width:"80",height:"16"})):(i(),o("span",{key:1,class:"text-body-2"},v(formatAmount(Number(m(D).currentBalance))),1))]),p("div",{class:"d-flex align-center justify-space-between"},[p("span",{class:"text-body-2 font-weight-medium"},"New Wallet Balance"),m(D).isFetching?(i(),o(j,{key:0,type:"text",width:"80",height:"16"})):(i(),o("span",{key:1,class:"text-body-2 font-weight-bold text-success"},v(formatAmount(Number(m(D).currentBalance)+Q.value)),1))])])),_:1})])),_:1})):d("",!0),Z.value?(i(),o(S,{key:1,type:"error",variant:"tonal",class:"mt-3",density:"compact"},{default:r((()=>[c(v(Z.value),1)])),_:1})):d("",!0),P.value?(i(),o(S,{key:2,type:"success",variant:"tonal",class:"mt-3",density:"compact"},{default:r((()=>[c(" Transfer completed successfully! ")])),_:1})):d("",!0)];t(f(n,{modelValue:Q.value,"onUpdate:modelValue":e=>Q.value=e,"currency-symbol":a.currencySymbol,max:a.availableBalance,min:1,class:"mb-4"},null,l,s)),Q.value>0?t(f(F,{variant:"outlined",class:"bg-surface-variant",elevation:"0"},{default:r(((e,a,t,l)=>{if(!a)return[p(C,{class:"pa-3"},{default:r((()=>[p("div",{class:"d-flex align-center justify-space-between mb-2"},[p("span",{class:"text-body-2"},"Current Wallet Balance"),m(D).isFetching?(i(),o(j,{key:0,type:"text",width:"80",height:"16"})):(i(),o("span",{key:1,class:"text-body-2"},v(formatAmount(Number(m(D).currentBalance))),1))]),p("div",{class:"d-flex align-center justify-space-between"},[p("span",{class:"text-body-2 font-weight-medium"},"New Wallet Balance"),m(D).isFetching?(i(),o(j,{key:0,type:"text",width:"80",height:"16"})):(i(),o("span",{key:1,class:"text-body-2 font-weight-bold text-success"},v(formatAmount(Number(m(D).currentBalance)+Q.value)),1))])])),_:1})];a(f(C,{class:"pa-3"},{default:r(((e,a,t,l)=>{if(!a)return[p("div",{class:"d-flex align-center justify-space-between mb-2"},[p("span",{class:"text-body-2"},"Current Wallet Balance"),m(D).isFetching?(i(),o(j,{key:0,type:"text",width:"80",height:"16"})):(i(),o("span",{key:1,class:"text-body-2"},v(formatAmount(Number(m(D).currentBalance))),1))]),p("div",{class:"d-flex align-center justify-space-between"},[p("span",{class:"text-body-2 font-weight-medium"},"New Wallet Balance"),m(D).isFetching?(i(),o(j,{key:0,type:"text",width:"80",height:"16"})):(i(),o("span",{key:1,class:"text-body-2 font-weight-bold text-success"},v(formatAmount(Number(m(D).currentBalance)+Q.value)),1))])];a(`<div class="d-flex align-center justify-space-between mb-2"${l}><span class="text-body-2"${l}>Current Wallet Balance</span>`),m(D).isFetching?a(f(j,{type:"text",width:"80",height:"16"},null,t,l)):a(`<span class="text-body-2"${l}>${b(formatAmount(Number(m(D).currentBalance)))}</span>`),a(`</div><div class="d-flex align-center justify-space-between"${l}><span class="text-body-2 font-weight-medium"${l}>New Wallet Balance</span>`),m(D).isFetching?a(f(j,{type:"text",width:"80",height:"16"},null,t,l)):a(`<span class="text-body-2 font-weight-bold text-success"${l}>${b(formatAmount(Number(m(D).currentBalance)+Q.value))}</span>`),a("</div>")})),_:1},t,l))})),_:1},l,s)):t("\x3c!----\x3e"),Z.value?t(f(S,{type:"error",variant:"tonal",class:"mt-3",density:"compact"},{default:r(((e,a,t,l)=>{if(!a)return[c(v(Z.value),1)];a(`${b(Z.value)}`)})),_:1},l,s)):t("\x3c!----\x3e"),P.value?t(f(S,{type:"success",variant:"tonal",class:"mt-3",density:"compact"},{default:r(((e,a,t,l)=>{if(!a)return[c(" Transfer completed successfully! ")];a(" Transfer completed successfully! ")})),_:1},l,s)):t("\x3c!----\x3e")})),_:1},l,s)),t(f(T,{class:"pt-2"},{default:r(((e,a,t,l)=>{if(!a)return[p(A),p(_,{variant:"text",onClick:closeDialog,disabled:G.value},{default:r((()=>[c(" Cancel ")])),_:1},8,["disabled"]),p(_,{color:"primary",type:"submit",loading:G.value,disabled:!M.value||!X.value||P.value},{default:r((()=>[c(v(P.value?"Completed":"Transfer Now"),1)])),_:1},8,["loading","disabled"])];a(f(A,null,null,t,l)),a(f(_,{variant:"text",onClick:closeDialog,disabled:G.value},{default:r(((e,a,t,l)=>{if(!a)return[c(" Cancel ")];a(" Cancel ")})),_:1},t,l)),a(f(_,{color:"primary",type:"submit",loading:G.value,disabled:!M.value||!X.value||P.value},{default:r(((e,a,t,l)=>{if(!a)return[c(v(P.value?"Completed":"Transfer Now"),1)];a(`${b(P.value?"Completed":"Transfer Now")}`)})),_:1},t,l))})),_:1},l,s))})),_:1},l,s)):t(f(C,{class:"text-center py-6"},{default:r(((e,a,t,l)=>{if(!a)return[p(g,{color:"warning",size:"48",class:"mb-3"},{default:r((()=>[c("mdi-wallet-outline")])),_:1}),p("p",{class:"text-body-1 mb-4"},"Your wallet is currently inactive."),p(_,{color:"primary",variant:"elevated",onClick:navigateToActivate},{default:r((()=>[c(" Activate Wallet ")])),_:1})];a(f(g,{color:"warning",size:"48",class:"mb-3"},{default:r(((e,a,t,l)=>{if(!a)return[c("mdi-wallet-outline")];a("mdi-wallet-outline")})),_:1},t,l)),a(`<p class="text-body-1 mb-4"${l}>Your wallet is currently inactive.</p>`),a(f(_,{color:"primary",variant:"elevated",onClick:navigateToActivate},{default:r(((e,a,t,l)=>{if(!a)return[c(" Activate Wallet ")];a(" Activate Wallet ")})),_:1},t,l))})),_:1},l,s))})),_:1},l))}}}),E=I.setup;I.setup=(e,t)=>{const l=a();return(l.modules||(l.modules=new Set)).add("components/balance/BalanceTransferDialog.vue"),E?E(e,t):void 0};export{I as _};
