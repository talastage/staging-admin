import{useSSRContext as e,defineComponent as a,ref as l,computed as i,watch as t,mergeProps as o,withCtx as d,createVNode as n}from"vue";import{ssrRenderAttrs as r,ssrRenderStyle as s,ssrRenderComponent as v,ssrInterpolate as u,ssrRenderClass as c}from"vue/server-renderer";import m from"hls.js";import{aL as f,U as p,V as h,_ as b}from"./server.mjs";import{V as y}from"./VImg-B2jcJjnn.mjs";const g="/images/default-thumbnail.jpg",w=a({__name:"MediaThumbnail",__ssrInlineRender:!0,props:{thumbnailUrl:{default:""},videoUrl:{default:""},label:{default:""},labelVariant:{default:"default"},size:{default:"md"},viewsCount:{default:void 0},showViews:{type:Boolean,default:!1},showDuration:{type:Boolean,default:!0}},setup(e){const a=e,b=l(!1),w=l(!1),$=l(!1),S=l(null),x=l(null),_=l(0),z=l(0),M=l(0);f();const U=i((()=>"string"==typeof a.size?`size-${a.size}`:"")),j=i((()=>"default"!==a.labelVariant?`label-badge--${a.labelVariant}`:"")),V=i((()=>{const e=b.value?M.value:z.value;if(!e)return"";const a=Math.floor(e),l=Math.floor(a/3600),i=Math.floor(a%3600/60),t=a%60;return l>0?`${l}:${i.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`:`${i}:${t.toString().padStart(2,"0")}`}));return t((()=>a.videoUrl),(e=>{e&&($.value=!1,b.value=!1,w.value=!1,_.value=0,M.value=0,function(){var e;const l=(void 0).createElement("video");if(l.style.display="none",(void 0).body.appendChild(l),l.onloadedmetadata=()=>{z.value=l.duration,l.parentNode===(void 0).body&&(void 0).body.removeChild(l)},l.onerror=()=>{l.parentNode===(void 0).body&&(void 0).body.removeChild(l)},null==(e=a.videoUrl)?void 0:e.endsWith(".m3u8")){if(m.isSupported()){const e=new m;e.loadSource(a.videoUrl),e.attachMedia(l),e.on(m.Events.MANIFEST_PARSED,(()=>{setTimeout((()=>{z.value=l.duration,e.destroy(),l.parentNode===(void 0).body&&(void 0).body.removeChild(l)}),1e3)}))}}else a.videoUrl&&(l.src=a.videoUrl)}(),S.value&&(e.endsWith(".m3u8")?function(e,a){if(!m.isSupported())return void(a.src=e);x.value&&x.value.destroy();const l=new m;l.loadSource(e),l.attachMedia(a),l.on(m.Events.ERROR,((e,a)=>{a.fatal&&($.value=!0)})),x.value=l}(e,S.value):S.value.src=e))})),(e,a,l,i)=>{var t;a(`<div${r(o({class:["media-thumbnail",U.value]},i))} data-v-710e009a><div class="thumbnail-wrapper" data-v-710e009a><div class="thumbnail-container" data-v-710e009a><video style="${s(b.value&&!$.value?null:{display:"none"})}" class="preview-video" muted loop playsinline crossorigin="anonymous" data-v-710e009a></video>`),a(v(y,{style:!b.value||$.value?null:{display:"none"},src:e.thumbnailUrl||g,"lazy-src":g,class:"thumbnail-image",cover:"",onError:e=>$.value=!0},{placeholder:d(((e,a,l,i)=>{if(!a)return[n("div",{class:"d-flex align-center justify-center fill-height"},[n(p,{indeterminate:"",color:"grey-lighten-5",size:"32"})])];a(`<div class="d-flex align-center justify-center fill-height" data-v-710e009a${i}>`),a(v(p,{indeterminate:"",color:"grey-lighten-5",size:"32"},null,l,i)),a("</div>")})),_:1},l)),w.value?(a('<div class="buffering-overlay" data-v-710e009a>'),a(v(p,{indeterminate:"",color:"white",size:"32"},null,l)),a("</div>")):a("\x3c!----\x3e"),e.showViews&&void 0!==e.viewsCount?(a('<div class="info-badge info-badge--views" data-v-710e009a>'),a(v(h,{start:"",icon:"mdi-eye-outline",size:"14",class:"mr-1"},null,l)),a(` ${u((t=e.viewsCount,t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString()))}</div>`)):a("\x3c!----\x3e"),e.showDuration&&V.value?a(`<div class="info-badge info-badge--duration" data-v-710e009a>${u(V.value)}</div>`):a("\x3c!----\x3e"),e.label?a(`<div class="${c([j.value,"label-badge"])}" data-v-710e009a>${u(e.label)}</div>`):a("\x3c!----\x3e"),a("</div></div></div>")}}}),$=w.setup;w.setup=(a,l)=>{const i=e();return(i.modules||(i.modules=new Set)).add("components/media/MediaThumbnail.vue"),$?$(a,l):void 0};const S=b(w,[["__scopeId","data-v-710e009a"]]);export{S as _};
