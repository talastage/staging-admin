import{createVNode as e,h as r,mergeProps as l,shallowRef as t,ref as a,computed as n,watch as i,nextTick as o,withDirectives as s,Fragment as u,resolveDirective as c,Transition as v,vShow as d}from"vue";import{p as g,m as p,r as m,h as S,F as f,j as y,P as b,Q as _}from"./server.mjs";const z=g({aspectRatio:[String,Number],contentClass:String,inline:Boolean,...p(),...m()},"VResponsive"),h=S()({name:"VResponsive",props:z(),setup(r,l){let{slots:t}=l;const{aspectStyles:a}=function(e){return{aspectStyles:n((()=>{const r=Number(e.aspectRatio);return r?{paddingBottom:String(1/r*100)+"%"}:void 0}))}}(r),{dimensionStyles:i}=f(r);return y((()=>{var l;return e("div",{class:["v-responsive",{"v-responsive--inline":r.inline},r.class],style:[i.value,r.style]},[e("div",{class:"v-responsive__sizer",style:a.value},null),null==(l=t.additional)?void 0:l.call(t),t.default&&e("div",{class:["v-responsive__content",r.contentClass]},[t.default()])])})),{}}}),j=g({transition:{type:[Boolean,String,Object],default:"fade-transition",validator:e=>!0!==e}},"transition"),MaybeTransition=(e,t)=>{let{slots:a}=t;const{transition:n,disabled:i,...o}=e,{component:s=v,...u}="object"==typeof n?n:{};return r(s,l("string"==typeof n?{name:i?"":n}:u,o,{disabled:i}),a)};const F={mounted:function(e,r){},unmounted:function(e,r){var l;const t=null==(l=e._observe)?void 0:l[r.instance.$.uid];t&&(t.observer.unobserve(e),delete e._observe[r.instance.$.uid])}},R=g({alt:String,cover:Boolean,draggable:{type:[Boolean,String],default:void 0},eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},crossorigin:String,referrerpolicy:String,srcset:String,position:String,...z(),...p(),...j()},"VImg"),B=S()({name:"VImg",directives:{intersect:F},props:R(),emits:{loadstart:e=>!0,load:e=>!0,error:e=>!0},setup(r,v){let{emit:g,slots:p}=v;const m=b("VImg"),S=t(""),f=a(),z=t(r.eager?"loading":"idle"),j=t(),F=t(),R=n((()=>r.src&&"object"==typeof r.src?{src:r.src.src,srcset:r.srcset||r.src.srcset,lazySrc:r.lazySrc||r.src.lazySrc,aspect:Number(r.aspectRatio||r.src.aspect||0)}:{src:r.src,srcset:r.srcset,lazySrc:r.lazySrc,aspect:Number(r.aspectRatio||0)})),B=n((()=>R.value.aspect||j.value/F.value||0));function init(e){if(!r.eager||!e){if(z.value="loading",R.value.lazySrc){const e=new Image;e.src=R.value.lazySrc,pollForSize(e,null)}R.value.src&&o((()=>{var e;g("loadstart",(null==(e=f.value)?void 0:e.currentSrc)||R.value.src),setTimeout((()=>{var e;if(!m.isUnmounted)if(null==(e=f.value)?void 0:e.complete){if(f.value.naturalWidth||onError(),"error"===z.value)return;B.value||pollForSize(f.value,null),"loading"===z.value&&onLoad()}else B.value||pollForSize(f.value),getSrc()}))}))}}function onLoad(){var e;m.isUnmounted||(getSrc(),pollForSize(f.value),z.value="loaded",g("load",(null==(e=f.value)?void 0:e.currentSrc)||R.value.src))}function onError(){var e;m.isUnmounted||(z.value="error",g("error",(null==(e=f.value)?void 0:e.currentSrc)||R.value.src))}function getSrc(){const e=f.value;e&&(S.value=e.currentSrc||e.src)}i((()=>r.src),(()=>{init("idle"!==z.value)})),i(B,((e,r)=>{!e&&r&&f.value&&pollForSize(f.value)}));let I=-1;function pollForSize(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;const poll=()=>{if(clearTimeout(I),m.isUnmounted)return;const{naturalHeight:l,naturalWidth:t}=e;l||t?(j.value=t,F.value=l):e.complete||"loading"!==z.value||null==r?(e.currentSrc.endsWith(".svg")||e.currentSrc.startsWith("data:image/svg+xml"))&&(j.value=1,F.value=1):I=(void 0).setTimeout(poll,r)};poll()}const V=n((()=>({"v-img__img--cover":r.cover,"v-img__img--contain":!r.cover}))),__image=()=>{var l;if(!R.value.src||"idle"===z.value)return null;const t=e("img",{class:["v-img__img",V.value],style:{objectPosition:r.position},src:R.value.src,srcset:R.value.srcset,alt:r.alt,crossorigin:r.crossorigin,referrerpolicy:r.referrerpolicy,draggable:r.draggable,sizes:r.sizes,ref:f,onLoad:onLoad,onError:onError},null),a=null==(l=p.sources)?void 0:l.call(p);return e(MaybeTransition,{transition:r.transition,appear:!0},{default:()=>[s(a?e("picture",{class:"v-img__picture"},[a,t]):t,[[d,"loaded"===z.value]])]})},__preloadImage=()=>e(MaybeTransition,{transition:r.transition},{default:()=>[R.value.lazySrc&&"loaded"!==z.value&&e("img",{class:["v-img__img","v-img__img--preload",V.value],style:{objectPosition:r.position},src:R.value.lazySrc,alt:r.alt,crossorigin:r.crossorigin,referrerpolicy:r.referrerpolicy,draggable:r.draggable},null)]}),__placeholder=()=>p.placeholder?e(MaybeTransition,{transition:r.transition,appear:!0},{default:()=>[("loading"===z.value||"error"===z.value&&!p.error)&&e("div",{class:"v-img__placeholder"},[p.placeholder()])]}):null,__error=()=>p.error?e(MaybeTransition,{transition:r.transition,appear:!0},{default:()=>["error"===z.value&&e("div",{class:"v-img__error"},[p.error()])]}):null,__gradient=()=>r.gradient?e("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${r.gradient})`}},null):null,W=t(!1);{const e=i(B,(r=>{r&&(requestAnimationFrame((()=>{requestAnimationFrame((()=>{W.value=!0}))})),e())}))}return y((()=>{const t=h.filterProps(r);return s(e(h,l({class:["v-img",{"v-img--booting":!W.value},r.class],style:[{width:_("auto"===r.width?j.value:r.width)},r.style]},t,{aspectRatio:B.value,"aria-label":r.alt,role:r.alt?"img":void 0}),{additional:()=>e(u,null,[e(__image,null,null),e(__preloadImage,null,null),e(__gradient,null,null),e(__placeholder,null,null),e(__error,null,null)]),default:p.default}),[[c("intersect"),{handler:init,options:r.options},null,{once:!0}]])})),{currentSrc:S,image:f,state:z,naturalWidth:j,naturalHeight:F}}});export{F as I,MaybeTransition as M,B as V,h as a,j as m};
