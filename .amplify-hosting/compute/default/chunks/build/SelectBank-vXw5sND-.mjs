import{useSSRContext as e,defineComponent as a,ref as l,computed as r,watch as t,mergeProps as n,createSlots as u,withCtx as s,createTextVNode as o,toDisplayString as i,createVNode as d,openBlock as m,createBlock as c,createCommentVNode as f,readonly as v}from"vue";import{ssrRenderComponent as p,ssrInterpolate as k}from"vue/server-renderer";import{_ as h,U as _,u as y}from"./server.mjs";import{V as b}from"./VSelect-BWLkvD3S.mjs";import{V as g,a as w}from"./VListItem-jTLuICGb.mjs";import{V as B}from"./VAvatar-JL8WKjry.mjs";import{V}from"./VImg-B2jcJjnn.mjs";import{V as x}from"./VDivider-BmyMVZMt.mjs";const S=a({__name:"SelectBank",__ssrInlineRender:!0,props:{modelValue:{},banks:{},label:{default:"Choose a bank"},placeholder:{default:"Type to search..."},disabled:{type:Boolean,default:!1},countryId:{},hint:{},errorMessage:{},searchable:{type:Boolean,default:!0},showLogo:{type:Boolean,default:!0},loadOnMount:{type:Boolean,default:!0},searchDelay:{default:300}},emits:["update:modelValue","search","load-more","error"],setup(e,{emit:a}){const h=e,S=a,L=h.banks?null:(()=>{const{$axios:e}=y(),a=l([]),t=l(!1),n=l(null),u=l(""),s=l(0),o=l(!1),i=r((()=>{if(!u.value)return a.value;const e=u.value.toLowerCase();return a.value.filter((a=>a.name.toLowerCase().includes(e)))})),searchBanks=async(l={})=>{var r,u;t.value=!0,n.value=null;try{const r=new URLSearchParams;l.search&&r.append("search",l.search),l.country_id&&r.append("country_id",l.country_id.toString()),l.limit&&r.append("limit",l.limit.toString()),l.offset&&r.append("offset",l.offset.toString());const t=await e.get(`/api/banks/search?${r.toString()}`);return l.offset&&0!==l.offset?a.value.push(...t.data.banks||[]):a.value=t.data.banks||[],s.value=t.data.total||0,o.value=t.data.has_more||!1,t.data}catch(e){throw n.value=(null==(u=null==(r=e.response)?void 0:r.data)?void 0:u.message)||"Error searching banks",console.error("Error searching banks:",e),e}finally{t.value=!1}},fetchBanks=async(e={})=>await searchBanks(e);let d;return{banks:v(a),loading:v(t),error:v(n),searchQuery:v(u),totalCount:v(s),hasMore:v(o),filteredBanks:i,fetchBanks:fetchBanks,searchBanks:searchBanks,loadMoreBanks:async(e={})=>{if(t.value||!o.value)return;const l=a.value.length;return await searchBanks({...e,offset:l})},clearSearch:()=>{u.value="",a.value=[],s.value=0,o.value=!1,n.value=null},debouncedSearch:(e,a=300)=>{clearTimeout(d),u.value=e,d=setTimeout((async()=>{e.trim()?await searchBanks({search:e,limit:50}):await fetchBanks({limit:50})}),a)},getBankById:e=>a.value.find((a=>a.id===e))}})(),$=l(h.modelValue||null),j=l(""),C=r((()=>{if(h.banks){if(!j.value)return h.banks;const e=j.value.toLowerCase();return h.banks.filter((a=>a.name.toLowerCase().includes(e)))}return(null==L?void 0:L.filteredBanks.value)||[]})),z=r((()=>(null==L?void 0:L.loading.value)||!1)),I=r((()=>!h.banks&&(null==L?void 0:L.hasMore.value)&&!z.value)),M=r((()=>!h.banks&&L&&(L.totalCount.value>0||L.error.value))),D=r((()=>{if(!L)return"";if(L.error.value)return`Error: ${L.error.value}`;const e=L.totalCount.value,a=L.banks.value.length;return j.value?`Found ${C.value.length} of ${e} banks`:`Showing ${a} of ${e} banks`})),handleSearch=e=>{j.value=e,S("search",e),!h.banks&&L&&h.searchable&&L.debouncedSearch(e,h.searchDelay)},loadMore=async()=>{if(L&&!h.banks)try{S("load-more"),await L.loadMoreBanks({search:j.value||void 0,country_id:h.countryId})}catch(e){S("error",e.message||"Failed to load more banks")}},emitBank=e=>{$.value=e,S("update:modelValue",e)};return t((()=>h.modelValue),(e=>{$.value=e})),t((()=>h.countryId),(e=>{!h.banks&&L&&(L.clearSearch(),L.fetchBanks({country_id:e,limit:50}))})),(e,a,l,r)=>{a(p(b,n({label:e.label,items:C.value,"item-value":"id","item-title":"name",modelValue:$.value,"onUpdate:modelValue":[e=>$.value=e,emitBank],"onUpdate:search":handleSearch,dense:"","return-object":"",clearable:"",loading:z.value,disabled:e.disabled||z.value,placeholder:e.placeholder,"error-messages":e.errorMessage,hint:e.hint,"persistent-hint":!!e.hint,autocomplete:"","menu-props":{maxHeight:300}},r),u({item:s((({props:e,item:a},l,r,t)=>{if(!l)return[d(g,e,u({default:s((()=>[d(w,null,{default:s((()=>[o(i(a.raw.name),1)])),_:2},1024)])),_:2},[a.raw.logo_url?{name:"prepend",fn:s((()=>[d(B,{size:"24",class:"mr-2"},{default:s((()=>[d(V,{src:a.raw.logo_url,alt:a.raw.name},null,8,["src","alt"])])),_:2},1024)])),key:"0"}:void 0]),1040)];l(p(g,e,u({default:s(((e,l,r,t)=>{if(!l)return[d(w,null,{default:s((()=>[o(i(a.raw.name),1)])),_:2},1024)];l(p(w,null,{default:s(((e,l,r,t)=>{if(!l)return[o(i(a.raw.name),1)];l(`${k(a.raw.name)}`)})),_:2},r,t))})),_:2},[a.raw.logo_url?{name:"prepend",fn:s(((e,l,r,t)=>{if(!l)return[d(B,{size:"24",class:"mr-2"},{default:s((()=>[d(V,{src:a.raw.logo_url,alt:a.raw.name},null,8,["src","alt"])])),_:2},1024)];l(p(B,{size:"24",class:"mr-2"},{default:s(((e,l,r,t)=>{if(!l)return[d(V,{src:a.raw.logo_url,alt:a.raw.name},null,8,["src","alt"])];l(p(V,{src:a.raw.logo_url,alt:a.raw.name},null,r,t))})),_:2},r,t))})),key:"0"}:void 0]),r,t))})),_:2},[M.value?{name:"prepend-item",fn:s(((e,a,l,r)=>{if(!a)return[d(g,{class:"text-caption text-medium-emphasis"},{default:s((()=>[d(w,null,{default:s((()=>[o(i(D.value),1)])),_:1})])),_:1}),d(x)];a(p(g,{class:"text-caption text-medium-emphasis"},{default:s(((e,a,l,r)=>{if(!a)return[d(w,null,{default:s((()=>[o(i(D.value),1)])),_:1})];a(p(w,null,{default:s(((e,a,l,r)=>{if(!a)return[o(i(D.value),1)];a(`${k(D.value)}`)})),_:1},l,r))})),_:1},l,r)),a(p(x,null,null,l,r))})),key:"0"}:void 0,I.value?{name:"append-item",fn:s(((e,a,l,r)=>{if(!a)return[d(x),d(g,{onClick:loadMore,disabled:z.value},{default:s((()=>[d(w,{class:"text-center text-primary"},{default:s((()=>[z.value?(m(),c(_,{key:0,size:"16",indeterminate:""})):(m(),c("span",{key:1},"Load more banks..."))])),_:1})])),_:1},8,["disabled"])];a(p(x,null,null,l,r)),a(p(g,{onClick:loadMore,disabled:z.value},{default:s(((e,a,l,r)=>{if(!a)return[d(w,{class:"text-center text-primary"},{default:s((()=>[z.value?(m(),c(_,{key:0,size:"16",indeterminate:""})):(m(),c("span",{key:1},"Load more banks..."))])),_:1})];a(p(w,{class:"text-center text-primary"},{default:s(((e,a,l,r)=>{if(!a)return[z.value?(m(),c(_,{key:0,size:"16",indeterminate:""})):(m(),c("span",{key:1},"Load more banks..."))];z.value?a(p(_,{size:"16",indeterminate:""},null,l,r)):a(`<span data-v-7f4ff898${r}>Load more banks...</span>`)})),_:1},l,r))})),_:1},l,r))})),key:"1"}:void 0,$.value?{name:"selection",fn:s((({item:e},a,l,r)=>{if(!a)return[d("div",{class:"d-flex align-center"},[$.value.logo_url?(m(),c(B,{key:0,size:"20",class:"mr-2"},{default:s((()=>[d(V,{src:$.value.logo_url,alt:$.value.name},null,8,["src","alt"])])),_:1})):f("",!0),d("span",null,i($.value.name),1)])];a(`<div class="d-flex align-center" data-v-7f4ff898${r}>`),$.value.logo_url?a(p(B,{size:"20",class:"mr-2"},{default:s(((e,a,l,r)=>{if(!a)return[d(V,{src:$.value.logo_url,alt:$.value.name},null,8,["src","alt"])];a(p(V,{src:$.value.logo_url,alt:$.value.name},null,l,r))})),_:2},l,r)):a("\x3c!----\x3e"),a(`<span data-v-7f4ff898${r}>${k($.value.name)}</span></div>`)})),key:"2"}:void 0]),l))}}}),L=S.setup;S.setup=(a,l)=>{const r=e();return(r.modules||(r.modules=new Set)).add("components/forms/select/SelectBank.vue"),L?L(a,l):void 0};const $=h(S,[["__scopeId","data-v-7f4ff898"]]);export{$ as S};
