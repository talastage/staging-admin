import{d as r,u as s,a as e}from"./server.mjs";import{useRouter as t}from"vue-router";const a=r("register",{state:()=>({step:"contact-info",email:"",firstName:"",lastName:"",displayName:"",gender:"",country:null,birthday:"",password:"",userId:null,isVerificationSent:!1,isSocialRegistration:!1,socialUserId:null,socialData:null,errors:{email:"",first_name:"",last_name:"",display_name:"",gender:"",country_id:"",birthday:"",password:"",verification_code:""}}),getters:{hasErrors:r=>Object.values(r.errors).some((r=>""!==r)),formData:r=>{var s;return{email:r.email,first_name:r.firstName,last_name:r.lastName,display_name:r.displayName,gender:r.gender,country_id:null==(s=r.country)?void 0:s.id,birthday:r.birthday,password:r.password}}},actions:{setStep(r){this.step=r},async registerEmail(){const{$axios:r}=s();try{const s=await r.post("/api/register/contact-info",{email:this.email});return this.userId=s.data.user_id,this.clearErrors(),(s.data.message.includes("resent")||s.data.incomplete_registration)&&this.setStep("verification"),s.data}catch(r){throw this.handleError(r),r}},async verifyCode(r){const{$axios:e}=s();try{const s=await e.post("/api/register/verify-code",{email:this.email,code:r});return this.setStep("personal-info"),this.clearErrors(),s.data}catch(r){throw this.handleError(r),r}},async resendVerificationCode(){const{$axios:r}=s();try{const s=await r.post("/api/register/resend-code",{email:this.email});return this.clearErrors(),s.data}catch(r){throw this.handleError(r),r}},async completeRegistration(r){try{const r=await this.registerPersonalInfo();return this.clearErrors(),r}catch(r){throw this.handleError(r),r}},async registerPersonalInfo(){var r;const{$axios:a}=s();t();const i=e();try{if(!this.validatePersonalInfo())throw new Error("Please check the form for errors");const s=await a.post("/api/register/personal-info",{user_id:this.userId,first_name:this.firstName,last_name:this.lastName,display_name:this.displayName||null,gender:this.gender,country_id:null==(r=this.country)?void 0:r.id,birthday:this.birthday,password:this.password});return this.clearErrors(),s.data.user&&s.data.token&&await i.handleRegistrationSuccess({user:s.data.user,token:s.data.token}),s.data}catch(r){throw this.handleError(r),r}},handleError(r){if(!r.response)throw r.message?new Error(r.message):new Error("An unexpected error occurred");if(422===r.response.status){const s=r.response.data.errors||{};if(this.clearErrors(),r.response.data.error)throw this.errors.email=r.response.data.error,new Error(r.response.data.error);const e={email:"email",country_id:"country_id",first_name:"first_name",last_name:"last_name",display_name:"display_name",gender:"gender",birthday:"birthday",password:"password"};Object.entries(s).forEach((([r,s])=>{const t=e[r];t&&(this.errors[t]=Array.isArray(s)?s[0]:s)})),s.age&&(this.errors.birthday="You must be at least 18 years old")}else if(r.response.data.error)throw this.errors.email=r.response.data.error,new Error(r.response.data.error)},clearErrors(){Object.keys(this.errors).forEach((r=>{this.errors[r]=""}))},setSocialRegistration(r){this.isSocialRegistration=r.isSocial,this.socialUserId=r.userId,this.socialData=r.socialData,r.socialData&&(this.firstName=r.socialData.first_name||"",this.lastName=r.socialData.last_name||"",this.email=r.socialData.email||"")},resetForm(){this.step="contact-info",this.email="",this.firstName="",this.lastName="",this.displayName="",this.gender="",this.country=null,this.birthday="",this.password="",this.userId=null,this.isVerificationSent=!1,this.isSocialRegistration=!1,this.socialUserId=null,this.socialData=null,this.clearErrors()},validateContactInfo(){this.clearErrors();let r=!0;return this.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email)||(this.errors.email="Please enter a valid email address",r=!1),r},validatePersonalInfo(){var r,s;this.clearErrors();let e=!0;if((null==(r=this.firstName)?void 0:r.trim())||(this.errors.first_name="First name is required",e=!1),(null==(s=this.lastName)?void 0:s.trim())||(this.errors.last_name="Last name is required",e=!1),this.gender||(this.errors.gender="Gender is required",e=!1),this.country||(this.errors.country_id="Country is required",e=!1),this.birthday||(this.errors.birthday="Birthday is required",e=!1),this.password){const r=[{condition:this.password.length>=8,message:"at least 8 characters"},{condition:/[a-z]/.test(this.password),message:"one lowercase letter"},{condition:/[A-Z]/.test(this.password),message:"one uppercase letter"},{condition:/\d/.test(this.password),message:"one number"},{condition:/[!@#$%^&*(),.?":{}|<>]/.test(this.password),message:"one special character"}].filter((r=>!r.condition));r.length>0&&(this.errors.password="Password must include "+r.map((r=>r.message)).join(", "),e=!1)}else this.errors.password="Password is required",e=!1;return this.displayName&&this.displayName.length>255&&(this.errors.display_name="Display name cannot exceed 255 characters",e=!1),e}}});export{a as u};
