import{d as t,u as e}from"./server.mjs";import{useRouter as o}from"vue-router";const l=t("talentCollections",{state:()=>({collections:[],isLoading:!1,error:null,lastFetchTime:0,activeCollection:null}),getters:{sortedCollections:t=>[...t.collections].sort(((t,e)=>new Date(e.updated_at).getTime()-new Date(t.updated_at).getTime())),getCollectionById:t=>e=>t.collections.find((t=>t.id===e)),isTalentInCollection:t=>(e,o)=>{const l=t.collections.find((t=>t.id===e));if(!l||!l.preview_talents)return!1;const n=null==o?void 0:o.toString();return!!n&&l.preview_talents.some((t=>t.username===n||t.id===o))}},actions:{async fetchCollections(t=!1){var o,l;if(!t&&this.collections.length>0&&Date.now()-this.lastFetchTime<3e5)return this.collections;this.isLoading=!0,this.error=null;try{const{$axios:t}=e(),o=await t.get("/api/talent/collections");return this.collections=o.data.data,this.lastFetchTime=Date.now(),this.collections}catch(t){throw this.error=(null==(l=null==(o=t.response)?void 0:o.data)?void 0:l.message)||"Failed to load collections",t}finally{this.isLoading=!1}},async fetchCollection(t){var o,l;try{const{$axios:o}=e(),l=await o.get(`/api/talent/collections/${t}`);return{collection:l.data.collection,talents:l.data.talents}}catch(t){throw this.error=(null==(l=null==(o=t.response)?void 0:o.data)?void 0:l.message)||"Failed to fetch collection",t}},async createCollection(t){var l,n,i,a,s;const{$axios:r}=e();if(o(),!t.trim())throw new Error("Collection name is required");if(this.collections.some((e=>e.name.toLowerCase()===t.toLowerCase())))throw new Error("A collection with this name already exists");try{const e=(await r.post("/api/talent/collections",{name:t})).data.data;return e&&e.id&&this.collections.unshift(e),e}catch(t){if((null==(l=t.response)?void 0:l.status)>=400)throw new Error((null==(i=null==(n=t.response)?void 0:n.data)?void 0:i.message)||"Failed to create collection");if(null==(s=null==(a=t.response)?void 0:a.data)?void 0:s.data)return t.response.data.data;throw t}},async updateCollection(t,o){var l,n;const{$axios:i}=e();if(!o.name.trim())throw new Error("Collection name is required");try{const e=(await i.put(`/api/talent/collections/${t}`,o)).data.data,l=this.collections.findIndex((e=>e.id===t));return-1!==l&&(this.collections[l]={...this.collections[l],...e}),e}catch(t){throw new Error((null==(n=null==(l=t.response)?void 0:l.data)?void 0:n.message)||"Failed to update collection")}},async deleteCollection(t){var o,l;try{const{$axios:o}=e();return await o.delete(`/api/talent/collections/${t}`),this.collections=this.collections.filter((e=>e.id!==t)),!0}catch(t){throw console.error("Failed to delete collection:",t),new Error((null==(l=null==(o=t.response)?void 0:o.data)?void 0:l.message)||"Failed to delete collection")}},async addTalentToCollection(t,o){var l,n,i,a;if(!o)throw new Error("Username is required");console.log("Store addTalentToCollection:",{collectionId:t,username:o});const{$axios:s}=e();try{const e=await s.post(`/api/talent/collections/${t}/talents`,{talent_id:o}),i=this.collections.find((e=>e.id===t));return i&&(i.talents_count++,e.data.talent&&(null==(l=i.preview_talents)?void 0:l.length)<4&&(null==(n=i.preview_talents)||n.unshift(e.data.talent))),e.data}catch(t){throw new Error((null==(a=null==(i=t.response)?void 0:i.data)?void 0:a.message)||"Failed to add talent to collection")}},async removeTalentFromCollection(t,o){var l,n;const{$axios:i}=e();try{await i.delete(`/api/talent/collections/${t}/talents/${o}`);const e=this.collections.find((e=>e.id===t));e&&(e.talents_count--,e.preview_talents&&(e.preview_talents=e.preview_talents.filter((t=>t.username!==o.toString()&&t.id!==o))))}catch(t){throw new Error((null==(n=null==(l=t.response)?void 0:l.data)?void 0:n.message)||"Failed to remove talent from collection")}},async reorderCollections(t){var o,l;const{$axios:n}=e();try{await n.post("/api/talent/collections/reorder",{collection_ids:t}),this.collections=t.map((t=>this.collections.find((e=>e.id===t)))).filter((t=>void 0!==t))}catch(t){throw new Error((null==(l=null==(o=t.response)?void 0:o.data)?void 0:l.message)||"Failed to reorder collections")}}}});export{l as u};
