import{n as q,j as f,c as W,t as P,l as Y,o as r,a as n,w as s,V as h,s as V,y as E,g as H,k as J,x as k,p as m,A as K,b as N,q as M,C as O,m as $,v as _}from"./CGQimWOm.js";import{V as Q}from"./CMsVONS5.js";import{B as Z}from"./COhe-ksk.js";import{u as ee}from"./CiN8dqd8.js";import{u as ae}from"./B3G4pkyN.js";import{u as te}from"./DMBY-Kaj.js";import{a as T,V as le,c as se}from"./BkTuXOR_.js";import{V as oe}from"./CiXMVmI4.js";import{V as j}from"./f5lwX8SZ.js";import{V as R}from"./P_q-BwEt.js";import{V as re}from"./GXZRJwQ4.js";const ne=q({__name:"EnterAmount",props:{modelValue:{type:Number,default:0},currencySymbol:{type:String,required:!0},max:{type:Number,default:Number.MAX_SAFE_INTEGER},min:{type:Number,default:0}},emits:["update:modelValue"],setup(C,{emit:D}){const l=C,g=D,I=f(null),u=f(""),b=f(""),o=W({get:()=>S(u.value),set:e=>{u.value=e.replace(/[^\d.]/g,""),w()}}),A=W(()=>{const e=parseFloat(u.value);return!isNaN(e)&&e>=l.min&&e<=l.max});P(()=>l.modelValue,x,{immediate:!0}),Y(()=>{x(l.modelValue)});function x(e){u.value=e.toString(),d(!1)}function S(e){if(!e)return"";const t=e.split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function w(){const e=parseFloat(u.value);isNaN(e)?g("update:modelValue",0):g("update:modelValue",e),d(!1)}function i(){const e=parseFloat(u.value);isNaN(e)?(u.value="0.00",g("update:modelValue",0)):(u.value=e.toFixed(2),g("update:modelValue",e)),d(!0)}function p(e){const t=e.target;t.setSelectionRange(0,t.value.length)}function d(e){const t=parseFloat(u.value);e&&isNaN(t)?b.value="Invalid amount":e&&t<l.min?b.value=`Amount too small (min: ${v(l.min)})`:e&&t>l.max?b.value=`Amount too large (max: ${v(l.max)})`:b.value=""}function v(e){return e.toLocaleString("en-US",{style:"currency",currency:"USD"}).replace("$",l.currencySymbol)}return(e,t)=>(r(),n(Q,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=F=>o.value=F),label:"Enter amount",prefix:C.currencySymbol,type:"text",class:"mb-4",outlined:"",dense:"","error-messages":b.value,onInput:w,onBlur:i,onFocus:p,ref_key:"input",ref:I},{append:s(()=>[A.value?(r(),n(h,{key:0,color:"success"},{default:s(()=>t[1]||(t[1]=[V("mdi-check-circle")])),_:1})):o.value&&!A.value?(r(),n(h,{key:1,color:"error"},{default:s(()=>t[2]||(t[2]=[V("mdi-alert-circle")])),_:1})):E("",!0)]),_:1},8,["modelValue","prefix","error-messages"]))}}),ue={class:"d-flex align-center justify-space-between mb-2"},ie={key:1,class:"text-body-2"},ce={class:"d-flex align-center justify-space-between"},me={key:1,class:"text-body-2 font-weight-bold text-success"},Ne=q({__name:"BalanceTransferDialog",props:{modelValue:{type:Boolean},availableBalance:{},currencySymbol:{},currencyCode:{},transferEndpoint:{}},emits:["update:modelValue","transfer-success"],setup(C,{emit:D}){const l=C,g=D,{$axios:I}=H(),u=te(),{currencyFormatter:b}=ae(),o=ee(),A=J(),x=W({get:()=>l.modelValue,set:c=>g("update:modelValue",c)}),S=f(null),w=f(!0),i=f(0),p=f(""),d=f(!1),v=f(!1),e=W(()=>i.value>0&&i.value<=l.availableBalance),t=c=>b(c,l.currencySymbol,l.currencyCode),F=()=>{x.value=!1,U()},U=()=>{i.value=0,p.value="",d.value=!1,v.value=!1,S.value&&S.value.resetValidation()};P(()=>l.modelValue,c=>{c&&(U(),L())});async function L(){!o.wallet&&!o.isFetching&&await o.fetchWallet()}function z(){A.push("/wallet/activate"),F()}async function G(){var c,a;if(e.value){d.value=!0,p.value="";try{await L();const y=await I.post(l.transferEndpoint,{amount:i.value,currency_code:l.currencyCode});if(!y.data.success)throw new Error(y.data.message||"Transfer failed");await o.fetchWallet(),g("transfer-success",i.value),v.value=!0,u.success("Transfer completed successfully")}catch(y){y instanceof Error?p.value=((a=(c=y.response)==null?void 0:c.data)==null?void 0:a.message)||y.message:p.value="Transfer failed. Please try again."}finally{d.value=!1}}}return(c,a)=>{const y=ne,X=Z;return r(),n(X,{modelValue:x.value,"onUpdate:modelValue":a[2]||(a[2]=B=>x.value=B),title:"Transfer to Wallet","max-width":"400px"},{default:s(()=>[k(o).isFetching?(r(),n(T,{key:0,class:"text-center py-6"},{default:s(()=>[m(K,{indeterminate:"",color:"primary",class:"mb-3"}),a[3]||(a[3]=N("p",{class:"text-body-2"},"Loading wallet...",-1))]),_:1})):k(o).isWalletActive?(r(),n(oe,{key:2,ref_key:"form",ref:S,modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=B=>w.value=B),onSubmit:O(G,["prevent"])},{default:s(()=>[m(T,{class:"pb-2"},{default:s(()=>[m(y,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=B=>i.value=B),"currency-symbol":c.currencySymbol,max:c.availableBalance,min:1,class:"mb-4"},null,8,["modelValue","currency-symbol","max"]),i.value>0?(r(),n(le,{key:0,variant:"outlined",class:"bg-surface-variant",elevation:"0"},{default:s(()=>[m(T,{class:"pa-3"},{default:s(()=>[N("div",ue,[a[7]||(a[7]=N("span",{class:"text-body-2"},"Current Wallet Balance",-1)),k(o).isFetching?(r(),n(j,{key:0,type:"text",width:"80",height:"16"})):(r(),$("span",ie,_(t(Number(k(o).currentBalance))),1))]),N("div",ce,[a[8]||(a[8]=N("span",{class:"text-body-2 font-weight-medium"},"New Wallet Balance",-1)),k(o).isFetching?(r(),n(j,{key:0,type:"text",width:"80",height:"16"})):(r(),$("span",me,_(t(Number(k(o).currentBalance)+i.value)),1))])]),_:1})]),_:1})):E("",!0),p.value?(r(),n(R,{key:1,type:"error",variant:"tonal",class:"mt-3",density:"compact"},{default:s(()=>[V(_(p.value),1)]),_:1})):E("",!0),v.value?(r(),n(R,{key:2,type:"success",variant:"tonal",class:"mt-3",density:"compact"},{default:s(()=>a[9]||(a[9]=[V(" Transfer completed successfully! ")])),_:1})):E("",!0)]),_:1}),m(se,{class:"pt-2"},{default:s(()=>[m(re),m(M,{variant:"text",onClick:F,disabled:d.value},{default:s(()=>a[10]||(a[10]=[V(" Cancel ")])),_:1},8,["disabled"]),m(M,{color:"primary",type:"submit",loading:d.value,disabled:!w.value||!e.value||v.value},{default:s(()=>[V(_(v.value?"Completed":"Transfer Now"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["modelValue"])):(r(),n(T,{key:1,class:"text-center py-6"},{default:s(()=>[m(h,{color:"warning",size:"48",class:"mb-3"},{default:s(()=>a[4]||(a[4]=[V("mdi-wallet-outline")])),_:1}),a[6]||(a[6]=N("p",{class:"text-body-1 mb-4"},"Your wallet is currently inactive.",-1)),m(M,{color:"primary",variant:"elevated",onClick:z},{default:s(()=>a[5]||(a[5]=[V(" Activate Wallet ")])),_:1})]),_:1}))]),_:1},8,["modelValue"])}}});export{Ne as _};
