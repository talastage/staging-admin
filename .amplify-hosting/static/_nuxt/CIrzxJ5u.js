import{_ as A}from"./Cxb8uY_z.js";import{_ as B}from"./DhC4yEL8.js";import{_ as $}from"./DxtVZjZE.js";import{f as I,g as f,n as V,c as _,o as c,m as d,F as h,D as C,b as S,p as m,w,a as v,O as j,v as P,bL as E,A as N,V as F,s as D,y as z,_ as Y}from"./CGQimWOm.js";import{V as k}from"./f5lwX8SZ.js";import{V as O}from"./tTgLLTve.js";import{V as U}from"./BRveoiXI.js";const q=I("projectCredits",{state:()=>({categoryGroups:[],isLoading:!1,error:null,page:1,hasMorePages:!0,perPage:16,totalMembers:0}),actions:{async fetchCredits(s,a=1){var e,r;this.isLoading=!0,this.error=null;const{$axios:o}=f();try{const{data:t}=await o.get(`/guest/projects/${s}/credits`,{params:{page:a,per_page:this.perPage}});return this.totalMembers=t.meta.total_members,this.hasMorePages=t.meta.current_page<t.meta.last_page,this.page=t.meta.current_page,a===1?this.categoryGroups=t.data:this.mergeNewGroups(t.data),t.data}catch(t){throw this.error=((r=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:r.message)||t.message,t}finally{this.isLoading=!1}},async addCredit(s,a){var e,r;this.isLoading=!0,this.error=null;const{$axios:o}=f();try{const{data:t}=await o.post(`/api/projects/${s}/credits`,a,{headers:{Accept:"application/json"}});return this.addCreditToState(t.data),t.data}catch(t){throw this.error=((r=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:r.message)||"Failed to add credit",t}finally{this.isLoading=!1}},async updateCredit(s,a,o){var r,t;this.isLoading=!0,this.error=null;const{$axios:e}=f();try{const{data:i}=await e.patch(`/api/projects/${s}/credits/${a}`,o,{headers:{Accept:"application/json"}});return this.updateCreditInState(i.data),i.data}catch(i){throw this.error=((t=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to update credit",i}finally{this.isLoading=!1}},async deleteCredit(s,a){var e,r;this.isLoading=!0,this.error=null;const{$axios:o}=f();try{return await o.delete(`/api/projects/${s}/credits/${a}`,{headers:{Accept:"application/json"}}),this.removeCreditFromState(a),!0}catch(t){throw this.error=((r=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:r.message)||"Failed to delete credit",t}finally{this.isLoading=!1}},addCreditToState(s){var r,t,i,u;const a=(t=(r=s.role)==null?void 0:r.category)==null?void 0:t.id,o=((u=(i=s.role)==null?void 0:i.category)==null?void 0:u.name)||"Uncategorized";let e=this.categoryGroups.find(g=>g.category.id===a);e?e.credits.unshift(s):this.categoryGroups.unshift({category:{id:a||0,name:o},credits:[s]}),this.totalMembers++},updateCreditInState(s){var a,o;for(const e of this.categoryGroups){const r=e.credits.findIndex(t=>t.id===s.id);if(r!==-1){const t=(o=(a=s.role)==null?void 0:a.category)==null?void 0:o.id,i=e.category.id;t!==i?(e.credits.splice(r,1),this.addCreditToState(s),this.totalMembers--,this.cleanupEmptyCategories()):e.credits[r]=s;break}}},removeCreditFromState(s){let a=!1;for(const o of this.categoryGroups){const e=o.credits.findIndex(r=>r.id===s);if(e!==-1){o.credits.splice(e,1),a=!0;break}}a&&(this.totalMembers=Math.max(0,this.totalMembers-1),this.cleanupEmptyCategories())},cleanupEmptyCategories(){this.categoryGroups=this.categoryGroups.filter(s=>s.credits.length>0)},mergeNewGroups(s){s.forEach(a=>{const o=this.categoryGroups.find(e=>e.category.id===a.category.id);if(o){const e=new Set(o.credits.map(t=>t.id)),r=a.credits.filter(t=>!e.has(t.id));o.credits.push(...r)}else this.categoryGroups.push(a)})},resetState(){this.categoryGroups=[],this.page=1,this.hasMorePages=!0,this.isLoading=!1,this.error=null,this.totalMembers=0}},getters:{getTotalCredits:s=>s.categoryGroups.reduce((a,o)=>a+o.credits.length,0),getCreditById:s=>a=>{for(const o of s.categoryGroups){const e=o.credits.find(r=>r.id===a);if(e)return e}return null},hasCredits:s=>s.getTotalCredits>0,getCreditsByCategory:s=>a=>{const o=s.categoryGroups.find(e=>e.category.id===a);return o?o.credits:[]},getAllCategories:s=>s.categoryGroups.map(a=>a.category)}}),H={class:"credits-container"},J={class:"text-h5 mb-4 category-title"},K={class:"credits-list"},Q={class:"text-center py-4"},R={key:1,class:"text-medium-emphasis"},W=V({__name:"ProjectCreditGrid",props:{isLoading:{type:Boolean},isLoadingMore:{type:Boolean},hasMore:{type:Boolean},showActions:{type:Boolean},showTipButton:{type:Boolean},emptyStateTitle:{},emptyStateMessage:{},showEmptyStateAction:{type:Boolean},emptyStateActionText:{}},emits:["delete-credit","edit-credit","empty-state-action","tip-complete","credit-click"],setup(s,{emit:a}){const o=s,e=a,r=(n,y)=>{e("credit-click",y)},t=n=>{e("edit-credit",n)},i=n=>{e("delete-credit",n)},u=q(),g=_(()=>u.categoryGroups),x=_(()=>o.emptyStateTitle||"No Cast & Crew Members Yet"),G=_(()=>o.emptyStateMessage||"This project doesn't have any members yet."),L=_(()=>o.showEmptyStateAction?{actionText:o.emptyStateActionText||"Add First Member",onActionClick:()=>e("empty-state-action")}:{});return(n,y)=>{const M=A,b=B,T=$;return c(),d("div",H,[n.isLoading&&!g.value.length?(c(),d(h,{key:0},C(2,l=>S("div",{key:`category-${l}`,class:"mb-8"},[m(k,{type:"heading",class:"mb-4",width:"200"}),m(U,null,{default:w(()=>[(c(),d(h,null,C(3,p=>m(O,{key:`credit-${l}-${p}`},{default:w(()=>[m(k,{type:"list-item-avatar-two-line",height:"84"})]),_:2},1024)),64))]),_:2},1024)])),64)):!n.isLoading&&!g.value.length?(c(),v(M,j({key:1,icon:"mdi-account-group-outline",title:x.value,message:G.value},L.value),null,16,["title","message"])):(c(),d(h,{key:2},[(c(!0),d(h,null,C(g.value,l=>(c(),d("div",{key:l.category.id,class:"category-group mb-8"},[S("h2",J,P(l.category.name),1),S("div",K,[(c(!0),d(h,null,C(l.credits,p=>(c(),v(T,{key:p.id,credit:p,variant:"compact","show-actions":n.showActions,class:"credit-list-item",onClick:r,onEdit:t,onDelete:i},E({_:2},[n.showTipButton?{name:"action",fn:w(()=>[m(b,{entity:p.user,"entity-type":"user",size:"small",onTransactionComplete:()=>e("tip-complete",p)},null,8,["entity","onTransactionComplete"])]),key:"0"}:void 0]),1032,["credit","show-actions"]))),128))])]))),128)),S("div",Q,[n.isLoadingMore?(c(),v(N,{key:0,indeterminate:"",color:"primary",size:"24"})):n.hasMore?z("",!0):(c(),d("div",R,[m(F,{icon:"mdi-check-circle",class:"mr-2"}),y[0]||(y[0]=D(" You've reached the end of the list "))]))])],64))])}}}),rt=Y(W,[["__scopeId","data-v-ea4f8d41"]]);export{rt as _,q as u};
