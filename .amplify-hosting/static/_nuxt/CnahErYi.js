import{_ as T}from"./BIU2l3Eu.js";import{_ as W,a as z}from"./8q_6vN0P.js";import{c as a,n as R,u as O,k as L,g as H,j as v,l as Y,B as G,o as j,a as $,w as b,x as _,y as J,m as K,p as P,F as Q,_ as X}from"./CGQimWOm.js";import{u as Z}from"./CvtmPE-9.js";import{u as ee}from"./D5wOIWMa.js";import{u as k}from"./CiN8dqd8.js";import{u as te}from"./DMBY-Kaj.js";import{u as re}from"./BW5EWlXk.js";import{u as ae}from"./D78L5r-E.js";import{V as oe}from"./f5lwX8SZ.js";import{a as ie,V as ne}from"./BkTuXOR_.js";import{V as le}from"./BhN2__aY.js";import"./CMsVONS5.js";import"./C-73ZGdz.js";import"./2hEmiBig.js";import"./BSH7BhKc.js";import"./BFmCCZJK.js";import"./Dg4qVXYX.js";import"./CjukEv2V.js";import"./C-GTDzx5.js";import"./DbQnG3uQ.js";import"./BRveoiXI.js";import"./tTgLLTve.js";import"./xvVMJZi9.js";import"./Dn0bXcU5.js";import"./BvtSni_j.js";import"./IpAEdaYr.js";import"./CW50LM9V.js";import"./DJ0NdY24.js";import"./ClFbrGXS.js";import"./D0h0WEJV.js";import"./DsvAftJq.js";import"./GXZRJwQ4.js";/* empty css        */import"./_WrfyJOJ.js";import"./Bem91KZK.js";import"./COhe-ksk.js";import"./BcH3Kywr.js";import"./DnYNupeP.js";import"./GjSan1Rr.js";import"./CS8xUUzH.js";import"./CRY4crBU.js";import"./CngyuRTk.js";import"./bFKGpjcd.js";import"./D9lJKT5N.js";import"./C2h-HXtC.js";import"./jRUxZAus.js";import"./DL649WMo.js";import"./P_q-BwEt.js";import"./CiXMVmI4.js";import"./DyYnZ78z.js";import"./DVrR1Kw7.js";import"./OJq0nmAj.js";import"./CFP_OpWO.js";import"./DcSlHAeh.js";import"./CE0NNlNx.js";import"./DoIi4J9g.js";import"./SDo9db-O.js";import"./Cw5ECwNl.js";import"./Cxb8uY_z.js";import"./CMYBLF1p.js";import"./BeQTM7t9.js";import"./3ysVR2RL.js";import"./Bz9a9m5j.js";import"./C9TGCd7W.js";import"./DjbnUXUR.js";import"./6HtF_owb.js";import"./DM0UXmJz.js";import"./De3D2xlH.js";import"./D4pNkYCe.js";import"./PJxxQmvY.js";import"./CIrzxJ5u.js";import"./DhC4yEL8.js";import"./CgwEN769.js";import"./BWXQ7vJw.js";import"./3SmzOII5.js";import"./BCoct7aH.js";import"./Bp2sYpJN.js";import"./B3G4pkyN.js";import"./DxtVZjZE.js";import"./CkOuN04m.js";import"./DyXR0ZQU.js";import"./Zmmmyk0F.js";import"./Rg_xdRgE.js";import"./dGPA57P0.js";import"./BxLb44po.js";import"./BEy3SeWo.js";import"./QtD4Idd3.js";import"./CYM4bMtk.js";import"./rtPmyJLL.js";function se(c){const s=k(),d=a(()=>{var m;if(!c.value||!c.value.currency||!c.value.currency.code||s.isFetching||!s.wallet)return"loading";if(!s.isWalletActive)return"error";const l=(m=s.wallet.data.currency.code)==null?void 0:m.trim().toUpperCase(),t=c.value.currency.code.trim().toUpperCase();return!l||!t?"loading":l!==t?"currencyMismatch":parseFloat(s.wallet.data.balance)>=c.value.amount?"sufficient":"insufficient"}),h=a(()=>d.value==="sufficient"),p=a(()=>d.value==="currencyMismatch"||d.value==="loading"||d.value==="error"?0:parseFloat(s.wallet.data.balance)-c.value.amount);return{status:d,isEligible:h,difference:p}}const pe=R({__name:"edit_draft",setup(c){const s=O(),d=L(),{$axios:h}=H(),p=te(),l=Z(),t=ee(),f=k(),m=re(),w=v(!0),C=v(1),u=v(!1),g=v(""),F=a(()=>{var e,r,o,n;return{amount:((r=(e=l.requirements)==null?void 0:e.premiering_fee)==null?void 0:r.amount)||0,currency:((n=(o=l.requirements)==null?void 0:o.premiering_fee)==null?void 0:n.currency)||{id:0,code:"",name:"",symbol:""}}}),x=a(()=>{var e;return((e=F.value.currency)==null?void 0:e.code)!==""}),E=a(()=>{var e;return`Premiering Payment - ${((e=t.project)==null?void 0:e.name)||"Project"}`}),D=a(()=>t.error),S=a(()=>s.params.access_uuid),i=a(()=>{var e;return((e=m.talastageApp)==null?void 0:e.name)||"TalaStage"}),{status:q}=se(F);Y(async()=>{var e,r,o;w.value=!0;try{await m.fetchTalaStageApp();const{data:n}=await h.get(`/api/studio/projects/${S.value}`);t.updateUploadStateFromProject(n),t.subscribeToProcessingUpdates();const y=(e=n.premiering_category)==null?void 0:e.slug;y&&!l.requirements&&await l.fetchRequirements(y),f.wallet||await f.fetchWallet(),t.error&&((r=t.project)==null?void 0:r.payment_status)!=="completed"?(g.value=t.error.toLowerCase().includes("insufficient")?"Insufficient Funds: Unable to charge your wallet":"Upload Error",u.value=!0):q.value==="insufficient"&&((o=t.project)==null?void 0:o.payment_status)!=="completed"&&(g.value="Insufficient Funds: Unable to charge your wallet",u.value=!0)}catch(n){console.error("Failed to load draft project or requirements:",n),p.error("Failed to load draft project or requirements")}finally{w.value=!1}}),G(()=>{t.cleanup()});function A(){p.success("Project setup completed!"),d.push("/studio/projects/manage-projects")}function I(e){var r;((r=t.project)==null?void 0:r.payment_status)!=="completed"&&(g.value=e.code==="CURRENCY_MISMATCH"?"Currency Mismatch":e.code==="INSUFFICIENT_FUNDS"?"Insufficient Funds: Unable to charge your wallet":E.value,p.warning(e.message),u.value=!0)}function M(){var e;((e=t.project)==null?void 0:e.payment_status)!=="completed"&&(g.value=E.value,u.value=!0,p.error("Payment failed. Please try again."))}const N=()=>{p.success("Payment processed successfully!"),u.value=!1,t.updateUploadStateFromProject(t.project),f.fetchWallet()},B=e=>{var r,o;console.error("Payment error:",e),p.error(((o=(r=e.response)==null?void 0:r.data)==null?void 0:o.message)||"Payment processing failed"),u.value=!0,t.updateUploadStateFromProject(t.project),f.fetchWallet()};return ae({title:a(()=>{var e;return(e=t.project)!=null&&e.name?`Edit Draft: ${t.project.name} - ${i.value}`:`Edit Draft - Project - ${i.value}`}),description:a(()=>{var e;return(e=t.project)!=null&&e.name?`Edit and finalize the draft for your project ${t.project.name} on ${i.value}.`:`Edit and finalize the draft details for your project on ${i.value}.`}),keywords:a(()=>{var e;return(e=t.project)!=null&&e.name?`${t.project.name}, edit project, draft, finalize, upload, ${i.value}`:`edit project, draft, finalize, upload, studio, ${i.value}`}),image:a(()=>{var e,r;return((e=m.talastageApp)==null?void 0:e.thumbnail_url)||((r=m.talastageApp)==null?void 0:r.logo_url)||"/default-project-edit-draft.png"}),type:"website",siteName:i,url:a(()=>`/studio/projects/${S.value}/edit_draft`),noIndex:!0,structuredDataFactory:()=>{var e,r,o,n;return{"@context":"https://schema.org","@type":"WebPage",name:(e=t.project)!=null&&e.name?`Edit Draft: ${t.project.name} - ${i.value}`:`Edit Draft - Project - ${i.value}`,description:(r=t.project)!=null&&r.name?`Edit and finalize the draft for your project ${t.project.name} on ${i.value}.`:`Edit and finalize the draft details for your project on ${i.value}.`,url:`/studio/projects/${S.value}/edit_draft`,isPartOf:{"@type":"CreativeWork",name:((o=t.project)==null?void 0:o.name)||"Project"},publisher:{"@type":"Organization",name:i.value,logo:{"@type":"ImageObject",url:((n=m.talastageApp)==null?void 0:n.logo_url)||"/default-thumbnail.png"}}}}}),(e,r)=>{const o=T,n=W,y=z;return j(),$(le,{fluid:"",class:"pa-0"},{default:b(()=>{var V;return[x.value&&((V=_(t).project)==null?void 0:V.payment_status)!=="completed"?(j(),$(o,{key:0,modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=U=>u.value=U),project:_(t).project,title:g.value,"error-message":D.value,onPaymentSuccess:N,onPaymentFailed:B},null,8,["modelValue","project","title","error-message"])):J("",!0),w.value?(j(),$(oe,{key:1,type:"card, list-item-three-line@4",class:"mb-6"})):(j(),K(Q,{key:2},[P(ne,{flat:"",class:"mb-6"},{default:b(()=>[P(ie,{class:"pa-6"},{default:b(()=>[P(n,{"requirements-data":_(l).formattedRequirements,onOpenPaymentDialog:I},null,8,["requirements-data"])]),_:1})]),_:1}),P(y,{modelValue:C.value,"onUpdate:modelValue":r[1]||(r[1]=U=>C.value=U),project:_(t).project,mode:"editDraft",onFinish:A,onPaymentFailed:M},null,8,["modelValue","project"])],64))]}),_:1})}}}),Ht=X(pe,[["__scopeId","data-v-223f8bc5"]]);export{Ht as default};
