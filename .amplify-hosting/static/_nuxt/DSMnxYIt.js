import{n as A,a3 as j,j as p,g as B,t as D,o as y,m as C,p as o,w as i,G as E,V as q,s as b,q as k,y as O,b as V,v as $,x as I,A as L,_ as N,i as R,a as G}from"./CGQimWOm.js";import{_ as M}from"./DVrR1Kw7.js";import{V as W}from"./BSH7BhKc.js";import{V as H}from"./xvVMJZi9.js";import{V as J,b as K,a as Q,c as X}from"./BkTuXOR_.js";import{V as Y}from"./BcH3Kywr.js";import{u as Z}from"./BRpmYQkE.js";import{u as ee}from"./CE0NNlNx.js";const ae={key:0,class:"camera-button-wrapper"},te={key:0},oe={key:1,class:"upload-progress-container"},le={class:"text-center"},se={key:2},re=A({__name:"ProfilePhoto",props:{photoUrl:{type:String,default:""},defaultPhotoUrl:{type:String,required:!0},size:{type:[Number,String],default:100},canEdit:{type:Boolean,default:!1},alt:{type:String,default:"Profile Photo"},dialogTitle:{type:String,default:"Edit Photo"},variant:{type:String,default:"flat"},color:{type:String,default:"transparent"},avatarClass:{type:String,default:""},containerClass:{type:String,default:""}},emits:["upload-photo","photo-updated","upload-success","upload-error"],setup(a,{expose:w,emit:S}){j(t=>({"075a7c76":a.size+"px"}));const d=a,P=S,f=p(null),m=p(!1),n=p(!1),l=p(!1),c=p(null),u=p(null),s=p(d.photoUrl||d.defaultPhotoUrl);B();const g={circular:!0};D(()=>d.photoUrl,t=>{s.value=t||d.defaultPhotoUrl});const v=()=>{s.value=d.defaultPhotoUrl},U=()=>{c.value.click()},x=t=>{const e=t.target.files[0];if(e){if(!e.type.startsWith("image/")){alert("Please select an image file");return}const h=new FileReader;h.onload=T=>{f.value=T.target.result,m.value=!0},h.readAsDataURL(e)}},r=()=>{l.value||(m.value=!1,f.value=null,l.value=!1,n.value=!1,c.value&&(c.value.value=""))},_=t=>{l.value=!1,s.value=t,r(),P("upload-success",t)},z=t=>{l.value=!1,n.value=!1,P("upload-error",t)},F=async()=>{if(u.value){n.value=!0;try{const t=u.value.getCroppedCanvas({width:300,height:300}),e=await new Promise(h=>t.toBlob(h,"image/jpeg",.8));l.value=!0,n.value=!1,P("upload-photo",{blob:e,croppedCanvas:t,onSuccess:_,onError:z})}catch(t){console.error("Error processing image:",t),alert("Failed to process image. Please try again."),n.value=!1}}};return w({handleUploadSuccess:_,handleUploadError:z}),(t,e)=>(y(),C("div",{class:E(["profile-photo-container",a.containerClass])},[o(H,{size:a.size,variant:a.variant,color:a.color,class:E(a.avatarClass)},{default:i(()=>[o(W,{src:s.value,alt:a.alt,cover:"",onError:v},null,8,["src","alt"])]),_:1},8,["size","variant","color","class"]),a.canEdit?(y(),C("div",ae,[o(k,{icon:"",density:"comfortable",variant:"flat",class:"camera-button",onClick:U},{default:i(()=>[o(q,{size:"16"},{default:i(()=>e[1]||(e[1]=[b("mdi-camera")])),_:1})]),_:1})])):O("",!0),V("input",{ref_key:"fileInput",ref:c,type:"file",accept:"image/*",style:{display:"none"},onChange:x},null,544),o(Y,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=h=>m.value=h),"max-width":"600px",persistent:""},{default:i(()=>[o(J,null,{default:i(()=>[o(K,null,{default:i(()=>[b($(a.dialogTitle),1)]),_:1}),o(Q,null,{default:i(()=>[f.value&&!l.value?(y(),C("div",te,[o(I(M),{ref_key:"cropper",ref:u,src:f.value,"aspect-ratio":1,"view-mode":1,style:{height:"400px",width:"100%"},"stencil-props":g},null,8,["src"])])):l.value?(y(),C("div",oe,[V("div",le,[o(L,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),e[2]||(e[2]=V("h3",{class:"mb-2"},"Uploading Photo...",-1)),e[3]||(e[3]=V("p",{class:"text-medium-emphasis"}," Please wait while your photo is being uploaded and processed. ",-1))])])):(y(),C("div",se,e[4]||(e[4]=[V("p",null,"Loading image...",-1)])))]),_:1}),o(X,{class:"justify-end"},{default:i(()=>[o(k,{color:"secondary",text:"",onClick:r,disabled:l.value},{default:i(()=>e[5]||(e[5]=[b(" Cancel ")])),_:1},8,["disabled"]),o(k,{color:"primary",loading:n.value,onClick:F,disabled:l.value},{default:i(()=>e[6]||(e[6]=[b(" Apply ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],2))}}),ie=N(re,[["__scopeId","data-v-4a4fc3df"]]),ne=A({__name:"UserProfilePhoto",props:{user:{type:Object,required:!0},size:{type:[Number,String],default:100}},emits:["photo-updated"],setup(a,{emit:w}){var c;const S=a,d=w;B();const P=R(),{uploadFile:f}=ee(),m=async(u,s)=>await f(u,"/api/profile/photo-upload-url","/api/profile/confirm-photo-upload",{onProgress:s}),{isProfileOwner:n}=Z((c=S.user)==null?void 0:c.username),l=async({blob:u,onSuccess:s,onError:g,onProgress:v})=>{var U,x;try{const r=await m(u,v);P.updateUser(r.user),s&&s(r.user.profile_photo),d("photo-updated")}catch(r){console.error("Error uploading image:",r),g&&g(r);const _=((x=(U=r.response)==null?void 0:U.data)==null?void 0:x.message)||r.message||"Failed to upload image. Please try again.";alert(_)}};return(u,s)=>{var v;const g=ie;return y(),G(g,{photoUrl:a.user.profile_photo,defaultPhotoUrl:"/images/profile/default.png",size:a.size,canEdit:I(n),alt:`${((v=a.user)==null?void 0:v.username)||"User"}'s profile photo`,dialogTitle:"Edit Profile Photo",avatarClass:"profile-avatar",containerClass:"user-profile-photo",onUploadPhoto:l},null,8,["photoUrl","size","canEdit","alt"])}}}),he=N(ne,[["__scopeId","data-v-ec383e79"]]);export{he as _};
