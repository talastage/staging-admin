import{_ as le}from"./D5iXKOLd.js";import{_ as Z,P as se,L as oe,i as re,j as f,c as m,o as I,a as S,w as a,p as t,V as C,b as n,s as d,C as T,x as i,q as g,v as z,m as ie,y as A,n as ne,l as ue}from"./CGQimWOm.js";import{u as de}from"./M9aAkXy6.js";import{m as me}from"./_H440M90.js";import{a as Q}from"./2hEmiBig.js";import{V as fe,d as pe,b as ve,e as ce,a as ye}from"./BkTuXOR_.js";import{V as ge,a as $}from"./D9lJKT5N.js";import{V as E}from"./CiXMVmI4.js";import{V as F}from"./DX-6Wr-O.js";import{a as be,V as Ve}from"./CngyuRTk.js";import{a as we}from"./DsvAftJq.js";import{V as X}from"./P_q-BwEt.js";import{V as Pe}from"./BhN2__aY.js";import{u as xe}from"./BW5EWlXk.js";import{u as Ne}from"./D78L5r-E.js";import"./QtD4Idd3.js";import"./rtPmyJLL.js";import"./xvVMJZi9.js";import"./BSH7BhKc.js";import"./DJ0NdY24.js";import"./CjukEv2V.js";import"./Dn0bXcU5.js";import"./Dg4qVXYX.js";import"./C-GTDzx5.js";import"./BFmCCZJK.js";import"./D0h0WEJV.js";/* empty css        */const Ce={class:"d-flex justify-center"},Ie={class:"text-center mt-6"},_e={class:"d-flex justify-center"},Se={class:"text-center mt-6"},ke={class:"text-body-1 text-center mb-6"},Re={class:"text-center mb-4"},Le={class:"d-flex justify-center"},Te={class:"text-center mt-6"},$e={key:0,class:"text-error text-center mb-4"},Ee={class:"d-flex justify-center"},Fe={__name:"WalletVerifyPinPage",setup(ee){var O,H;se(),oe();const s=de(),u=re(),l=f(null),v=f(null),P=f(null),k=f(null),c=f(1),x=f(""),b=f(""),V=f(""),N=f(""),_=f(""),q=f(0),R=f(!1),w=f(""),B=f("info"),M=m(()=>x.value.length===6),j=m(()=>V.value.length===6),U=m(()=>N.value.length===6&&_.value.length===6),h=m(()=>N.value&&_.value&&N.value!==_.value),D=m(()=>{var o,e;return me(b.value||((e=(o=u.user)==null?void 0:o.value)==null?void 0:e.email)||"")}),y=(o,e="info")=>{w.value=o,B.value=e,e==="success"&&setTimeout(()=>{w.value===o&&(w.value="")},5e3)},Y=async()=>{if(M.value)try{await s.verifyPin(x.value);const o="/wallet";window.location.href=o}catch(o){console.error("PIN verification error:",o),x.value=""}},G=async()=>{var L,r,J;s.authError="",w.value="";const o=b.value.trim().toLowerCase();if(console.log("Requesting reset for email:",o),!o){y("Email address is required","error");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)){y("Please enter a valid email address","error");return}try{const p=await s.requestPinReset(o);console.log("Reset request successful:",p),b.value=o,c.value=3,q.value++,R.value=!0,V.value="",y("Reset code sent to your email","success")}catch(p){console.error("Reset request error details:",{error:p,response:p.response,message:p.message,data:(L=p.response)==null?void 0:L.data});let W="Failed to send reset code";(J=(r=p.response)==null?void 0:r.data)!=null&&J.message?W=p.response.data.message:p.message&&p.message!=="Request failed with status code 400"&&(W=p.message),y(W,"error")}},K=async()=>{if(j.value)try{await s.verifyResetCode(b.value,V.value),c.value=4,y("Code verified successfully. Please set a new PIN.","success")}catch(o){console.error("Verify reset code error:",o),V.value=""}},te=async()=>{if(U.value){if(h.value){y("PINs do not match. Please try again.","error");return}try{await s.resetPin(b.value,V.value,N.value),y("Your PIN has been reset successfully","success"),setTimeout(()=>{x.value="",c.value=1},2e3)}catch(o){console.error("Reset PIN error:",o)}}},ae=()=>{R.value=!1,y("Reset code has expired. Please request a new one.","warning")};return(H=(O=u.user)==null?void 0:O.value)!=null&&H.email&&(b.value=u.user.value.email),(o,e)=>{const L=le;return I(),S(Pe,{class:"d-flex align-center justify-center",style:{"min-height":"80vh"}},{default:a(()=>[t(fe,{class:"mx-auto wallet-pin-card",elevation:"10","max-width":"500"},{default:a(()=>[t(pe,null,{default:a(()=>[t(ve,{class:"text-h4 font-weight-bold text-center mb-2"},{default:a(()=>[t(C,{icon:"mdi-wallet-outline",size:"36",color:"primary",class:"mb-2"}),e[11]||(e[11]=n("div",null,"Wallet Access",-1))]),_:1}),t(ce,{class:"text-center mb-6"},{default:a(()=>e[12]||(e[12]=[d(" Enter your security PIN to access your wallet ")])),_:1})]),_:1}),t(ye,null,{default:a(()=>[t(ge,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=r=>c.value=r),touch:!1},{default:a(()=>[t($,{value:1},{default:a(()=>[t(E,{onSubmit:T(Y,["prevent"]),ref_key:"pinForm",ref:l},{default:a(()=>[e[16]||(e[16]=n("p",{class:"text-body-1 text-center mb-4"}," Please enter your 6-digit wallet security PIN ",-1)),t(F,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=r=>x.value=r),length:6,type:"number",onFinish:Y,class:"mb-6","aria-label":"Security PIN input",disabled:i(s).isLoading,autofocus:"","hide-details":""},null,8,["modelValue","disabled"]),n("div",Ce,[t(g,{color:"primary",type:"submit",loading:i(s).isLoading,disabled:!M.value||i(s).isLoading,size:"large",class:"px-8"},{default:a(()=>[t(C,{start:""},{default:a(()=>e[13]||(e[13]=[d("mdi-lock-open")])),_:1}),e[14]||(e[14]=d(" Access Wallet "))]),_:1},8,["loading","disabled"])]),n("div",Ie,[t(g,{variant:"text",color:"primary",onClick:e[1]||(e[1]=r=>c.value=2),disabled:i(s).isLoading},{default:a(()=>e[15]||(e[15]=[d(" Forgot PIN? ")])),_:1},8,["disabled"])])]),_:1},512)]),_:1}),t($,{value:2},{default:a(()=>[t(E,{onSubmit:T(G,["prevent"]),ref_key:"resetForm",ref:v},{default:a(()=>[e[20]||(e[20]=n("p",{class:"text-h6 text-center mb-4"},"Reset Your Wallet PIN",-1)),e[21]||(e[21]=n("p",{class:"text-body-1 text-center mb-6"}," Enter your email address to receive a PIN reset code ",-1)),t(be,{modelValue:o.activationMethod,"onUpdate:modelValue":e[2]||(e[2]=r=>o.activationMethod=r),class:"mb-6",row:""},{default:a(()=>[t(Ve,{label:`Email (${D.value})`,value:"email",color:"primary","aria-label":"Verify with email"},null,8,["label"])]),_:1},8,["modelValue"]),n("div",_e,[t(g,{color:"primary",type:"submit",loading:i(s).isLoading,disabled:!b.value||i(s).isLoading,size:"large",class:"px-8"},{default:a(()=>[t(C,{start:""},{default:a(()=>e[17]||(e[17]=[d("mdi-email-outline")])),_:1}),e[18]||(e[18]=d(" Send Reset Code "))]),_:1},8,["loading","disabled"])]),n("div",Se,[t(g,{variant:"text",onClick:e[3]||(e[3]=r=>c.value=1),disabled:i(s).isLoading},{default:a(()=>e[19]||(e[19]=[d(" Back to PIN Entry ")])),_:1},8,["disabled"])])]),_:1},512)]),_:1}),t($,{value:3},{default:a(()=>[t(E,{onSubmit:T(K,["prevent"]),ref_key:"codeForm",ref:P},{default:a(()=>[e[28]||(e[28]=n("p",{class:"text-h6 text-center mb-4"},"Enter Reset Code",-1)),n("p",ke," We've sent a 6-digit code to your email ("+z(D.value)+") ",1),t(F,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=r=>V.value=r),length:6,type:"number",onFinish:K,class:"mb-4","aria-label":"Reset code input",disabled:i(s).isLoading,autofocus:""},null,8,["modelValue","disabled"]),n("div",Re,[t(we,{color:"info",variant:"outlined"},{default:a(()=>[t(C,{start:""},{default:a(()=>e[22]||(e[22]=[d("mdi-clock-outline")])),_:1}),e[23]||(e[23]=d(" Code expires in ")),(I(),S(L,{key:q.value,seconds:180,onFinished:ae}))]),_:1})]),n("div",Le,[t(g,{color:"primary",type:"submit",loading:i(s).isLoading,disabled:!j.value||i(s).isLoading,size:"large",class:"px-8"},{default:a(()=>[t(C,{start:""},{default:a(()=>e[24]||(e[24]=[d("mdi-check-circle")])),_:1}),e[25]||(e[25]=d(" Verify Code "))]),_:1},8,["loading","disabled"])]),n("div",Te,[t(g,{variant:"text",onClick:e[5]||(e[5]=r=>c.value=2),disabled:i(s).isLoading||R.value},{default:a(()=>e[26]||(e[26]=[d(" Back ")])),_:1},8,["disabled"]),t(g,{variant:"text",onClick:G,disabled:i(s).isLoading||R.value,class:"ms-4"},{default:a(()=>e[27]||(e[27]=[d(" Resend Code ")])),_:1},8,["disabled"])])]),_:1},512)]),_:1}),t($,{value:4},{default:a(()=>[t(E,{onSubmit:T(te,["prevent"]),ref_key:"newPinForm",ref:k},{default:a(()=>[e[31]||(e[31]=n("p",{class:"text-h6 text-center mb-4"},"Set New PIN",-1)),e[32]||(e[32]=n("p",{class:"text-body-1 text-center mb-6"}," Enter a new 6-digit security PIN for your wallet ",-1)),e[33]||(e[33]=n("p",{class:"text-subtitle-2 mb-2"},"New PIN",-1)),t(F,{modelValue:N.value,"onUpdate:modelValue":e[6]||(e[6]=r=>N.value=r),length:6,type:"number",class:"mb-4","aria-label":"New PIN input",disabled:i(s).isLoading,autofocus:""},null,8,["modelValue","disabled"]),e[34]||(e[34]=n("p",{class:"text-subtitle-2 mb-2"},"Confirm New PIN",-1)),t(F,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=r=>_.value=r),length:6,type:"number",class:"mb-6","aria-label":"Confirm PIN input",disabled:i(s).isLoading},null,8,["modelValue","disabled"]),h.value?(I(),ie("div",$e," PINs do not match. Please try again. ")):A("",!0),n("div",Ee,[t(g,{color:"primary",type:"submit",loading:i(s).isLoading,disabled:!U.value||i(s).isLoading,size:"large",class:"px-8"},{default:a(()=>[t(C,{start:""},{default:a(()=>e[29]||(e[29]=[d("mdi-lock-reset")])),_:1}),e[30]||(e[30]=d(" Reset PIN "))]),_:1},8,["loading","disabled"])])]),_:1},512)]),_:1})]),_:1},8,["modelValue"]),t(Q,null,{default:a(()=>[i(s).authError?(I(),S(X,{key:0,type:"error",variant:"tonal",class:"mt-4",density:"comfortable",border:"start",closable:"","onClick:close":e[9]||(e[9]=r=>i(s).authError="")},{default:a(()=>[d(z(i(s).authError),1)]),_:1})):A("",!0)]),_:1}),t(Q,null,{default:a(()=>[w.value?(I(),S(X,{key:0,type:B.value,variant:"tonal",class:"mt-4",density:"comfortable",border:"start",closable:"","onClick:close":e[10]||(e[10]=r=>w.value="")},{default:a(()=>[d(z(w.value),1)]),_:1},8,["type"])):A("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}},We=Z(Fe,[["__scopeId","data-v-53a968da"]]),ze=ne({__name:"verify-pin",setup(ee){const s=xe();ue(async()=>{await s.fetchTalaStageApp()});const u=m(()=>s.talastageApp);return Ne({title:m(()=>{var l;return`Verify Wallet PIN - ${((l=u.value)==null?void 0:l.name)||"TalaStage"}`}),description:m(()=>"Verify your TalaStage wallet PIN to authorize transactions and access secure features."),keywords:m(()=>{var l;return`wallet, verify pin, confirm pin, security, authorize, ${((l=u.value)==null?void 0:l.name)||"TalaStage"}`}),image:m(()=>{var l;return((l=u.value)==null?void 0:l.logo_url)||"/default-social-image.png"}),type:"website",siteName:m(()=>{var l;return((l=u.value)==null?void 0:l.name)||"TalaStage"}),url:m(()=>{var l;return`${((l=u.value)==null?void 0:l.canonical_url)||"https://talastage.com"}/wallet/verify-pin`}),canonical:m(()=>{var l;return`${((l=u.value)==null?void 0:l.canonical_url)||"https://talastage.com"}/wallet/verify-pin`}),noIndex:!0,openGraph:m(()=>{var l,v,P,k;return{title:`Verify Wallet PIN - ${((l=u.value)==null?void 0:l.name)||"TalaStage"}`,description:"Verify your TalaStage wallet PIN to authorize transactions and access secure features.",url:`${((v=u.value)==null?void 0:v.canonical_url)||"https://talastage.com"}/wallet/verify-pin`,image:((P=u.value)==null?void 0:P.logo_url)||"/default-social-image.png",siteName:((k=u.value)==null?void 0:k.name)||"TalaStage",type:"website"}}),twitter:m(()=>{var l,v;return{card:"summary_large_image",title:`Verify Wallet PIN - ${((l=u.value)==null?void 0:l.name)||"TalaStage"}`,description:"Verify your TalaStage wallet PIN to authorize transactions and access secure features.",image:((v=u.value)==null?void 0:v.logo_url)||"/default-social-image.png"}}),link:m(()=>{var l;return[{rel:"icon",href:((l=u.value)==null?void 0:l.favicon_url)||"/favicon.ico"}]})}),(l,v)=>{const P=We;return I(),S(P)}}}),dt=Z(ze,[["__scopeId","data-v-c47ee501"]]);export{dt as default};
