import{s as me}from"./rtPmyJLL.js";import{j as m,c as u,l as J,B as ee,o as V,m as L,v as x,f as pe,g as ve,z as se,_ as ae,k as fe,a as U,w as n,p as l,b as P,F as ge,D as we,s as h,y as S,C as ye,du as be,q as G,n as he,Q}from"./CGQimWOm.js";import{a as X,e as ke,V as Ve}from"./2hEmiBig.js";import{V as _e}from"./CRY4crBU.js";import{V as xe}from"./CS8xUUzH.js";import{V as Z,a as T}from"./DsvAftJq.js";import{V as H}from"./P_q-BwEt.js";import{V as Ce}from"./CiXMVmI4.js";import{V as Pe,a as F}from"./D9lJKT5N.js";import{V as A}from"./CMsVONS5.js";import{V as Re}from"./DX-6Wr-O.js";import{V as te}from"./BhN2__aY.js";import{u as Se}from"./BW5EWlXk.js";import{u as Te}from"./D78L5r-E.js";/* empty css        */import"./xvVMJZi9.js";import"./BSH7BhKc.js";import"./Dg4qVXYX.js";import"./C-GTDzx5.js";import"./DJ0NdY24.js";import"./CjukEv2V.js";import"./Dn0bXcU5.js";import"./C-73ZGdz.js";import"./BFmCCZJK.js";const Ee={__name:"TimeRemaining",props:{expiresIn:{type:Number,required:!0}},setup(C){const i=m(C.expiresIn*60),a=u(()=>{const w=Math.floor(i.value/60),p=i.value%60;return`${w}:${p.toString().padStart(2,"0")}`});let g;return J(()=>{g=me(()=>{i.value>0?i.value--:clearInterval(g)},1e3)}),ee(()=>{clearInterval(g)}),(w,p)=>(V(),L("span",null,x(a.value),1))}},Ie=pe("passwordReset",()=>{const{$axios:C}=ve(),r=se({resetToken:null,email:null,resetCode:null,isLoading:!1,error:null}),i=async c=>{var v,y;r.isLoading=!0,r.error=null;try{const o=await C.post("/auth/forgot-password",{email:c});return r.email=c,o.data}catch(o){throw r.error=((y=(v=o.response)==null?void 0:v.data)==null?void 0:y.message)||"Failed to send reset code",o}finally{r.isLoading=!1}},a=async(c,v)=>{var y,o;r.isLoading=!0,r.error=null;try{const f=await C.post("/auth/verify-reset-code",{email:c,code:v});return r.email=c,r.resetToken=f.data.reset_token,r.resetCode=v,f.data}catch(f){throw r.error=((o=(y=f.response)==null?void 0:y.data)==null?void 0:o.message)||"Failed to verify reset code",f}finally{r.isLoading=!1}},g=async(c,v,y=null)=>{var o,f;r.isLoading=!0,r.error=null;try{const k=y||r.resetToken;if(!k)throw new Error("No reset token available");const N=await C.post("/auth/reset-password",{email:c,new_password:v,reset_token:k});return w(),N.data}catch(k){throw r.error=((f=(o=k.response)==null?void 0:o.data)==null?void 0:f.message)||"Failed to reset password",k}finally{r.isLoading=!1}},w=()=>{r.resetToken=null,r.email=null,r.resetCode=null,r.error=null,r.isLoading=!1};return{state:r,sendResetCode:i,verifyResetCode:a,resetPassword:g,clearResetState:w,clearError:()=>{r.error=null},getResetToken:()=>r.resetToken,getEmail:()=>r.email,getResetCode:()=>r.resetCode,getIsLoading:()=>r.isLoading,getError:()=>r.error}}),$e={class:"d-flex flex-column align-center mb-6"},Le={class:"text-body-1 mb-4"},Ue={key:0,class:"text-caption mb-2"},Ne={key:1,class:"text-error text-caption mt-2"},qe={key:0,class:"mt-3"},Oe={__name:"PasswordResetPage",setup(C){const r=Ie(),i=fe(),a=m(1),g=m(""),w=m(""),p=m(""),O=m(""),_=m(!1),E=m(!1),I=m(!1),d=m(""),c=m(""),v=m({sent_to:"",destination:""}),y=m(null),o=se({email:[],code:[],new_password:[],reset_token:[],general:[]}),f=m(!1),k=m(!1),N=u(()=>/[A-Z]/.test(p.value)),M=u(()=>/[a-z]/.test(p.value)),j=u(()=>/[0-9]/.test(p.value)),B=u(()=>/[@$!%*#?&]/.test(p.value)),re=u(()=>p.value.length>=8),oe=u(()=>v.value.sent_to&&v.value.destination?`Enter the code we sent to your ${v.value.sent_to}: ${v.value.destination}`:"Enter the code we sent to your email address."),le=u(()=>{switch(a.value){case 1:return _.value?"Sending...":"Send Reset Code";case 2:return _.value?"Verifying...":"Verify Code";case 3:return _.value?"Resetting...":"Reset Password";default:return"Submit"}}),R={required:t=>!!t||"This field is required",email:t=>/.+@.+\..+/.test(t)||"Please enter a valid email address",passwordStrength:t=>t.length>=8&&N.value&&M.value&&j.value&&B.value||"Password must meet all requirements",passwordMatch:t=>t===p.value||"Passwords do not match"},z=t=>{o[t]&&(o[t]=[]),d.value&&(d.value="")},ne=()=>{d.value="",Object.keys(o).forEach(t=>{o[t]=[]})},ie=()=>{c.value=""},$=()=>{d.value="",c.value="",Object.keys(o).forEach(t=>{o[t]=[]})},W=t=>{var e;if($(),t.response){const{status:q,data:s}=t.response;if(q===422&&s.errors){Object.keys(s.errors).forEach(b=>{o.hasOwnProperty(b)&&(o[b]=s.errors[b])}),s.message&&s.message!=="The given data was invalid."&&(d.value=s.message);return}switch(q){case 400:s.errors&&Object.keys(s.errors).forEach(b=>{o.hasOwnProperty(b)&&(o[b]=s.errors[b])}),d.value=s.message||"Please check the information provided.",s.message&&s.message.includes("expired")&&setTimeout(()=>{a.value=1,$()},3e3);break;case 404:o.email=["We couldn't find an account with that email address."];break;case 429:o.email=((e=s.errors)==null?void 0:e.email)||["Too many attempts. Please wait before trying again."],d.value=s.message||"Please wait before making another request.";break;case 500:s.errors&&Object.keys(s.errors).forEach(b=>{o.hasOwnProperty(b)&&(o[b]=s.errors[b])}),d.value=s.message||"Something went wrong. Please try again later.";break;default:d.value=s.message||"An unexpected error occurred. Please try again later."}}else t.request?d.value="Network error. Please check your connection and try again.":d.value=t.message||"An unexpected error occurred. Please try again later."},Y=async()=>{if(I.value){_.value=!0,$();try{switch(a.value){case 1:await D();break;case 2:await ue();break;case 3:await de();break}}catch(t){W(t)}finally{_.value=!1}}},D=async()=>{try{const t=await r.sendResetCode(g.value);v.value={sent_to:t.sent_to,destination:t.destination},y.value=t.expires_in,c.value="Reset code sent successfully! Please check your email.",a.value=2}catch(t){throw t}},ue=async()=>{try{if(!(await r.verifyResetCode(g.value,w.value)).reset_token)throw new Error("Reset token not received from server");c.value="Code verified successfully!",a.value=3}catch(t){throw t}},de=async()=>{try{const t=r.state.resetToken;if(!t){d.value="Your session has expired. Please restart the process.",setTimeout(()=>{a.value=1,$()},3e3);return}await r.resetPassword(g.value,p.value,t),c.value="Your password has been reset successfully! Redirecting to login...",setTimeout(()=>{i.push("/login")},2e3)}catch(t){throw t}},ce=async()=>{E.value=!0,$();try{await D()}catch(t){W(t)}finally{E.value=!1}},K=t=>{t==="newPassword"?f.value=!f.value:t==="confirmPassword"&&(k.value=!k.value)};return ee(()=>{r.clearResetState()}),(t,e)=>{const q=Ee;return V(),U(te,{fluid:"",class:"fill-height bg-grey-lighten-4"},{default:n(()=>[l(_e,{"no-gutters":"",justify:"center",align:"center"},{default:n(()=>[l(xe,{cols:"12"},{default:n(()=>[P("div",$e,[e[12]||(e[12]=P("h1",{class:"text-h4 font-weight-bold text-center mb-2"}," Reset your password ",-1)),l(Z,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=s=>a.value=s),class:"mt-2","selected-class":"primary"},{default:n(()=>[(V(),L(ge,null,we(3,s=>l(T,{key:s,value:s,color:a.value>=s?"primary":"grey",size:"small",class:"mx-1"},{default:n(()=>[h(x(s),1)]),_:2},1032,["value","color"])),64))]),_:1},8,["modelValue"])]),l(X,null,{default:n(()=>[c.value?(V(),U(H,{key:0,type:"success",variant:"tonal",closable:"",class:"mb-4","onClick:close":ie},{default:n(()=>[h(x(c.value),1)]),_:1})):S("",!0)]),_:1}),l(X,null,{default:n(()=>[d.value?(V(),U(H,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-4","onClick:close":ne,density:"comfortable"},{default:n(()=>[h(x(d.value),1)]),_:1})):S("",!0)]),_:1}),l(Ce,{onSubmit:ye(Y,["prevent"]),modelValue:I.value,"onUpdate:modelValue":e[11]||(e[11]=s=>I.value=s)},{default:n(()=>[l(ke,null,{default:n(()=>[l(Pe,{modelValue:a.value,"onUpdate:modelValue":e[10]||(e[10]=s=>a.value=s)},{default:n(()=>[l(F,{value:1},{default:n(()=>[e[13]||(e[13]=P("h2",{class:"text-h6 mb-4"},"Enter your email address",-1)),l(A,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),type:"email",placeholder:"Enter your email address",rules:[R.required,R.email],"error-messages":o.email,onInput:e[2]||(e[2]=s=>z("email")),variant:"outlined","prepend-inner-icon":"mdi-email","persistent-placeholder":"",onKeyup:be(Y,["enter"])},null,8,["modelValue","rules","error-messages"])]),_:1}),l(F,{value:2},{default:n(()=>[e[15]||(e[15]=P("h2",{class:"text-h6 mb-4"},"Enter the verification code",-1)),P("p",Le,x(oe.value),1),y.value?(V(),L("p",Ue,[e[14]||(e[14]=h(" Code expires in ")),l(q,{"expires-in":y.value},null,8,["expires-in"])])):S("",!0),l(Re,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=s=>w.value=s),length:6,"error-messages":o.code,onInput:e[4]||(e[4]=s=>z("code")),type:"number",variant:"outlined",class:"mb-4"},null,8,["modelValue","error-messages"]),o.code&&o.code.length>0?(V(),L("div",Ne,x(o.code[0]),1)):S("",!0)]),_:1}),l(F,{value:3},{default:n(()=>[e[22]||(e[22]=P("h2",{class:"text-h6 mb-4"},"Create a new password",-1)),l(A,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=s=>p.value=s),placeholder:"Enter your new password",type:f.value?"text":"password","append-inner-icon":f.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[6]||(e[6]=s=>K("newPassword")),rules:[R.required,R.passwordStrength],"error-messages":o.new_password,onInput:e[7]||(e[7]=s=>z("new_password")),variant:"outlined","prepend-inner-icon":"mdi-lock","persistent-placeholder":"",class:"mb-3"},null,8,["modelValue","type","append-inner-icon","rules","error-messages"]),l(A,{modelValue:O.value,"onUpdate:modelValue":e[8]||(e[8]=s=>O.value=s),placeholder:"Confirm your new password",type:k.value?"text":"password","append-inner-icon":k.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[9]||(e[9]=s=>K("confirmPassword")),rules:[R.required,R.passwordMatch],variant:"outlined","prepend-inner-icon":"mdi-lock-check","persistent-placeholder":""},null,8,["modelValue","type","append-inner-icon","rules"]),l(Ve,null,{default:n(()=>[p.value?(V(),L("div",qe,[e[21]||(e[21]=P("p",{class:"text-caption mb-2"},"Password requirements:",-1)),l(Z,null,{default:n(()=>[l(T,{density:"comfortable",size:"small",color:N.value?"success":"error",variant:"tonal"},{default:n(()=>e[16]||(e[16]=[h(" Uppercase ")])),_:1},8,["color"]),l(T,{density:"comfortable",size:"small",color:M.value?"success":"error",variant:"tonal"},{default:n(()=>e[17]||(e[17]=[h(" Lowercase ")])),_:1},8,["color"]),l(T,{density:"comfortable",size:"small",color:j.value?"success":"error",variant:"tonal"},{default:n(()=>e[18]||(e[18]=[h(" Number ")])),_:1},8,["color"]),l(T,{density:"comfortable",size:"small",color:B.value?"success":"error",variant:"tonal"},{default:n(()=>e[19]||(e[19]=[h(" Special ")])),_:1},8,["color"]),l(T,{density:"comfortable",size:"small",color:re.value?"success":"error",variant:"tonal"},{default:n(()=>e[20]||(e[20]=[h(" 8+ chars ")])),_:1},8,["color"])]),_:1})])):S("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(G,{type:"submit",color:"primary",block:"",class:"mt-6",loading:_.value,disabled:!I.value||_.value,size:"large",elevation:"2"},{default:n(()=>[h(x(le.value),1)]),_:1},8,["loading","disabled"]),a.value===2?(V(),U(G,{key:0,variant:"text",block:"",class:"mt-2",onClick:ce,disabled:E.value||_.value},{default:n(()=>[h(x(E.value?"Sending...":"Resend Code"),1)]),_:1},8,["disabled"])):S("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}}},ze=ae(Oe,[["__scopeId","data-v-7aab3103"]]),Fe=he({__name:"reset",setup(C){const r=Se();J(async()=>{await r.fetchTalaStageApp()});const i=u(()=>r.talastageApp);return Te({title:u(()=>{var a;return(a=i.value)!=null&&a.name?`Password Reset - ${i.value.name}`:"Password Reset - TalaStage"}),description:u(()=>{var a;return`Reset your password to regain access to your ${((a=i.value)==null?void 0:a.name)||"TalaStage"} account.`}),keywords:"password reset, account recovery, TalaStage",image:u(()=>{var a;return((a=i.value)==null?void 0:a.logo_url)||"/default-password-reset-image.png"}),url:u(()=>`${Q().public.frontendUrl}/password/reset`),type:"website",siteName:u(()=>{var a;return((a=i.value)==null?void 0:a.name)||"TalaStage"}),twitterUsername:"@talastage",structured:{"@context":"https://schema.org","@type":"WebPage",name:u(()=>{var a;return(a=i.value)!=null&&a.name?`Password Reset - ${i.value.name}`:"Password Reset - TalaStage"}),description:u(()=>{var a;return`Reset your password to regain access to your ${((a=i.value)==null?void 0:a.name)||"TalaStage"} account.`}),url:u(()=>`${Q().public.frontendUrl}/password/reset`),publisher:{"@type":"Organization",name:u(()=>{var a;return((a=i.value)==null?void 0:a.name)||"TalaStage"}),logo:{"@type":"ImageObject",url:u(()=>{var a;return((a=i.value)==null?void 0:a.logo_url)||"/default-password-reset-image.png"})}}}}),(a,g)=>{const w=ze;return V(),U(te,{class:"password-reset-page"},{default:n(()=>[l(w)]),_:1})}}}),ds=ae(Fe,[["__scopeId","data-v-7de634bc"]]);export{ds as default};
