import{g as E,j as c,l as L,B,n as N,k as U,u as I,$ as z,Z as T,o as f,a as h,w as g,p as v,m as D,F as j,b as C,q as H,x as V,y as P,v as O,D as K,A as M,V as q,c as _,Q,_ as W}from"./CGQimWOm.js";import{u as Y}from"./CYM4bMtk.js";import{V as S}from"./CRY4crBU.js";import{V as R}from"./CS8xUUzH.js";import{V as Z}from"./P_q-BwEt.js";import{V as G}from"./xvVMJZi9.js";import{V as J}from"./BkTuXOR_.js";import{V as X}from"./BhN2__aY.js";import{u as ee}from"./BW5EWlXk.js";import{u as ae}from"./D78L5r-E.js";import{u as te}from"./CatCOsi_.js";import"./OJq0nmAj.js";/* empty css        */import"./BSH7BhKc.js";import"./BHJozufe.js";function re(){const{$axios:b,$protectedAction:x}=E(),u=c(null),a=c([]),s=c({show:!1,text:"",color:"success"}),m=t=>a.value.includes(t),o=(t,n="success")=>{s.value={show:!0,text:t,color:n}},y=async t=>{await x(async()=>{u.value=t.id;try{if(m(t.id)){const l=(await b.get("/api/premiering/reminders")).data.find(e=>e.project_id===t.id);l&&(await b.delete(`/api/premiering/reminders/${l.id}`),a.value=a.value.filter(e=>e!==t.id),o("Reminder removed"))}else{const n=new Date(t.premiere_start_date),l=new Date(n.getTime()-15*6e4);await b.post(`/api/premiering/reminders/${t.id}/reminders`,{reminder_time:l.toISOString()}),a.value.push(t.id),o("Reminder set successfully")}}finally{u.value=null}},{onError:n=>{console.error("Error toggling reminder:",n),o("Failed to update reminder","error")}})},d=async()=>{try{const t=await b.get("/api/premiering/reminders");a.value=t.data.map(n=>n.project_id)}catch(t){console.error("Error fetching reminders:",t)}},$=()=>{const{subscribeTo:t,unsubscribeFrom:n}=Y(),l=t("premieres");l==null||l.bind("reminder.updated",()=>{d()}),B(()=>{n("premieres")})};return L(()=>{d(),$()}),{reminderLoading:u,reminders:a,snackbar:s,hasReminder:m,handleReminderToggle:y,fetchReminders:d}}const se={class:"d-flex align-center mb-8"},oe={class:"text-h4"},ne=N({__name:"PremieresByCategoryPage",setup(b){const x=U(),u=I(),a=c(null),s=c([]),m=c(!1),o=c(!1),y=c(null),d=c(1),$=c(1),t=u.params.categorySlug,{reminderLoading:n,hasReminder:l,handleReminderToggle:e}=re(),r=async(A=1)=>{const p=A===1;p?m.value=!0:o.value=!0,y.value=null;try{const{data:i}=await E().$axios.get(`/api/projects/categories/${t}`,{params:{page:A}});p?(a.value={id:i.id,name:i.name,slug:i.slug,avatar_url:i.avatar_url},s.value=i.projects.data):s.value=[...s.value,...i.projects.data],d.value=i.pagination.current_page,$.value=i.pagination.last_page}catch(i){y.value="Failed to load category",console.error("Error fetching category:",i)}finally{p?m.value=!1:o.value=!1}},w=async()=>{window.innerHeight+window.scrollY>=document.body.offsetHeight-100&&d.value<$.value&&!m.value&&!o.value&&await r(d.value+1)};return z(()=>({title:a.value?`${a.value.name} Premieres`:"Loading...",meta:[{name:"description",content:a.value?`Watch live premieres in the ${a.value.name} category`:"Loading category premieres..."}]})),L(async()=>{await r(),window.addEventListener("scroll",w)}),B(()=>{window.removeEventListener("scroll",w)}),(A,p)=>{const i=T("CategoryDetailSkeleton"),F=T("ProjectPremiereCard");return f(),h(X,null,{default:g(()=>[m.value&&!a.value?(f(),h(i,{key:0})):y.value?(f(),h(S,{key:1},{default:g(()=>[v(R,{cols:"12"},{default:g(()=>[v(Z,{type:"error",text:y.value,class:"mb-4"},null,8,["text"])]),_:1})]),_:1})):a.value?(f(),D(j,{key:2},[C("div",se,[v(H,{icon:"mdi-arrow-left",variant:"text",class:"mr-4",onClick:p[0]||(p[0]=k=>V(x).back())}),a.value.avatar_url?(f(),h(G,{key:0,image:a.value.avatar_url,size:"48",class:"mr-4"},null,8,["image"])):P("",!0),C("h1",oe,O(a.value.name),1)]),v(S,null,{default:g(()=>[(f(!0),D(j,null,K(s.value,k=>(f(),h(R,{key:k.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:g(()=>[v(F,{premiere:k,hasReminder:V(l)(k.id),reminderLoading:V(n)===k.id,onReminderToggle:V(e)},null,8,["premiere","hasReminder","reminderLoading","onReminderToggle"])]),_:2},1024))),128))]),_:1}),o.value?(f(),h(S,{key:0,class:"mt-4"},{default:g(()=>[v(R,{cols:"12",class:"text-center"},{default:g(()=>[v(M,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):P("",!0),!s.value.length&&!m.value?(f(),h(S,{key:1},{default:g(()=>[v(R,{cols:"12"},{default:g(()=>[v(J,{class:"text-center pa-8"},{default:g(()=>[v(q,{size:"64",color:"grey-lighten-1",icon:"mdi-movie-open-off",class:"mb-4"}),p[1]||(p[1]=C("h3",{class:"text-h5 mb-2"},"No Premieres Available",-1)),p[2]||(p[2]=C("p",{class:"text-body-1 text-medium-emphasis"}," There are currently no premieres in this category ",-1))]),_:1})]),_:1})]),_:1})):P("",!0)],64)):P("",!0)]),_:1})}}}),le=N({__name:"[categorySlug]",setup(b){const x=I(),u=ee(),a=_(()=>x.params.categorySlug),s=c(null);L(async()=>{await u.fetchTalaStageApp(),await m()});const m=async()=>{if(a.value){const{get:e}=te();try{const r=await e(`/api/premieres/categories/${a.value}`);s.value=r.data}catch(r){console.error("Error fetching category data:",r),s.value={name:l(a.value.replace(/-/g," ")),seo_description:null,meta_keywords:null}}}else s.value=null},o=_(()=>{var e;return((e=u.talastageApp)==null?void 0:e.name)||"TalaStage"}),y=_(()=>{var e;return(e=s.value)!=null&&e.name?`Premieres in ${s.value.name} - ${o.value}`:`Premieres - ${o.value}`}),d=_(()=>{var e,r;return(e=s.value)!=null&&e.seo_description?s.value.seo_description:`Explore the latest premiered ${((r=a.value)==null?void 0:r.replace(/-/g," "))||"projects"} in the entertainment industry on ${o.value}.`}),$=_(()=>{var r,w;const e="premieres, entertainment, new releases, TalaStage";return(r=s.value)!=null&&r.meta_keywords?`${s.value.meta_keywords}, ${e}`:`${((w=a.value)==null?void 0:w.replace(/-/g,", "))||""}, ${e}`}),t=_(()=>`${Q().public.frontendUrl}/premieres/${a.value}`),n=_(()=>{var e,r;return((e=u.talastageApp)==null?void 0:e.thumbnail_url)||((r=u.talastageApp)==null?void 0:r.logo_url)||"https://talastage.com/default-thumbnail.png"});ae({title:y,description:d,keywords:$,image:n,type:"website",siteName:o,url:t,structured:_(()=>{var e;return{"@context":"https://schema.org","@type":"CollectionPage",name:y.value,description:d.value,url:t.value,publisher:{"@type":"Organization",name:o.value,logo:{"@type":"ImageObject",url:((e=u.talastageApp)==null?void 0:e.logo_url)||"https://talastage.com/default-thumbnail.png"}}}})});function l(e){return e.toLowerCase().split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}return(e,r)=>{const w=ne;return f(),h(w)}}}),xe=W(le,[["__scopeId","data-v-5229d1b7"]]);export{xe as default};
