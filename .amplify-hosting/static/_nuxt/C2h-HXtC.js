import{n as ve,c as y,o as D,m as A,b as S,v as H,p as o,w as f,F as fe,A as se,s as K,a as oe,V as G,y as ee,q as Z,_ as ue,dX as ze,g as De,j as x,l as Me,C as J,du as $e,t as ie,G as ce,J as Ze,x as Ye,a7 as me,ao as Je,ak as ea,dY as Se,aH as ge,aS as Y,aK as xe,dD as aa,a_ as ta,bn as Le,a8 as Be,aa as ye,as as la,aZ as Ie,aT as oa,ae as be,aN as le,ay as ra,a0 as de,aE as sa,a1 as he,dE as na,aC as ia,aX as Ve,b0 as ua,O as ca,B as da,cF as va,aM as ma}from"./CGQimWOm.js";import{_ as pa}from"./jRUxZAus.js";import{_ as Ne}from"./DL649WMo.js";import{u as Ae}from"./D5wOIWMa.js";import{b as ne,d as fa}from"./2hEmiBig.js";import{V as ha}from"./f5lwX8SZ.js";import{V as Fe}from"./P_q-BwEt.js";import{a as ga}from"./DsvAftJq.js";import{V as ya}from"./CiXMVmI4.js";import{V as Oe}from"./CMsVONS5.js";import{f as ba}from"./DyYnZ78z.js";import{_ as _a}from"./DVrR1Kw7.js";import{V as Ke}from"./BSH7BhKc.js";import{V as wa,a as ka,c as Sa}from"./BkTuXOR_.js";import{V as xa,a as Va}from"./CFP_OpWO.js";import{V as Ce}from"./GXZRJwQ4.js";import{V as Fa}from"./BvtSni_j.js";import{V as Ca}from"./BcH3Kywr.js";import{H as te}from"./DcSlHAeh.js";import{b as Ta,a as Pa,u as Ea,V as Te,d as ja}from"./Dg4qVXYX.js";import{u as Ua}from"./CE0NNlNx.js";import{V as Pe}from"./CS8xUUzH.js";import{V as Ra}from"./DoIi4J9g.js";import{V as za}from"./CRY4crBU.js";const Da={class:"project-detail-header d-flex align-center justify-space-between pa-4"},Ma={class:"project-name text-h6"},$a={class:"save-status-container"},La=ve({__name:"ProjectDetailSavedHeader",props:{projectName:{},isSaving:{type:Boolean},lastSavedAt:{},saveError:{}},setup(e){const t=e,v=y(()=>t.saveError?`Error: ${t.saveError}`:t.isSaving?"Saving...":t.lastSavedAt?`Saved ${F(t.lastSavedAt)}`:"All changes saved"),p=y(()=>t.saveError?"error":t.isSaving?"grey-lighten-1":"success-lighten-1"),F=l=>{const r=new Date().getTime()-l.getTime();return r<1e3?"just now":r<6e4?`${Math.floor(r/1e3)}s ago`:r<36e5?`${Math.floor(r/6e4)}m ago`:l.toLocaleTimeString()};return(l,n)=>(D(),A("div",Da,[S("div",Ma,H(l.projectName||"Untitled Project"),1),S("div",$a,[o(Z,{color:p.value,variant:"tonal",elevation:0,class:"save-status-btn",disabled:l.isSaving},{default:f(()=>[l.isSaving?(D(),A(fe,{key:0},[o(se,{indeterminate:"",size:"16",width:"2",color:"primary",class:"mr-2"}),n[0]||(n[0]=K(" Saving... "))],64)):(D(),A(fe,{key:1},[l.saveError?ee("",!0):(D(),oe(G,{key:0,icon:"mdi-check",size:"small",class:"mr-2"})),K(" "+H(v.value),1)],64))]),_:1},8,["color","disabled"])])]))}}),Ba=ue(La,[["__scopeId","data-v-36585f84"]]),Ee={USD:"$",KES:"KSh",UGX:"USh",TZS:"TSh",RWF:"RWF",BIF:"FBu",CDF:"FC",EUR:"€",GBP:"£",INR:"₹",CHF:"CHF",JPY:"¥",CAD:"C$",SEK:"kr",NOK:"kr",DKK:"kr",XDR:"XDR",MUR:"₨",ZMW:"ZK",GHS:"GH₵",BWP:"P",ZWL:"Z$",KMF:"CF",MZN:"MT",AOA:"Kz",SCR:"₨",MGA:"Ar",ETB:"Br",AED:"د.إ",AFN:"؋",AUD:"A$",ARS:"$"},Ia={key:0},Na={key:1},Aa={key:2,class:"watch-fee-container"},Oa={class:"d-flex flex-column mb-3"},Ka={class:"d-flex fee-input-group"},Wa={class:"d-none d-sm-block"},Ha=ve({__name:"ProjectWatchFeeSettings",props:{project:{}},setup(e){const t=e,v=ze(),{$axios:p}=De(),F=Ae(),l=x({amount:0,currency:{id:0,name:"",code:"",symbol:""}}),n=x(t.project.watch_fee?t.project.watch_fee.toString():""),r=y(()=>t.project.watch_fee!==null&&t.project.watch_fee!==""),i=x({default:!1,save:!1}),s=x({default:null,save:null}),E=y(()=>l.value.currency.code||"RWF"),b=y(()=>Ee[l.value.currency.code]||E.value),_=y(()=>{if(!l.value.amount)return null;const{amount:m,currency:d}=l.value;return`${Ee[d.code]||d.code}${m.toLocaleString()}`}),w=y(()=>{if(!n.value)return!1;const m=parseFloat(n.value);return!isNaN(m)&&m>=l.value.amount}),T=y(()=>{if(!n.value)return"Enter amount";const m=parseFloat(n.value);return isNaN(m)?"Please enter a valid number":m<l.value.amount?`Amount must be at least ${_.value}`:"Valid amount"});function C(m){if(!m)return"Amount is required";const d=parseFloat(m);return isNaN(d)?"Please enter a valid number":d<l.value.amount?`Amount must be at least ${_.value}`:!0}const j=ba(m=>{C(m)},300);function $(m){const d=m.replace(/\.(?=.*\.)/g,"").replace(/[^\d.]/g,"").replace(/(\.\d{2})\d+$/,"$1");n.value=d,j(d)}async function U(){i.value.default=!0,s.value.default=null;try{const m=await p.get("/api/default-amounts/default-watch-fee");m.data&&(l.value=m.data)}catch(m){console.error("Error fetching default watch fee:",m),s.value.default="Failed to fetch default watch fee",v.error("Failed to fetch default watch fee")}finally{i.value.default=!1}}async function R(){var m,d;if(w.value){i.value.save=!0,s.value.save=null;try{const u=await p.post(`/api/project-watch-fees/${t.project.access_uuid}`,{watch_fee:parseFloat(n.value),currency_id:l.value.currency.id});u.data.watch_fee&&(F.updateProject({watch_fee:u.data.watch_fee.amount,currency:u.data.watch_fee.currency}),v.success("Watch fee updated successfully"))}catch(u){console.error("Error saving watch fee:",u);const a=((d=(m=u.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to update watch fee";s.value.save=a,v.error(a)}finally{i.value.save=!1}}}const M=async()=>{s.value.default=null,await U()};return Me(async()=>{await U(),t.project.watch_fee&&(n.value=t.project.watch_fee.toString())}),(m,d)=>{const u=pa,a=Ne;return D(),oe(a,null,{default:f(()=>[i.value.default?(D(),A("div",Ia,[o(ha,{type:"article"})])):s.value.default||s.value.save?(D(),A("div",Na,[o(Fe,{type:"error",variant:"tonal",text:s.value.default||s.value.save},null,8,["text"]),o(Z,{color:"primary",variant:"text",onClick:M},{default:f(()=>d[1]||(d[1]=[K(" Retry Loading ")])),_:1})])):(D(),A("div",Aa,[S("div",Oa,[o(u,{size:"h6",tag:"h3",marginBottom:1,class:"d-flex align-center"},{default:f(()=>[o(G,{icon:"mdi-currency-usd",class:"mr-2",size:"small",color:"primary"}),d[3]||(d[3]=K(" Set Watch Fee ")),r.value?(D(),oe(ga,{key:0,color:"success",class:"ml-2",size:"x-small",variant:"flat"},{default:f(()=>d[2]||(d[2]=[K(" Set ")])),_:1})):ee("",!0)]),_:1}),d[4]||(d[4]=S("span",{class:"text-body-2 text-medium-emphasis"}," Define how much viewers will need to pay to watch your content ",-1))]),o(Fe,{color:"info",variant:"text",density:"compact",class:"mb-4 text-body-2 info-alert",border:"start"},{prepend:f(()=>[o(G,{size:"small",icon:"mdi-information"})]),default:f(()=>[S("span",null,[d[5]||(d[5]=K(" Minimum amount: ")),S("strong",null,H(_.value),1)])]),_:1}),o(ya,{onSubmit:J(R,["prevent"]),disabled:i.value.save},{default:f(()=>[S("div",Ka,[o(Oe,{modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=c=>n.value=c),type:"text",density:"compact",variant:"outlined",label:"Enter watch fee amount",rules:[C],prefix:b.value,hint:T.value,"error-messages":s.value.save,loading:i.value.save,"persistent-hint":"","hide-details":"auto",onInput:$,onKeyup:$e(R,["enter"]),class:"flex-grow-1"},{append:f(()=>[o(ne,null,{default:f(()=>[w.value?(D(),oe(G,{key:0,color:"success",size:"small",icon:"mdi-check-circle"})):ee("",!0)]),_:1})]),_:1},8,["modelValue","rules","prefix","hint","error-messages","loading"]),o(Z,{color:"primary",loading:i.value.save,disabled:!w.value,type:"submit",class:"ml-2 submit-btn",height:40},{default:f(()=>[S("span",Wa,H(r.value?"Update":"Set")+" Fee ",1),o(G,{icon:r.value?"mdi-update":"mdi-plus",size:"small",class:"d-sm-none"},null,8,["icon"])]),_:1},8,["loading","disabled"])])]),_:1},8,["disabled"])]))]),_:1})}}}),qa=ue(Ha,[["__scopeId","data-v-8530f6f2"]]),Ga=()=>{const e={maxFileSize:5242880,compressionThreshold:2097152,targetFileSize:1572864,maxDimension:1920,minQuality:.5,startQuality:.9},t=l=>new Promise((n,r)=>{const i=new Image;i.onload=()=>{n({width:i.width,height:i.height,type:l.type}),URL.revokeObjectURL(i.src)},i.onerror=()=>{URL.revokeObjectURL(i.src),r(new Error("Failed to load image for metadata extraction"))},i.src=URL.createObjectURL(l)}),v=async(l,n={})=>{const r={...e,...n},i=l.size,s=E=>{r.progressCallback&&r.progressCallback(E)};if(s(10),l.size<=r.compressionThreshold)return s(100),{compressed:l,originalSize:i,compressedSize:i,compressionRatio:1,wasCompressed:!1};if(l.size>r.maxFileSize)throw new Error(`File size exceeds maximum allowed size of ${r.maxFileSize/(1024*1024)}MB`);return s(20),new Promise((E,b)=>{const _=new Image,w=document.createElement("canvas"),T=w.getContext("2d");_.onload=async()=>{try{s(30);let{width:C,height:j}=_;const $={width:C,height:j};(C>r.maxDimension||j>r.maxDimension)&&(C>j?(j=Math.round(j*r.maxDimension/C),C=r.maxDimension):(C=Math.round(C*r.maxDimension/j),j=r.maxDimension)),s(40),w.width=C,w.height=j,T.drawImage(_,0,0,C,j),s(50);let U=r.startQuality,R=w.toDataURL("image/jpeg",U);const M=5;let m=0;for(;R.length>r.targetFileSize*1.37&&U>r.minQuality;)m++,U=Math.max(r.minQuality,r.startQuality-m*(r.startQuality-r.minQuality)/M),R=w.toDataURL("image/jpeg",U),s(50+Math.min(40,m/M*40));s(90);const u=await(await fetch(R)).blob();s(100),E({compressed:u,originalSize:i,compressedSize:u.size,compressionRatio:u.size/i,wasCompressed:!0,dimensions:{width:C,height:j}})}catch(C){b(C)}},_.onerror=()=>b(new Error("Failed to load image")),_.src=URL.createObjectURL(l)})};return{compressImage:v,analyzeImage:async l=>{const n=await t(l),r=l.size/(1024*1024);return{dimensions:{width:n.width,height:n.height},aspectRatio:parseFloat((n.width/n.height).toFixed(2)),fileSize:`${r.toFixed(2)}MB`,type:n.type,isOptimal:r<2&&n.width>=1280&&n.height>=720&&Math.abs(n.width/n.height-16/9)<.1}},batchProcessImages:async(l,n={})=>{const r=[];for(const i of l)try{const s=await v(i,n);r.push(s)}catch(s){console.error(`Error processing file: ${s}`)}return r},getImageMetadata:t}},Qa={class:"media-thumbnail"},Xa={class:"thumbnail-uploader"},Za={class:"d-flex align-center justify-center fill-height"},Ya={key:0,class:"upload-overlay"},Ja={class:"mt-3 text-body-2 text-white"},et={key:0,class:"cropper-container"},at={key:1,class:"d-flex justify-center align-center pa-8"},tt={class:"thumbnail-info mt-4"},je=5*1024*1024,lt={__name:"MediaThumbnailUpload",props:{thumbnailUrl:{type:String,default:null},isUploading:{type:Boolean,default:!1}},emits:["update:thumbnail","upload:start","upload:complete"],setup(e,{emit:t}){const v=e,p=t,{compressImage:F}=Ga(),l=x(null),n=x(!1),r=x(!1),i=x(""),s=x(null),E=x(null),b=x(!1),_=x(null),w=x(0),T=y(()=>_.value?_.value:v.thumbnailUrl),C=["image/jpeg","image/png","image/jpg"];ie(r,(u,a)=>{a&&!u&&!i.value&&U()}),ie(()=>v.isUploading,u=>{u||setTimeout(()=>{_.value&&(URL.revokeObjectURL(_.value),_.value=null),w.value=0},500)});function j(){console.error("Failed to load thumbnail")}function $(){var u;!r.value&&!v.isUploading&&((u=s.value)==null||u.click())}function U(){r.value||v.isUploading||(n.value=!1,l.value=null,i.value="",s.value&&(s.value.value=""))}async function R(u){var c;const a=(c=u.dataTransfer)==null?void 0:c.files[0];b.value=!1,a&&await M(a)}async function M(u){if(!C.includes(u.type)){alert("Please select a valid image file (JPEG or PNG)");return}if(u.size>je){alert("File size should not exceed 5MB");return}try{const a=new FileReader;a.onload=c=>{l.value=c.target.result,n.value=!0},a.readAsDataURL(u)}catch(a){console.error("Error processing file:",a),alert("Error processing image. Please try again.")}}async function m(u){var c,g;const a=(g=(c=u.target)==null?void 0:c.files)==null?void 0:g[0];a&&await M(a)}async function d(){if(!(!E.value||r.value||v.isUploading)){r.value=!0,i.value="Preparing image...",p("upload:start");try{const u=E.value.getCroppedCanvas({width:1280,height:720,fillColor:"#fff",imageSmoothingEnabled:!0,imageSmoothingQuality:"high"});i.value="Compressing image...";const a=await new Promise(g=>u.toBlob(g,"image/jpeg",.9));_.value=URL.createObjectURL(a);const{compressed:c}=await F(a,{maxFileSize:je,compressionThreshold:2*1024*1024,targetFileSize:1.5*1024*1024,maxDimension:1920,progressCallback:g=>{w.value=Math.min(90,g)}});w.value=100,i.value="Uploading image...",p("update:thumbnail",c),setTimeout(()=>{n.value=!1},500)}catch(u){console.error("Error processing thumbnail:",u),alert("Failed to process thumbnail. Please try again."),p("upload:complete",!1)}finally{r.value=!1}}}return(u,a)=>(D(),A("div",Qa,[a[9]||(a[9]=S("h3",{class:"text-h6 mb-4"},"Media Thumbnail",-1)),S("div",Xa,[S("div",{class:"thumbnail-container",onDragover:a[0]||(a[0]=J(()=>{},["prevent"])),onDrop:J(R,["prevent"]),onDragenter:a[1]||(a[1]=J(c=>b.value=!0,["prevent"])),onDragleave:a[2]||(a[2]=J(c=>b.value=!1,["prevent"]))},[T.value?(D(),oe(Ke,{key:0,src:T.value,"aspect-ratio":16/9,cover:"",class:"thumbnail-preview",onError:j},{placeholder:f(()=>[o(ne,null,{default:f(()=>[S("div",Za,[o(se,{indeterminate:"",color:"primary"})])]),_:1})]),_:1},8,["src"])):(D(),A("div",{key:1,class:ce(["empty-thumbnail",{"drag-active":b.value}])},[o(G,{icon:"mdi-image-outline",size:"48",color:"grey-lighten-1"}),a[4]||(a[4]=S("span",{class:"text-grey-lighten-1 text-body-2"}," Drag & drop or click to upload ",-1))],2)),o(ne,null,{default:f(()=>[r.value||e.isUploading?(D(),A("div",Ya,[o(se,{indeterminate:"",color:"primary",size:"64"}),S("span",Ja,H(i.value),1),w.value>0&&w.value<100?(D(),oe(Ze,{key:0,"model-value":w.value,class:"mt-2 upload-progress",color:"primary",rounded:""},null,8,["model-value"])):ee("",!0)])):ee("",!0)]),_:1}),S("div",{class:ce(["action-button",{"has-thumbnail":T.value}])},[o(Z,{color:T.value?"white":"primary",variant:T.value?"flat":"elevated","prepend-icon":T.value?"mdi-refresh":"mdi-upload",disabled:r.value||e.isUploading,class:"upload-btn",elevation:"3",onClick:$},{default:f(()=>[K(H(T.value?"Replace":"Upload Thumbnail"),1)]),_:1},8,["color","variant","prepend-icon","disabled"])],2)],32),a[8]||(a[8]=S("div",{class:"text-caption text-grey mt-2"}," Recommended: 1280x720px or larger, 16:9 ratio, JPEG/PNG format ",-1)),S("input",{ref_key:"fileInput",ref:s,type:"file",accept:"image/jpeg,image/png,image/jpg",style:{display:"none"},onChange:m},null,544),o(Ca,{modelValue:n.value,"onUpdate:modelValue":a[3]||(a[3]=c=>n.value=c),"max-width":"800px",persistent:"",onKeydown:$e(U,["esc"])},{default:f(()=>[o(wa,{class:"thumbnail-editor-dialog"},{default:f(()=>[o(xa,{density:"compact",color:"primary"},{default:f(()=>[o(Va,{class:"text-white"},{default:f(()=>a[5]||(a[5]=[K("Edit Thumbnail")])),_:1}),o(Ce),o(Z,{icon:"mdi-close",variant:"text",color:"white",disabled:r.value||e.isUploading,onClick:U},null,8,["disabled"])]),_:1}),o(ka,{class:"pa-4"},{default:f(()=>[o(ne,null,{default:f(()=>[l.value?(D(),A("div",et,[o(Ye(_a),{ref_key:"cropper",ref:E,src:l.value,"aspect-ratio":16/9,"view-mode":2,background:!0,"auto-crop-area":1,responsive:!0,"img-style":{width:"100%",height:"100%"},style:{height:"min(450px, 70vh)",width:"100%"},guides:!0},null,8,["src"])])):(D(),A("div",at,[o(se,{indeterminate:""})]))]),_:1}),S("div",tt,[o(G,{icon:"mdi-information-outline",size:"small",color:"grey",class:"mr-1"}),a[6]||(a[6]=S("span",{class:"text-caption text-grey"}," Drag the image or move the crop area to adjust your thumbnail. The thumbnail will be displayed in 16:9 ratio across the platform. ",-1))])]),_:1}),o(Fa),o(Sa,{class:"pa-4"},{default:f(()=>[o(Ce),o(Z,{color:"grey",variant:"text",disabled:r.value||e.isUploading,onClick:U},{default:f(()=>a[7]||(a[7]=[K(" Cancel ")])),_:1},8,["disabled"]),o(Z,{color:"primary",loading:r.value||e.isUploading,disabled:!l.value||r.value||e.isUploading,onClick:d},{default:f(()=>[K(H(r.value||e.isUploading?i.value:"Save Changes"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]))}},ot=ue(lt,[["__scopeId","data-v-382f4301"]]),_e=Symbol.for("vuetify:v-slider");function rt(e,t,v){const p=v==="vertical",F=t.getBoundingClientRect(),l="touches"in e?e.touches[0]:e;return p?l.clientY-(F.top+F.height/2):l.clientX-(F.left+F.width/2)}function st(e,t){return"touches"in e&&e.touches.length?e.touches[0][t]:"changedTouches"in e&&e.changedTouches.length?e.changedTouches[0][t]:e[t]}const nt=me({disabled:{type:Boolean,default:null},error:Boolean,readonly:{type:Boolean,default:null},max:{type:[Number,String],default:100},min:{type:[Number,String],default:0},step:{type:[Number,String],default:0},thumbColor:String,thumbLabel:{type:[Boolean,String],default:void 0,validator:e=>typeof e=="boolean"||e==="always"},thumbSize:{type:[Number,String],default:20},showTicks:{type:[Boolean,String],default:!1,validator:e=>typeof e=="boolean"||e==="always"},ticks:{type:[Array,Object]},tickSize:{type:[Number,String],default:2},color:String,trackColor:String,trackFillColor:String,trackSize:{type:[Number,String],default:4},direction:{type:String,default:"horizontal",validator:e=>["vertical","horizontal"].includes(e)},reverse:Boolean,...Je(),...ea({elevation:2}),ripple:{type:Boolean,default:!0}},"Slider"),it=e=>{const t=y(()=>parseFloat(e.min)),v=y(()=>parseFloat(e.max)),p=y(()=>+e.step>0?parseFloat(e.step):0),F=y(()=>Math.max(Se(p.value),Se(t.value)));function l(n){if(n=parseFloat(n),p.value<=0)return n;const r=Le(n,t.value,v.value),i=t.value%p.value,s=Math.round((r-i)/p.value)*p.value+i;return parseFloat(Math.min(s,v.value).toFixed(F.value))}return{min:t,max:v,step:p,decimals:F,roundValue:l}},ut=e=>{let{props:t,steps:v,onSliderStart:p,onSliderMove:F,onSliderEnd:l,getActiveThumb:n}=e;const{isRtl:r}=ge(),i=Y(t,"reverse"),s=y(()=>t.direction==="vertical"),E=y(()=>s.value!==i.value),{min:b,max:_,step:w,decimals:T,roundValue:C}=v,j=y(()=>parseInt(t.thumbSize,10)),$=y(()=>parseInt(t.tickSize,10)),U=y(()=>parseInt(t.trackSize,10)),R=y(()=>(_.value-b.value)/w.value),M=Y(t,"disabled"),m=y(()=>t.error||t.disabled?void 0:t.thumbColor??t.color),d=y(()=>t.error||t.disabled?void 0:t.trackColor??t.color),u=y(()=>t.error||t.disabled?void 0:t.trackFillColor??t.color),a=xe(!1),c=xe(0),g=x(),z=x();function P(h){var ke;const I=t.direction==="vertical",We=I?"top":"left",He=I?"height":"width",qe=I?"clientY":"clientX",{[We]:Ge,[He]:Qe}=(ke=g.value)==null?void 0:ke.$el.getBoundingClientRect(),Xe=st(h,qe);let pe=Math.min(Math.max((Xe-Ge-c.value)/Qe,0),1)||0;return(I?E.value:E.value!==r.value)&&(pe=1-pe),C(b.value+pe*(_.value-b.value))}const W=h=>{l({value:P(h)}),a.value=!1,c.value=0},N=h=>{z.value=n(h),z.value&&(z.value.focus(),a.value=!0,z.value.contains(h.target)?c.value=rt(h,z.value,t.direction):(c.value=0,F({value:P(h)})),p({value:P(h)}))},Q={passive:!0,capture:!0};function ae(h){F({value:P(h)})}function re(h){h.stopPropagation(),h.preventDefault(),W(h),window.removeEventListener("mousemove",ae,Q),window.removeEventListener("mouseup",re)}function B(h){var I;W(h),window.removeEventListener("touchmove",ae,Q),(I=h.target)==null||I.removeEventListener("touchend",B)}function L(h){var I;N(h),window.addEventListener("touchmove",ae,Q),(I=h.target)==null||I.addEventListener("touchend",B,{passive:!1})}function X(h){h.preventDefault(),N(h),window.addEventListener("mousemove",ae,Q),window.addEventListener("mouseup",re,{passive:!1})}const k=h=>{const I=(h-b.value)/(_.value-b.value)*100;return Le(isNaN(I)?0:I,0,100)},V=Y(t,"showTicks"),O=y(()=>V.value?t.ticks?Array.isArray(t.ticks)?t.ticks.map(h=>({value:h,position:k(h),label:h.toString()})):Object.keys(t.ticks).map(h=>({value:parseFloat(h),position:k(parseFloat(h)),label:t.ticks[h]})):R.value!==1/0?aa(R.value+1).map(h=>{const I=b.value+h*w.value;return{value:I,position:k(I)}}):[]:[]),q=y(()=>O.value.some(h=>{let{label:I}=h;return!!I})),we={activeThumbRef:z,color:Y(t,"color"),decimals:T,disabled:M,direction:Y(t,"direction"),elevation:Y(t,"elevation"),hasLabels:q,isReversed:i,indexFromEnd:E,min:b,max:_,mousePressed:a,numTicks:R,onSliderMousedown:X,onSliderTouchstart:L,parsedTicks:O,parseMouseMove:P,position:k,readonly:Y(t,"readonly"),rounded:Y(t,"rounded"),roundValue:C,showTicks:V,startOffset:c,step:w,thumbSize:j,thumbColor:m,thumbLabel:Y(t,"thumbLabel"),ticks:Y(t,"ticks"),tickSize:$,trackColor:d,trackContainerRef:g,trackFillColor:u,trackSize:U,vertical:s};return ta(_e,we),we},ct=me({focused:Boolean,max:{type:Number,required:!0},min:{type:Number,required:!0},modelValue:{type:Number,required:!0},position:{type:Number,required:!0},ripple:{type:[Boolean,Object],default:!0},...Be()},"VSliderThumb"),dt=ye()({name:"VSliderThumb",directives:{Ripple:la},props:ct(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:v,emit:p}=t;const F=Ie(_e),{isRtl:l,rtlClasses:n}=ge();if(!F)throw new Error("[Vuetify] v-slider-thumb must be used inside v-slider or v-range-slider");const{thumbColor:r,step:i,disabled:s,thumbSize:E,thumbLabel:b,direction:_,isReversed:w,vertical:T,readonly:C,elevation:j,mousePressed:$,decimals:U,indexFromEnd:R}=F,{textColorClasses:M,textColorStyles:m}=oa(r),{pageup:d,pagedown:u,end:a,home:c,left:g,right:z,down:P,up:W}=na,N=[d,u,a,c,g,z,P,W],Q=y(()=>i.value?[1,2,3]:[1,5,10]);function ae(B,L){if(!N.includes(B.key))return;B.preventDefault();const X=i.value||.1,k=(e.max-e.min)/X;if([g,z,P,W].includes(B.key)){const O=(T.value?[l.value?g:z,w.value?P:W]:R.value!==l.value?[g,W]:[z,W]).includes(B.key)?1:-1,q=B.shiftKey?2:B.ctrlKey?1:0;L=L+O*X*Q.value[q]}else if(B.key===c)L=e.min;else if(B.key===a)L=e.max;else{const V=B.key===u?1:-1;L=L-V*X*(k>100?k/10:10)}return Math.max(e.min,Math.min(e.max,L))}function re(B){const L=ae(B,e.modelValue);L!=null&&p("update:modelValue",L)}return be(()=>{const B=le(R.value?100-e.position:e.position,"%"),{elevationClasses:L}=ra(y(()=>s.value?void 0:j.value));return o("div",{class:["v-slider-thumb",{"v-slider-thumb--focused":e.focused,"v-slider-thumb--pressed":e.focused&&$.value},e.class,n.value],style:[{"--v-slider-thumb-position":B,"--v-slider-thumb-size":le(E.value)},e.style],role:"slider",tabindex:s.value?-1:0,"aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.modelValue,"aria-readonly":!!C.value,"aria-orientation":_.value,onKeydown:C.value?void 0:re},[o("div",{class:["v-slider-thumb__surface",M.value,L.value],style:{...m.value}},null),de(o("div",{class:["v-slider-thumb__ripple",M.value],style:m.value},null),[[sa("ripple"),e.ripple,null,{circle:!0,center:!0}]]),o(fa,{origin:"bottom center"},{default:()=>{var X;return[de(o("div",{class:"v-slider-thumb__label-container"},[o("div",{class:["v-slider-thumb__label"]},[o("div",null,[((X=v["thumb-label"])==null?void 0:X.call(v,{modelValue:e.modelValue}))??e.modelValue.toFixed(i.value?U.value:1)])])]),[[he,b.value&&e.focused||b.value==="always"]])]}})])}),{}}}),vt=me({start:{type:Number,required:!0},stop:{type:Number,required:!0},...Be()},"VSliderTrack"),mt=ye()({name:"VSliderTrack",props:vt(),emits:{},setup(e,t){let{slots:v}=t;const p=Ie(_e);if(!p)throw new Error("[Vuetify] v-slider-track must be inside v-slider or v-range-slider");const{color:F,parsedTicks:l,rounded:n,showTicks:r,tickSize:i,trackColor:s,trackFillColor:E,trackSize:b,vertical:_,min:w,max:T,indexFromEnd:C}=p,{roundedClasses:j}=ia(n),{backgroundColorClasses:$,backgroundColorStyles:U}=Ve(E),{backgroundColorClasses:R,backgroundColorStyles:M}=Ve(s),m=y(()=>`inset-${_.value?"block":"inline"}-${C.value?"end":"start"}`),d=y(()=>_.value?"height":"width"),u=y(()=>({[m.value]:"0%",[d.value]:"100%"})),a=y(()=>e.stop-e.start),c=y(()=>({[m.value]:le(e.start,"%"),[d.value]:le(a.value,"%")})),g=y(()=>r.value?(_.value?l.value.slice().reverse():l.value).map((P,W)=>{var Q;const N=P.value!==w.value&&P.value!==T.value?le(P.position,"%"):void 0;return o("div",{key:P.value,class:["v-slider-track__tick",{"v-slider-track__tick--filled":P.position>=e.start&&P.position<=e.stop,"v-slider-track__tick--first":P.value===w.value,"v-slider-track__tick--last":P.value===T.value}],style:{[m.value]:N}},[(P.label||v["tick-label"])&&o("div",{class:"v-slider-track__tick-label"},[((Q=v["tick-label"])==null?void 0:Q.call(v,{tick:P,index:W}))??P.label])])}):[]);return be(()=>o("div",{class:["v-slider-track",j.value,e.class],style:[{"--v-slider-track-size":le(b.value),"--v-slider-tick-size":le(i.value)},e.style]},[o("div",{class:["v-slider-track__background",R.value,{"v-slider-track__background--opacity":!!F.value||!E.value}],style:{...u.value,...M.value}},null),o("div",{class:["v-slider-track__fill",$.value],style:{...c.value,...U.value}},null),r.value&&o("div",{class:["v-slider-track__ticks",{"v-slider-track__ticks--always-show":r.value==="always"}]},[g.value])])),{}}}),pt=me({...Ta(),...nt(),...Pa(),modelValue:{type:[Number,String],default:0}},"VSlider"),ft=ye()({name:"VSlider",props:pt(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,start:e=>!0,end:e=>!0},setup(e,t){let{slots:v,emit:p}=t;const F=x(),{rtlClasses:l}=ge(),n=it(e),r=ua(e,"modelValue",void 0,d=>n.roundValue(d??n.min.value)),{min:i,max:s,mousePressed:E,roundValue:b,onSliderMousedown:_,onSliderTouchstart:w,trackContainerRef:T,position:C,hasLabels:j,readonly:$}=ut({props:e,steps:n,onSliderStart:()=>{p("start",r.value)},onSliderEnd:d=>{let{value:u}=d;const a=b(u);r.value=a,p("end",a)},onSliderMove:d=>{let{value:u}=d;return r.value=b(u)},getActiveThumb:()=>{var d;return(d=F.value)==null?void 0:d.$el}}),{isFocused:U,focus:R,blur:M}=Ea(e),m=y(()=>C(r.value));return be(()=>{const d=Te.filterProps(e),u=!!(e.label||v.label||v.prepend);return o(Te,ca({class:["v-slider",{"v-slider--has-labels":!!v["tick-label"]||j.value,"v-slider--focused":U.value,"v-slider--pressed":E.value,"v-slider--disabled":e.disabled},l.value,e.class],style:e.style},d,{focused:U.value}),{...v,prepend:u?a=>{var c,g;return o(fe,null,[((c=v.label)==null?void 0:c.call(v,a))??(e.label?o(ja,{id:a.id.value,class:"v-slider__label",text:e.label},null):void 0),(g=v.prepend)==null?void 0:g.call(v,a)])}:void 0,default:a=>{let{id:c,messagesId:g}=a;return o("div",{class:"v-slider__container",onMousedown:$.value?void 0:_,onTouchstartPassive:$.value?void 0:w},[o("input",{id:c.value,name:e.name||c.value,disabled:!!e.disabled,readonly:!!e.readonly,tabindex:"-1",value:r.value},null),o(mt,{ref:T,start:0,stop:m.value},{"tick-label":v["tick-label"]}),o(dt,{ref:F,"aria-describedby":g.value,focused:U.value,min:i.value,max:s.value,modelValue:r.value,"onUpdate:modelValue":z=>r.value=z,position:m.value,elevation:e.elevation,onFocus:R,onBlur:M,ripple:e.ripple},{"thumb-label":v["thumb-label"]})])}})}),{}}}),ht={class:"video-container"},gt={class:"overlay-container"},yt={class:"d-flex align-center justify-center fill-height"},bt={key:0,class:"overlay-content"},_t={key:1,class:"overlay-content"},wt={key:2,class:"overlay-content error-state"},kt={class:"controls-bar"},St={class:"time-display text-white text-caption mx-2"},Ue="/images/default-thumbnail.jpg",xt=ve({__name:"VideoPreview",props:{videoId:{},videoUrl:{default:null},thumbnailUrl:{default:null},width:{default:"100%"},height:{default:"200px"}},emits:["play","pause","error"],setup(e,{expose:t,emit:v}){const p=e,F=v,l=x("loading"),n=x(0),r=x(0),i=x(0),s=x(null),E=x(null),b=x(null),_=x(!1),w=x(!0),T=x(!1),C=y(()=>typeof p.width=="number"?`${p.width}px`:p.width),j=y(()=>typeof p.height=="number"?`${p.height}px`:p.height),$=k=>{const V=Math.floor(k%60);return`${Math.floor(k/60)}:${String(V).padStart(2,"0")}`},U=y(()=>$(n.value)),R=y(()=>$(r.value)),M=k=>{if(g(),!!s.value)if(l.value="loading",s.value.muted=w.value,k.includes(".m3u8"))if(te.isSupported()){const V=new te({debug:!1,enableWorker:!0,lowLatencyMode:!1,backBufferLength:90,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,maxStarvationDelay:4,maxLoadingDelay:4,xhrSetup:O=>{O.withCredentials=!1},fetchSetup:(O,q)=>new Request(O.url,{...q,mode:"cors",credentials:"omit"})});b.value=V,V.on(te.Events.MEDIA_ATTACHED,()=>{console.log("HLS media attached")}),V.on(te.Events.MANIFEST_PARSED,(O,q)=>{console.log("HLS manifest parsed, found",q.levels.length,"quality levels")}),V.on(te.Events.ERROR,(O,q)=>{if(console.error("HLS error:",q),q.fatal)switch(q.type){case te.ErrorTypes.NETWORK_ERROR:console.error("Fatal network error, trying to recover"),V.startLoad();break;case te.ErrorTypes.MEDIA_ERROR:console.error("Fatal media error, trying to recover"),V.recoverMediaError();break;default:console.error("Fatal error, cannot recover"),L(q);break}}),V.loadSource(k),V.attachMedia(s.value)}else s.value.canPlayType("application/vnd.apple.mpegurl")?s.value.src=k:(console.error("HLS not supported"),L("HLS not supported"));else s.value.src=k},m=()=>{!s.value||l.value==="no_url"||l.value==="error"||(s.value.play().catch(L),F("play",p.videoId))},d=()=>{var k;(k=s.value)==null||k.pause()},u=()=>{l.value==="playing"?d():m()},a=()=>{w.value=!w.value,s.value&&(s.value.muted=w.value)},c=()=>{var k;document.fullscreenElement?document.exitFullscreen():(k=E.value)==null||k.requestFullscreen()},g=()=>{b.value&&(b.value.destroy(),b.value=null),s.value&&(s.value.removeAttribute("src"),s.value.load()),n.value=0,r.value=0,i.value=0},z=()=>{s.value&&(n.value=s.value.duration,l.value="idle")},P=()=>{l.value="playing"},W=()=>{l.value==="playing"&&(l.value="paused",F("pause",p.videoId))},N=()=>{},Q=()=>{!s.value||n.value===0||(r.value=s.value.currentTime,i.value=r.value/n.value*100)},ae=k=>{!s.value||n.value===0||(s.value.currentTime=k/100*n.value)},re=()=>{u()},B=k=>{if(p.videoUrl&&!(k.target instanceof HTMLInputElement))switch(k.code){case"Space":k.preventDefault(),u();break;case"KeyM":k.preventDefault(),a();break;case"KeyF":k.preventDefault(),c();break}},L=k=>{console.error("Video error:",k),l.value="error",F("error",p.videoId)};ie(()=>p.videoUrl,k=>{k?M(k):(l.value="no_url",g())},{immediate:!0});const X=()=>{T.value=!!document.fullscreenElement};return Me(()=>{document.addEventListener("fullscreenchange",X),p.videoUrl?M(p.videoUrl):l.value="no_url"}),da(()=>{document.removeEventListener("fullscreenchange",X),g()}),t({play:m,pause:d}),(k,V)=>(D(),A("div",{ref_key:"wrapperRef",ref:E,class:"video-preview-wrapper",style:va({width:C.value,height:j.value}),tabindex:"0",onMouseenter:V[2]||(V[2]=O=>_.value=!0),onMouseleave:V[3]||(V[3]=O=>_.value=!1),onKeydown:B},[S("div",ht,[S("video",{ref_key:"videoRef",ref:s,class:ce(["video-element",{"is-playing":l.value==="playing"}]),preload:"metadata",loop:"",playsinline:"",crossorigin:"anonymous",onLoadedmetadata:z,onPlaying:P,onPause:W,onWaiting:N,onTimeupdate:Q,onError:L,onClick:re},null,34),o(ne,null,{default:f(()=>[de(S("div",gt,[o(Ke,{src:k.thumbnailUrl||Ue,"lazy-src":Ue,class:"thumbnail-image","aspect-ratio":"16/9",cover:""},{placeholder:f(()=>[S("div",yt,[o(se,{indeterminate:"",color:"grey-lighten-4"})])]),_:1},8,["src"]),l.value==="no_url"?(D(),A("div",bt,[o(G,{size:"48",color:"grey-lighten-2"},{default:f(()=>V[4]||(V[4]=[K("mdi-video-off")])),_:1}),V[5]||(V[5]=S("p",{class:"text-caption mt-2 text-grey-lighten-1"}," Video is processing... ",-1))])):ee("",!0),l.value==="loading"?(D(),A("div",_t,[o(se,{indeterminate:"",color:"white",size:"48"})])):ee("",!0),l.value==="error"?(D(),A("div",wt,[o(G,{size:"48",color:"error"},{default:f(()=>V[6]||(V[6]=[K("mdi-alert-circle-outline")])),_:1}),V[7]||(V[7]=S("p",{class:"text-caption mt-2"},"Could not load video.",-1))])):ee("",!0),l.value==="idle"||l.value==="paused"?(D(),A("div",{key:3,class:"play-button-overlay",onClick:J(m,["stop"])},[o(Z,{icon:"mdi-play-circle",color:"white",size:"x-large",variant:"text",ripple:!1})])):ee("",!0)],512),[[he,l.value!=="playing"]])]),_:1}),o(ne,null,{default:f(()=>[de(S("div",kt,[o(Z,{icon:"",size:"small",variant:"text",color:"white",onClick:J(u,["stop"])},{default:f(()=>[o(G,null,{default:f(()=>[K(H(l.value==="playing"?"mdi-pause":"mdi-play"),1)]),_:1})]),_:1}),o(Z,{icon:"",size:"small",variant:"text",color:"white",onClick:J(a,["stop"])},{default:f(()=>[o(G,null,{default:f(()=>[K(H(w.value?"mdi-volume-off":"mdi-volume-high"),1)]),_:1})]),_:1}),S("span",St,H(R.value)+" / "+H(U.value),1),o(ft,{modelValue:i.value,"onUpdate:modelValue":[V[0]||(V[0]=O=>i.value=O),ae],class:"mx-2",color:"red","track-color":"grey-darken-1","thumb-color":"red",density:"compact",max:100,step:.1,"hide-details":"",onClick:V[1]||(V[1]=J(()=>{},["stop"]))},null,8,["modelValue"]),o(Z,{icon:"",size:"small",variant:"text",color:"white",onClick:J(c,["stop"])},{default:f(()=>[o(G,null,{default:f(()=>[K(H(T.value?"mdi-fullscreen-exit":"mdi-fullscreen"),1)]),_:1})]),_:1})],512),[[he,(_.value||l.value==="paused")&&l.value!=="no_url"&&l.value!=="loading"&&l.value!=="error"]])]),_:1})])],36))}}),Re=ue(xt,[["__scopeId","data-v-a7b3eddf"]]),Vt={class:"header-actions mb-5"},Ft={class:"header-actions-left"},Ct={class:"input-group"},Tt={class:"thumbnail-section"},Pt={class:"preview-section"},Et=ve({__name:"PremieringProjectDetail",props:{project:{}},setup(e){var d,u;const t=e,v=ze(),{$axios:p}=De(),F=Ae(),l=x(((d=t.project)==null?void 0:d.name)??""),n=x(((u=t.project)==null?void 0:u.description)??""),r=x(!1),i=x(!1),s=x(null),E=x(null);let b=null;const _=x(null),w=x(null),T=x(null);function C(a){var c,g;T.value&&T.value!==a&&(T.value==="main"?(c=_.value)==null||c.pause():(g=w.value)==null||g.pause()),T.value=a}function j(a){T.value===a&&(T.value=null)}ie(l,a=>{$({name:a})}),ie(n,a=>{$({description:a})});function $(a){b&&clearTimeout(b),b=setTimeout(()=>{U(a)},1e3)}async function U(a){var c,g,z;if((c=t.project)!=null&&c.access_uuid){r.value=!0,E.value=null;try{const{data:P}=await p.put(`/api/studio/projects/${t.project.access_uuid}/draft`,a);F.updateProject(P),s.value=new Date,v.success("Project details saved")}catch(P){E.value=((z=(g=P.response)==null?void 0:g.data)==null?void 0:z.message)||"Failed to save",v.error("Failed to save project details")}finally{r.value=!1}}}function R(){i.value=!0}function M(a){a||(i.value=!1)}async function m(a){var c;if((c=t.project)!=null&&c.access_uuid){i.value=!0;try{const{uploadFile:g}=Ua(),z=await g(a,`/api/studio/projects/${t.project.access_uuid}/thumbnail/upload-url`,`/api/studio/projects/${t.project.access_uuid}/thumbnail/confirm`,{onProgress:P=>{}});F.updateProject({...t.project,thumbnail_url:z.thumbnail_url}),v.success("Thumbnail updated successfully")}catch(g){console.error("Error updating thumbnail:",g),v.error("Failed to update thumbnail")}finally{i.value=!1}}}return ma(()=>{b&&clearTimeout(b)}),(a,c)=>{const g=Ba,z=qa,P=ot,W=Ne;return a.project?(D(),oe(W,{key:0},{default:f(()=>[S("div",Vt,[S("div",Ft,[o(g,{"project-name":l.value,"is-saving":r.value,"last-saved-at":s.value,"save-error":E.value},null,8,["project-name","is-saving","last-saved-at","save-error"])])]),o(za,null,{default:f(()=>[o(Pe,{cols:"12",md:"8",class:"pb-2"},{default:f(()=>[S("div",Ct,[o(Oe,{modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=N=>l.value=N),label:"Project Name",variant:"outlined",class:"mb-3",rules:[N=>!!N||"Project name is required"],required:"",placeholder:"Enter your project name",disabled:r.value,density:"comfortable"},null,8,["modelValue","rules","disabled"]),o(Ra,{modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=N=>n.value=N),label:"Description",variant:"outlined",rows:"2","auto-grow":"",class:"mb-1",counter:5e3,rules:[N=>!N||N.length<=5e3||"Max 5000 characters"],placeholder:"Tell viewers about your video",disabled:r.value,density:"comfortable"},null,8,["modelValue","rules","disabled"]),S("div",{class:ce(["char-count mb-3",{"error--text":n.value.length>5e3}])},H(n.value.length)+" / 5000 ",3)]),o(z,{project:a.project,class:"mb-5"},null,8,["project"]),S("div",Tt,[o(P,{"thumbnail-url":a.project.thumbnail_url,"is-uploading":i.value,"onUpdate:thumbnail":m,"onUpload:start":R,"onUpload:complete":M},null,8,["thumbnail-url","is-uploading"])])]),_:1}),o(Pe,{cols:"12",md:"4",class:"pb-2"},{default:f(()=>[S("div",Pt,[c[2]||(c[2]=S("h3",{class:"text-subtitle-1 mb-2"},"Main Video Preview",-1)),o(Re,{ref_key:"mainVideoPlayer",ref:_,"video-id":"main","video-url":a.project.project_url,"thumbnail-url":a.project.thumbnail_url,onPlay:C,onPause:j,class:"mb-4"},null,8,["video-url","thumbnail-url"]),c[3]||(c[3]=S("h3",{class:"text-subtitle-1 mb-2"},"Trailer Preview",-1)),o(Re,{ref_key:"trailerVideoPlayer",ref:w,"video-id":"trailer","video-url":a.project.trailer_url,"thumbnail-url":a.project.thumbnail_url,onPlay:C,onPause:j},null,8,["video-url","thumbnail-url"])])]),_:1})]),_:1})]),_:1})):ee("",!0)}}}),al=ue(Et,[["__scopeId","data-v-fd66940f"]]);export{al as _};
