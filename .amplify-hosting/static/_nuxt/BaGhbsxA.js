import{g as N,j as y,c as M,n as q,t as T,l as K,o as C,m as k,x as w,b as f,v as S,y as z,a0 as Z,dm as ee,F as te,D as ae,_ as Q,f as re,z as se,p as x,w as h,V as G,s as I,a as le,q as U,C as ne,Q as oe}from"./CGQimWOm.js";import{u as H,i as ce}from"./CiN8dqd8.js";import{V as j}from"./xvVMJZi9.js";import{a as ie,V as ue}from"./BkTuXOR_.js";import{V as de}from"./CiXMVmI4.js";import{V as ve}from"./6HtF_owb.js";function J(){const{$axios:n}=N(),d=y([]),c=y(null),l=y(!1),u=y(null),i=y(!1),r=M(()=>c.value||null),B=M(()=>d.value),v=async()=>{if(!l.value){l.value=!0,u.value=null;try{const s=await n.get("/api/currencies");console.log("API Response:",s.data);const{currencies:e,user_currency:t}=s.data;return d.value=e||[],c.value=t||null,i.value=!0,{currencies:e,userCurrency:t}}catch(s){throw u.value=s.message||"Failed to fetch currencies",console.error("Error fetching currencies:",s),s}finally{l.value=!1}}};return{currencies:d,activeCurrencies:B,userCurrency:c,selectedCurrency:r,isLoading:l,error:u,isFetched:i,fetchCurrencies:v,fetchGuestCurrencies:async()=>{if(!l.value){l.value=!0,u.value=null;try{const s=await n.get("/api/currencies");return console.log("Guest API Response:",s.data),d.value=s.data.currencies||s.data.data||[],i.value=!0,d.value}catch(s){throw u.value=s.message||"Failed to fetch guest currencies",console.error("Error fetching guest currencies:",s),s}finally{l.value=!1}}},updateUserCurrency:async s=>{l.value=!0,u.value=null;try{const e=await n.post("/api/user/currency",{currency_code:s});return await v(),e.data}catch(e){throw u.value=e.message||"Failed to update currency",console.error("Error updating currency:",e),e}finally{l.value=!1}},updateWalletCurrency:async(s,e)=>{l.value=!0,u.value=null;try{const t=await n.post(`/api/wallet/${s}/currency`,{currency_id:e});return await v(),t.data}catch(t){throw u.value=t.message||"Failed to update wallet currency",console.error("Error updating wallet currency:",t),t}finally{l.value=!1}},getCurrencyById:s=>d.value.find(e=>e.id===s),getCurrencyByCode:s=>d.value.find(e=>e.code===s)}}const ye={class:"currency-selector"},fe={key:0,class:"currency-selector__loading"},pe={key:1,class:"currency-selector__container"},me=["for"],_e={class:"currency-selector__select-wrapper"},ge=["id"],we=["value","selected"],he={key:0,class:"currency-selector__selected"},Ce={class:"currency-selector__symbol"},be={class:"currency-selector__code"},xe={key:1,class:"currency-selector__error"},ke=q({__name:"CurrencyCountrySelector",props:{modelValue:{type:Number,default:null},label:{type:String,default:"Select Currency"},autoLoad:{type:Boolean,default:!0},id:{type:String,default:()=>`currency-selector-${Math.random().toString(36).substring(2,9)}`}},emits:["update:modelValue","change"],setup(n,{expose:d,emit:c}){const l=n,u=c,{currencies:i,userCurrency:r,isLoading:B,error:v,fetchCurrencies:b}=J(),m=y(l.modelValue),_=M(()=>m.value&&i.value.find(p=>p.id===m.value)||null),$=()=>{u("update:modelValue",m.value),_.value&&u("change",_.value)};return T(()=>l.modelValue,p=>{p!==m.value&&(m.value=p)}),T(r,p=>{p&&!l.modelValue&&(m.value=p.id,u("update:modelValue",p.id))}),K(async()=>{l.autoLoad&&(await b(),!l.modelValue&&r.value&&(m.value=r.value.id,u("update:modelValue",r.value.id)))}),d({reload:b,currencies:i,selectedCurrency:_}),(p,s)=>(C(),k("div",ye,[w(B)?(C(),k("div",fe,s[1]||(s[1]=[f("span",{class:"loader"},null,-1)]))):(C(),k("div",pe,[n.label?(C(),k("label",{key:0,for:n.id,class:"currency-selector__label"},S(n.label),9,me)):z("",!0),f("div",_e,[Z(f("select",{id:n.id,"onUpdate:modelValue":s[0]||(s[0]=e=>m.value=e),class:"currency-selector__select",onChange:$},[(C(!0),k(te,null,ae(w(i),e=>(C(),k("option",{key:e.id,value:e.id,selected:e.id===n.modelValue},S(e.name)+" ("+S(e.code)+") ",9,we))),128))],40,ge),[[ee,m.value]]),_.value?(C(),k("div",he,[f("span",Ce,S(_.value.symbol),1),f("span",be,S(_.value.code),1)])):z("",!0)]),w(v)?(C(),k("p",xe,S(w(v)),1)):z("",!0)]))]))}}),Se=Q(ke,[["__scopeId","data-v-5d0de089"]]),Ve=re("wallet-activation",()=>{const{$axios:n}=N(),d=H(),c=y(!1),l=y("email"),u=y(!0),i=se({isActivated:!1,isPending:!1,lastAttempt:null}),r=e=>{var E,P,F,W,D,L,o;if(ce(e)){const a=e;throw{message:((P=(E=a.response)==null?void 0:E.data)==null?void 0:P.message)||a.message,details:(W=(F=a.response)==null?void 0:F.data)==null?void 0:W.details,status:(D=a.response)==null?void 0:D.status,code:(o=(L=a.response)==null?void 0:L.data)==null?void 0:o.code}}throw{message:e instanceof Error?e.message:"An unexpected error occurred"}};return{isLoading:c,activationMethod:l,canActivateByEmail:u,activationStatus:i,checkActivationEligibility:async()=>{try{c.value=!0;const{data:e}=await n.get("/api/wallet/activation/eligibility");return u.value=e.canActivateByEmail||!1,i.isActivated=e.isActivated||!1,i.isPending=e.isPending||!1,e}catch(e){return r(e)}finally{c.value=!1}},sendActivationCode:async()=>{try{c.value=!0;const{data:e}=await n.post("/api/wallet/activation/send-code",{method:l.value});return i.lastAttempt=new Date,i.isPending=!0,e}catch(e){return r(e)}finally{c.value=!1}},verifyActivationCode:async e=>{try{c.value=!0;const{data:t}=await n.post("/api/wallet/activation/verify-code",{code:e,method:l.value});return t.authorized&&(i.isPending=!1),t}catch(t){return r(t)}finally{c.value=!1}},resendActivationCode:async()=>{try{c.value=!0;const{data:e}=await n.post("/api/wallet/activation/resend-code",{method:l.value});return i.lastAttempt=new Date,e}catch(e){return r(e)}finally{c.value=!1}},completeActivation:async e=>{try{c.value=!0;const t=e?{currency_id:e}:{},{data:E}=await n.post("/api/wallet/activation/complete",t);return E.success&&(i.isActivated=!0,i.isPending=!1,await d.fetchWallet()),E}catch(t){return r(t)}finally{c.value=!1}},verifyPin:async e=>{try{const{data:t}=await n.post("/api/wallet/verify-generated-pin",{pin:e});return t.authorized&&(d.setAuthenticated(!0),t.expires_at&&d.setSessionExpiry(t.expires_at),await d.fetchWallet()),t}catch(t){return r(t)}},generateNewPin:async e=>{try{const{data:t}=await n.post("/api/wallet/generate-pin",{email:e});return t}catch(t){return r(t)}},verifyGeneratedPin:async e=>{try{const{data:t}=await n.post("/api/wallet/verify-generated-pin",{pin:e});return t.authorized&&(d.setAuthenticated(!0),t.expires_at&&d.setSessionExpiry(t.expires_at),await d.fetchWallet()),t}catch(t){return r(t)}}}}),Ae={class:"wallet-currency-selector"},$e={class:"currency-header mb-4"},Ee={class:"text-center"},Ie={key:0,class:"current-currency-info mb-4"},Be={class:"d-flex align-center"},Fe=["src","alt"],Ne={key:1,class:"text-caption font-weight-bold"},ze={class:"flex-grow-1 min-width-0"},Pe={class:"text-body-1 font-weight-medium text-truncate"},We={class:"text-caption text-medium-emphasis"},De={class:"currency-selector-section mb-4"},Le={class:"action-buttons mt-4"},Me=q({__name:"WalletCurrencySelector",props:{walletId:{type:Number,default:null},allowSkip:{type:Boolean,default:!1},preselectedCurrencyId:{type:Number,default:null}},emits:["success","skip","error"],setup(n,{emit:d}){const c=n,l=d,u=H(),i=Ve(),{userCurrency:r,currencies:B}=J(),v=y(c.preselectedCurrencyId),b=y(!1),m=y(""),_=y(!1),$=y(""),p=y("success"),s=y(null),e=y(null),t=async()=>{var o,a,V,A,R;if(v.value)try{b.value=!0,m.value="";let g=c.walletId;if(!g&&i.walletId?g=i.walletId:!g&&((o=u.wallet)!=null&&o.id)?g=u.wallet.id:!g&&((V=(a=i.activationStatus)==null?void 0:a.wallet)!=null&&V.id)&&(g=i.activationStatus.wallet.id),!g){const{$axios:Y}=N();g=(await Y.get("/api/wallet")).data.data.id}if(!g)throw new Error("No wallet found. Please try again later.");const{$axios:O}=N(),X=await O.post("/api/wallet/activation/complete",{currency_id:v.value});P("Wallet activated successfully"),l("success",X.data)}catch(g){console.error("Currency selection error:",g),F(((R=(A=g.response)==null?void 0:A.data)==null?void 0:R.message)||g.message||"Failed to update currency"),l("error",g)}finally{b.value=!1}},E=async()=>{var o,a;try{b.value=!0;const{$axios:V}=N(),A=await V.post("/api/wallet/activation/complete");l("skip",A.data)}catch(V){F(((a=(o=V.response)==null?void 0:o.data)==null?void 0:a.message)||V.message||"Failed to complete activation"),l("error",V)}finally{b.value=!1}},P=o=>{$.value=o,p.value="success",_.value=!0},F=o=>{m.value=o,$.value=o,p.value="error",_.value=!0},W=o=>o?o.startsWith("http")?o:o.startsWith("/")?`${oe().public.apiBase||""}${o}`:o:"",D=o=>{console.warn("Failed to load currency flag image:",o)},L=M(()=>v.value!==e.value&&v.value!==null);return K(()=>{c.preselectedCurrencyId&&(v.value=c.preselectedCurrencyId),r!=null&&r.id&&(e.value=r.id,v.value||(v.value=r.id))}),(o,a)=>{const V=Se;return C(),k("div",Ae,[f("div",$e,[f("div",Ee,[x(j,{size:"40",color:"primary",class:"mb-3"},{default:h(()=>[x(G,{color:"white",size:"20"},{default:h(()=>a[3]||(a[3]=[I("mdi-currency-usd")])),_:1})]),_:1}),a[4]||(a[4]=f("h3",{class:"text-h6 font-weight-bold mb-2"},"Select Currency",-1)),a[5]||(a[5]=f("p",{class:"text-body-2 text-medium-emphasis mb-0"}," Choose your wallet's default currency ",-1))])]),w(r)?(C(),k("div",Ie,[x(ue,{class:"current-currency-card",elevation:"1",rounded:"lg"},{default:h(()=>[x(ie,{class:"pa-3"},{default:h(()=>[f("div",Be,[x(j,{size:"32",class:"mr-3"},{default:h(()=>[w(r).country_flag?(C(),k("img",{key:0,src:W(w(r).country_flag),alt:w(r).country_name||w(r).code,class:"currency-flag",onError:D},null,40,Fe)):(C(),k("span",Ne,S(w(r).symbol),1))]),_:1}),f("div",ze,[a[6]||(a[6]=f("div",{class:"text-caption text-medium-emphasis"},"Current Currency",-1)),f("div",Pe,S(w(r).name),1),f("div",We,S(w(r).code)+" â€¢ "+S(w(r).symbol),1)])])]),_:1})]),_:1})])):z("",!0),x(de,{ref_key:"form",ref:s,onSubmit:ne(t,["prevent"])},{default:h(()=>[f("div",De,[x(V,{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=A=>v.value=A),label:"Select Currency",density:"compact"},null,8,["modelValue"])]),f("div",Le,[n.allowSkip&&w(r)?(C(),le(U,{key:0,variant:"outlined",onClick:E,disabled:b.value,size:"small",class:"mb-2",block:""},{default:h(()=>[x(G,{start:"",size:"16"},{default:h(()=>a[7]||(a[7]=[I("mdi-skip-next")])),_:1}),a[8]||(a[8]=I(" Keep Current "))]),_:1},8,["disabled"])):z("",!0),x(U,{color:"primary",type:"submit",loading:b.value,disabled:!v.value||b.value,size:"default",block:""},{default:h(()=>[x(G,{start:"",size:"18"},{default:h(()=>a[9]||(a[9]=[I("mdi-check")])),_:1}),I(" "+S(L.value?"Confirm Currency":"Save Currency"),1)]),_:1},8,["loading","disabled"])])]),_:1},512),x(ve,{modelValue:_.value,"onUpdate:modelValue":a[2]||(a[2]=A=>_.value=A),color:p.value,timeout:"5000"},{actions:h(()=>[x(U,{variant:"text",onClick:a[1]||(a[1]=A=>_.value=!1)},{default:h(()=>a[10]||(a[10]=[I(" Close ")])),_:1})]),default:h(()=>[I(S($.value)+" ",1)]),_:1},8,["modelValue","color"])])}}}),Qe=Q(Me,[["__scopeId","data-v-822d37d3"]]);export{Qe as _,Ve as u};
