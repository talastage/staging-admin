import{m as ye,u as Ce,a as pe}from"./DbQnG3uQ.js";import{m as ke,V as X}from"./CMsVONS5.js";import{a7 as we,aW as Fe,aa as Ie,b5 as Se,j as E,aK as D,b0 as Y,c as g,aT as De,t as P,ae as Pe,p as s,F as K,O as N,V as Z,dx as Re,ah as _e,s as Te,dy as Ae,dW as Me,U as ee,be as Ee,bx as Ne}from"./CGQimWOm.js";import{m as Le,u as Ke}from"./DjbnUXUR.js";import{f as Oe}from"./Dg4qVXYX.js";import{f as Ue}from"./C-GTDzx5.js";import{u as Be,V as je,t as L}from"./BRveoiXI.js";import{m as We}from"./BSH7BhKc.js";import{V as ze}from"./CW50LM9V.js";import{V as le}from"./tTgLLTve.js";import{V as He}from"./ClFbrGXS.js";import{a as $e}from"./DsvAftJq.js";function qe(e,m,R){if(m==null)return e;if(Array.isArray(m))throw new Error("Multiple matches is not implemented");return typeof m=="number"&&~m?s(K,null,[s("span",{class:"v-combobox__unmask"},[e.substr(0,m)]),s("span",{class:"v-combobox__mask"},[e.substr(m,R)]),s("span",{class:"v-combobox__unmask"},[e.substr(m+R)])]):e}const Ge=we({autoSelectFirst:{type:[Boolean,String]},delimiters:Array,...Le({filterKeys:["title"]}),...ye({hideNoData:!0,returnObject:!0}),...Fe(ke({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...We({transition:!1})},"VCombobox"),il=Ie()({name:"VCombobox",props:Ge(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,m){var G;let{emit:R,slots:n}=m;const{t:O}=Se(),x=E(),V=D(!1),y=D(!0),_=D(!1),z=E(),H=E(),U=Y(e,"menu"),r=g({get:()=>U.value,set:l=>{var a;U.value&&!l&&((a=z.value)!=null&&a.Î¨openChildren)||(U.value=l)}}),o=D(-1);let B=!1;const te=g(()=>{var l;return(l=x.value)==null?void 0:l.color}),$=g(()=>r.value?e.closeText:e.openText),{items:q,transformIn:ae,transformOut:ne}=Be(e),{textColorClasses:ue,textColorStyles:oe}=De(te),u=Y(e,"modelValue",[],l=>ae(Ne(l)),l=>{const a=ne(l);return e.multiple?a:a[0]??null}),F=Oe(),I=D(e.multiple?"":((G=u.value[0])==null?void 0:G.title)??""),c=g({get:()=>I.value,set:l=>{var a;if(I.value=l??"",e.multiple||(u.value=[L(e,l)]),l&&e.multiple&&((a=e.delimiters)!=null&&a.length)){const i=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));i.length>1&&(i.forEach(d=>{d=d.trim(),d&&b(L(e,d))}),I.value="")}l||(o.value=-1),y.value=!l}}),ie=g(()=>typeof e.counterValue=="function"?e.counterValue(u.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?u.value.length:c.value.length);P(I,l=>{B?ee(()=>B=!1):V.value&&!r.value&&(r.value=!0),R("update:search",l)}),P(u,l=>{var a;e.multiple||(I.value=((a=l[0])==null?void 0:a.title)??"")});const{filteredItems:S,getMatches:se}=Ke(e,q,()=>y.value?"":c.value),C=g(()=>e.hideSelected?S.value.filter(l=>!u.value.some(a=>a.value===l.value)):S.value),re=g(()=>u.value.map(l=>l.value)),T=g(()=>{var a;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&c.value===((a=C.value[0])==null?void 0:a.title))&&C.value.length>0&&!y.value&&!_.value}),j=g(()=>e.hideNoData&&!q.value.length||e.readonly||(F==null?void 0:F.isReadonly.value)),W=E(),{onListScroll:ce,onListKeydown:ve}=Ce(W,x);function de(l){B=!0,e.openOnClear&&(r.value=!0)}function fe(){j.value||(r.value=!0)}function me(l){j.value||(V.value&&(l.preventDefault(),l.stopPropagation()),r.value=!r.value)}function be(l){var d;if(Me(l)||e.readonly||F!=null&&F.isReadonly.value)return;const a=x.value.selectionStart,i=u.value.length;if((o.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(r.value=!0),["Escape"].includes(l.key)&&(r.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(T.value&&["Enter","Tab"].includes(l.key)&&b(S.value[0]),y.value=!0),l.key==="ArrowDown"&&T.value&&((d=W.value)==null||d.focus("next")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(o.value<0){l.key==="Backspace"&&!c.value&&(o.value=i-1);return}const t=o.value,v=u.value[o.value];v&&!v.props.disabled&&b(v),o.value=t>=i-1?i-2:t}if(l.key==="ArrowLeft"){if(o.value<0&&a>0)return;const t=o.value>-1?o.value-1:i-1;u.value[t]?o.value=t:(o.value=-1,x.value.setSelectionRange(c.value.length,c.value.length))}if(l.key==="ArrowRight"){if(o.value<0)return;const t=o.value+1;u.value[t]?o.value=t:(o.value=-1,x.value.setSelectionRange(0,0))}l.key==="Enter"&&c.value&&(b(L(e,c.value)),c.value="")}}function he(){var l;V.value&&(y.value=!0,(l=x.value)==null||l.focus())}function b(l){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e.multiple){const i=u.value.findIndex(t=>e.valueComparator(t.value,l.value)),d=a??!~i;if(~i){const t=d?[...u.value,l]:[...u.value];t.splice(i,1),u.value=t}else d&&(u.value=[...u.value,l]);c.value=""}else{const i=a!==!1;u.value=i?[l]:[],I.value=i?l.title:"",ee(()=>{r.value=!1,y.value=!0})}}function ge(l){V.value=!0,setTimeout(()=>{_.value=!0})}function xe(l){_.value=!1}function Ve(l){(l==null||l===""&&!e.multiple)&&(u.value=[])}return P(S,l=>{!l.length&&e.hideNoData&&(r.value=!1)}),P(V,(l,a)=>{l||l===a||(o.value=-1,r.value=!1,T.value&&!_.value&&!u.value.some(i=>{let{value:d}=i;return d===C.value[0].value})?b(C.value[0]):e.multiple&&c.value&&b(L(e,c.value)))}),P(r,()=>{if(!e.hideSelected&&r.value&&u.value.length){const l=C.value.findIndex(a=>u.value.some(i=>e.valueComparator(i.value,a.value)));Ee&&window.requestAnimationFrame(()=>{var a;l>=0&&((a=H.value)==null||a.scrollToIndex(l))})}}),Pe(()=>{const l=!!(e.chips||n.chip),a=!!(!e.hideNoData||C.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),i=u.value.length>0,d=X.filterProps(e);return s(X,N({ref:x},d,{modelValue:c.value,"onUpdate:modelValue":[t=>c.value=t,Ve],focused:V.value,"onUpdate:focused":t=>V.value=t,validationValue:u.externalValue,counterValue:ie.value,dirty:i,class:["v-combobox",{"v-combobox--active-menu":r.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!n.selection,"v-combobox--selecting-index":o.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:e.readonly,placeholder:i?void 0:e.placeholder,"onClick:clear":de,"onMousedown:control":fe,onKeydown:be}),{...n,default:()=>s(K,null,[s(ze,N({ref:z,modelValue:r.value,"onUpdate:modelValue":t=>r.value=t,activator:"parent",contentClass:"v-combobox__content",disabled:j.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:he},e.menuProps),{default:()=>[a&&s(je,{ref:W,selected:re.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:t=>t.preventDefault(),onKeydown:ve,onFocusin:ge,onFocusout:xe,onScrollPassive:ce,tabindex:"-1",color:e.itemColor??e.color},{default:()=>{var t,v,h;return[(t=n["prepend-item"])==null?void 0:t.call(n),!C.value.length&&!e.hideNoData&&(((v=n["no-data"])==null?void 0:v.call(n))??s(le,{title:O(e.noDataText)},null)),s(pe,{ref:H,renderless:!0,items:C.value},{default:p=>{var Q;let{item:f,index:k,itemRef:w}=p;const J=N(f.props,{ref:w,key:k,active:T.value&&k===0?!0:void 0,onClick:()=>b(f,null)});return((Q=n.item)==null?void 0:Q.call(n,{item:f,index:k,props:J}))??s(le,J,{prepend:A=>{let{isSelected:M}=A;return s(K,null,[e.multiple&&!e.hideSelected?s(He,{key:f.value,modelValue:M,ripple:!1,tabindex:"-1"},null):void 0,f.props.prependIcon&&s(Z,{icon:f.props.prependIcon},null)])},title:()=>{var A,M;return y.value?f.title:qe(f.title,(A=se(f))==null?void 0:A.title,((M=c.value)==null?void 0:M.length)??0)}})}}),(h=n["append-item"])==null?void 0:h.call(n)]}})]}),u.value.map((t,v)=>{function h(w){w.stopPropagation(),w.preventDefault(),b(t,!1)}const p={"onClick:close":h,onMousedown(w){w.preventDefault(),w.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},f=l?!!n.chip:!!n.selection,k=f?Re(l?n.chip({item:t,index:v,props:p}):n.selection({item:t,index:v})):void 0;if(!(f&&!k))return s("div",{key:t.value,class:["v-combobox__selection",v===o.value&&["v-combobox__selection--selected",ue.value]],style:v===o.value?oe.value:{}},[l?n.chip?s(_e,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:t.title}}},{default:()=>[k]}):s($e,N({key:"chip",closable:e.closableChips,size:"small",text:t.title,disabled:t.props.disabled},p),null):k??s("span",{class:"v-combobox__selection-text"},[t.title,e.multiple&&v<u.value.length-1&&s("span",{class:"v-combobox__selection-comma"},[Te(",")])])])})]),"append-inner":function(){var p;for(var t=arguments.length,v=new Array(t),h=0;h<t;h++)v[h]=arguments[h];return s(K,null,[(p=n["append-inner"])==null?void 0:p.call(n,...v),(!e.hideNoData||e.items.length)&&e.menuIcon?s(Z,{class:"v-combobox__menu-icon",icon:e.menuIcon,onMousedown:me,onClick:Ae,"aria-label":O($.value),title:O($.value)},null):void 0])}})}),Ue({isFocused:V,isPristine:y,menu:r,search:c,selectionIndex:o,filteredItems:S,select:b},x)}});export{il as V};
