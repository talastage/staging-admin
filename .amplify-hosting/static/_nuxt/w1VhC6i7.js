import{u as le,_ as oe}from"./BaGhbsxA.js";import{_ as K,L as se,g as ie,i as ne,j as m,c as d,t as re,l as H,bH as F,o as p,a as w,w as l,p as o,b as s,V as b,s as u,m as I,F as ue,D as ce,G as de,v as P,C as q,q as C,x as me,y as E,n as ve}from"./CGQimWOm.js";import{u as pe}from"./Bp2sYpJN.js";import{u as fe}from"./CiN8dqd8.js";import{u as ye}from"./DMBY-Kaj.js";import{m as ge}from"./_H440M90.js";import{_ as we}from"./D5iXKOLd.js";import{a as be}from"./2hEmiBig.js";import{d as Ve,a as D,c as _e,V as xe}from"./BkTuXOR_.js";import{V as Se}from"./xvVMJZi9.js";import{V as ke,a as N}from"./D9lJKT5N.js";import{V as L}from"./CiXMVmI4.js";import{a as Ce,V as Ae}from"./CngyuRTk.js";import{V as he}from"./DX-6Wr-O.js";import{a as We}from"./DsvAftJq.js";import{V as U}from"./P_q-BwEt.js";import{V as Te}from"./GXZRJwQ4.js";import{u as Fe}from"./BW5EWlXk.js";import{u as Pe}from"./D78L5r-E.js";import{V as Ee}from"./BhN2__aY.js";import"./6HtF_owb.js";import"./DJ0NdY24.js";import"./CjukEv2V.js";import"./BSH7BhKc.js";import"./C-GTDzx5.js";import"./QtD4Idd3.js";import"./Dn0bXcU5.js";import"./Dg4qVXYX.js";import"./D0h0WEJV.js";import"./BFmCCZJK.js";/* empty css        */const Ne={class:"text-center"},Ie={class:"d-flex justify-center align-center mb-4"},$e={key:1,class:"dot-number"},ze={class:"d-flex justify-center"},Be={class:"text-body-1 text-center mb-6"},Me={class:"text-center mb-4"},Re={class:"d-flex justify-center"},je={class:"text-center"},Ye={class:"pin-container text-center my-6 pa-4 rounded bg-grey-lighten-4"},Ge={class:"pin-display"},qe={class:"d-flex justify-center"},De={__name:"WalletActivatePage",setup(O){const A=se(),{$axios:i}=ie(),t=le(),f=ne(),V=pe(),h=fe(),W=ye(),J=m(null),Q=m(null),X=a=>{g(a,"Failed to update wallet currency")},$=m(""),c=m(1),_=m("email"),y=m(""),T=m(0),x=m(!1),v=m(""),z=m("info"),n=m(!1);m(!1);const B=d(()=>y.value.length===6),M=d(()=>{var a,e;return ge(((e=(a=f.user)==null?void 0:a.value)==null?void 0:e.email)||"")}),S=(a,e="info")=>{e==="error"?W.error(a,{timeout:5e3,closable:!0}):(v.value=a,z.value=e,e==="success"&&setTimeout(()=>{v.value===a&&(v.value="")},5e3))},g=(a,e)=>{var r,G;console.error("Error:",a);let k=e;(G=(r=a==null?void 0:a.response)==null?void 0:r.data)!=null&&G.message?k=a.response.data.message:a!=null&&a.message&&(k=a.message),W.error(k)},Z=()=>{x.value=!1,S("Verification code has expired. Please request a new one.","warning")},R=async()=>{console.log("Send code button clicked");try{n.value=!0,v.value="";const a=await i.post("/api/wallet/activation/send-code",{method:_.value});console.log("Send code response:",a.data),c.value=2,T.value++,x.value=!0,S("Activation code sent to your email","success")}catch(a){console.error("Send code error:",a),g(a,"Failed to send activation code")}finally{n.value=!1}},j=async()=>{if(B.value){v.value="";try{n.value=!0;const a=await i.post("/api/wallet/activation/verify-code",{code:y.value,method:_.value});console.log("Verify code response:",a.data),S("Email verified successfully","success");try{await Promise.all([V.fetchCurrencies(),h.fetchWallet()]),c.value=3}catch(e){g(e,"Verification successful, but failed to load wallet data")}}catch(a){console.error("Verify code error:",a),g(a,"Failed to verify activation code"),y.value=""}finally{n.value=!1}}},ee=async()=>{v.value="";try{n.value=!0;const a=await i.post("/api/wallet/activation/resend-code",{method:_.value});console.log("Resend code response:",a.data),T.value++,x.value=!0,y.value="",S("New activation code sent to your email","success")}catch(a){console.error("Resend code error:",a),g(a,"Failed to resend activation code")}finally{n.value=!1}},ae=()=>{c.value=1,v.value=""},te=async()=>{try{await F("/wallet/verify-pin")}catch(a){console.error("Navigation error:",a),await A.push("/wallet/verify-pin")}},Y=async a=>{try{n.value=!0,a||(a=(await i.post("/api/wallet/activation/complete")).data),console.log("Activation complete:",a),a.pin?($.value=a.pin,c.value=4):(W.success("Wallet activated successfully!"),await F("/wallet"))}catch(e){g(e,"Failed to complete wallet activation")}finally{n.value=!1}};return re(c,a=>{a===1&&(y.value="",x.value=!1)}),H(async()=>{console.log("WalletActivatePage mounted");try{n.value=!0;const a=await i.get("/api/wallet/activation/eligibility");console.log("Eligibility response:",a.data);const e=a.data;if(t.canActivateByEmail=e.canActivateByEmail,t.activationStatus.isActivated=e.isActivated,t.activationStatus.isPending=e.isPending,e.isActivated){W.info("Your wallet is already activated"),await F("/wallet");return}e.isPending&&(c.value=2,T.value++,x.value=!0,S("Please enter the verification code sent earlier","info"))}catch(a){console.error("Eligibility check error:",a),g(a,"Failed to check activation eligibility"),await F("/dashboard")}finally{n.value=!1}}),(a,e)=>{const k=oe;return p(),w(xe,{class:"wallet-activation-card",elevation:"2",rounded:"xl"},{default:l(()=>[o(Ve,{class:"header-section pa-4"},{default:l(()=>[s("div",Ne,[o(Se,{size:"48",color:"primary",class:"mb-3"},{default:l(()=>[o(b,{color:"white",size:"24"},{default:l(()=>e[4]||(e[4]=[u("mdi-wallet-plus")])),_:1})]),_:1}),e[5]||(e[5]=s("h2",{class:"text-h5 font-weight-bold mb-2"},"Activate Your Wallet",-1)),e[6]||(e[6]=s("p",{class:"text-body-2 text-medium-emphasis mb-0"}," Secure your transactions with wallet activation ",-1))])]),_:1}),o(D,{class:"stepper-section pa-4 pt-2"},{default:l(()=>[s("div",Ie,[(p(),I(ue,null,ce(4,r=>s("div",{key:r,class:de(["progress-dot",{active:c.value>=r,completed:c.value>r}])},[c.value>r?(p(),w(b,{key:0,size:"12",color:"white"},{default:l(()=>e[7]||(e[7]=[u("mdi-check")])),_:1})):(p(),I("span",$e,P(r),1))],2)),64))])]),_:1}),o(D,{class:"main-content pa-4"},{default:l(()=>[o(ke,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=r=>c.value=r),touch:!1},{default:l(()=>[o(N,{value:1},{default:l(()=>[o(L,{onSubmit:q(R,["prevent"]),ref_key:"emailForm",ref:J},{default:l(()=>[e[10]||(e[10]=s("p",{class:"text-body-1 mb-4"},"Verify with your registered email:",-1)),o(Ce,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=r=>_.value=r),class:"mb-6",row:""},{default:l(()=>[o(Ae,{label:`Email (${M.value})`,value:"email",color:"primary","aria-label":"Verify with email"},null,8,["label"])]),_:1},8,["modelValue"]),s("div",ze,[o(C,{color:"primary",onClick:R,loading:n.value,disabled:!_.value||n.value,size:"default",class:"px-6"},{default:l(()=>[o(b,{start:"",size:"18"},{default:l(()=>e[8]||(e[8]=[u("mdi-email-send")])),_:1}),e[9]||(e[9]=u(" Send Code "))]),_:1},8,["loading","disabled"])])]),_:1},512)]),_:1}),o(N,{value:2},{default:l(()=>[o(L,{onSubmit:q(j,["prevent"]),ref_key:"codeForm",ref:Q},{default:l(()=>[e[16]||(e[16]=s("p",{class:"text-h6 text-center mb-4"},"Enter Verification Code",-1)),s("p",Be,[e[11]||(e[11]=u(" We've sent a 6-digit code to your email ")),s("span",null,"("+P(M.value)+")",1)]),o(he,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=r=>y.value=r),length:6,type:"number",onFinish:j,class:"mb-4","aria-label":"Verification code input",disabled:n.value,autofocus:""},null,8,["modelValue","disabled"]),s("div",Me,[o(We,{color:"info",variant:"outlined"},{default:l(()=>[o(b,{start:""},{default:l(()=>e[12]||(e[12]=[u("mdi-clock-outline")])),_:1}),e[13]||(e[13]=u(" Code expires in ")),(p(),w(we,{key:T.value,seconds:180,onFinished:Z}))]),_:1})]),s("div",Re,[o(C,{color:"primary",type:"submit",loading:n.value,disabled:!B.value||n.value,size:"default",class:"px-6"},{default:l(()=>[o(b,{start:"",size:"18"},{default:l(()=>e[14]||(e[14]=[u("mdi-check-circle")])),_:1}),e[15]||(e[15]=u(" Verify Code "))]),_:1},8,["loading","disabled"])])]),_:1},512)]),_:1}),o(N,{value:3},{default:l(()=>[o(k,{"wallet-id":me(t).walletId,"allow-skip":!0,onSuccess:Y,onSkip:Y,onError:X},null,8,["wallet-id"])]),_:1}),o(N,{value:4},{default:l(()=>[s("div",je,[o(b,{icon:"mdi-check-circle",size:"80",color:"success",class:"mb-4"}),e[22]||(e[22]=s("h2",{class:"text-h4 text-success mb-4"}," Wallet Activated Successfully! ",-1)),e[23]||(e[23]=s("p",{class:"text-body-1 mb-6"}," Your wallet has been successfully activated! We've sent your wallet PIN to your email. ",-1)),s("div",Ye,[e[17]||(e[17]=s("p",{class:"text-caption mb-2"},"Your Wallet PIN:",-1)),s("div",Ge,P($.value),1),e[18]||(e[18]=s("p",{class:"text-caption mt-2"},"Keep this PIN secure!",-1))]),o(U,{type:"warning",variant:"tonal",class:"mb-6",border:"start",density:"compact"},{default:l(()=>e[19]||(e[19]=[s("strong",null,"Important:",-1),u(" This PIN will be required to access your wallet and authorize transactions. Please store it in a secure place and never share it with anyone. ")])),_:1}),e[24]||(e[24]=s("p",{class:"text-body-2 mb-6"}," We've also sent this PIN to your email for your records. For security reasons, this is the only time we'll display your PIN on screen. ",-1)),s("div",qe,[o(C,{color:"primary",size:"default",class:"px-6",onClick:te},{default:l(()=>[o(b,{start:"",size:"18"},{default:l(()=>e[20]||(e[20]=[u("mdi-wallet")])),_:1}),e[21]||(e[21]=u(" Go to My Wallet "))]),_:1})])])]),_:1})]),_:1},8,["modelValue"]),o(be,null,{default:l(()=>[v.value?(p(),w(U,{key:0,type:z.value,variant:"tonal",class:"mt-4",density:"comfortable",border:"start",closable:"","onClick:close":e[3]||(e[3]=r=>v.value="")},{default:l(()=>[u(P(v.value),1)]),_:1},8,["type"])):E("",!0)]),_:1})]),_:1}),c.value<4?(p(),w(_e,{key:0,class:"action-buttons"},{default:l(()=>[c.value===2?(p(),w(C,{key:0,variant:"text",onClick:ae,"prepend-icon":"mdi-arrow-left",disabled:n.value},{default:l(()=>e[25]||(e[25]=[u(" Back ")])),_:1},8,["disabled"])):E("",!0),o(Te),c.value===2?(p(),w(C,{key:1,variant:"text",onClick:ee,disabled:x.value||n.value,"prepend-icon":"mdi-refresh"},{default:l(()=>e[26]||(e[26]=[u(" Resend Code ")])),_:1},8,["disabled"])):E("",!0)]),_:1})):E("",!0)]),_:1})}}},Le=K(De,[["__scopeId","data-v-9dd59b7c"]]),Ue={class:"activate-page-wrapper"},Ke=ve({__name:"activate",setup(O){const A=Fe();H(async()=>{await A.fetchTalaStageApp()});const i=d(()=>A.talastageApp);return Pe({title:d(()=>{var t;return`Activate Wallet - ${((t=i.value)==null?void 0:t.name)||"TalaStage"}`}),description:d(()=>"Activate your TalaStage wallet to start secure transactions."),keywords:d(()=>{var t;return`wallet, activate wallet, secure transactions, fund wallet, ${((t=i.value)==null?void 0:t.name)||"TalaStage"}`}),image:d(()=>{var t;return((t=i.value)==null?void 0:t.logo_url)||"/default-social-image.png"}),type:"website",siteName:d(()=>{var t;return((t=i.value)==null?void 0:t.name)||"TalaStage"}),url:d(()=>{var t;return`${((t=i.value)==null?void 0:t.canonical_url)||"https://talastage.com"}/wallet/activate`}),canonical:d(()=>{var t;return`${((t=i.value)==null?void 0:t.canonical_url)||"https://talastage.com"}/wallet/activate`}),openGraph:d(()=>{var t,f,V,h;return{title:`Activate Wallet - ${((t=i.value)==null?void 0:t.name)||"TalaStage"}`,description:"Activate your TalaStage wallet to start secure transactions.",url:`${((f=i.value)==null?void 0:f.canonical_url)||"https://talastage.com"}/wallet/activate`,image:((V=i.value)==null?void 0:V.logo_url)||"/default-social-image.png",siteName:((h=i.value)==null?void 0:h.name)||"TalaStage",type:"website"}}),twitter:d(()=>{var t,f;return{card:"summary_large_image",title:`Activate Wallet - ${((t=i.value)==null?void 0:t.name)||"TalaStage"}`,description:"Activate your TalaStage wallet to start secure transactions.",image:((f=i.value)==null?void 0:f.logo_url)||"/default-social-image.png"}}),link:d(()=>{var t;return[{rel:"icon",href:((t=i.value)==null?void 0:t.favicon_url)||"/favicon.ico"}]})}),(t,f)=>{const V=Le;return p(),I("div",Ue,[o(Ee,{class:"activate-container"},{default:l(()=>[o(V)]),_:1})])}}}),Ca=K(Ke,[["__scopeId","data-v-ac689355"]]);export{Ca as default};
