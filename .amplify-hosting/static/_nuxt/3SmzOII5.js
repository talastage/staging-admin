import{n as A,j as i,a6 as H,c as V,l as x,B as G,t as K,o as c,m as f,b as h,a0 as $,a1 as E,p as y,w as L,A as z,y as b,V as O,s as q,v as _,G as k,_ as J}from"./CGQimWOm.js";import{H as d}from"./DcSlHAeh.js";import{V as Q}from"./BSH7BhKc.js";const X={class:"thumbnail-wrapper"},Y={class:"thumbnail-container"},Z={class:"d-flex align-center justify-center fill-height"},ee={key:0,class:"buffering-overlay"},ae={key:1,class:"info-badge info-badge--views"},te={key:2,class:"info-badge info-badge--duration"},oe=3,D="/images/default-thumbnail.jpg",le=A({__name:"MediaThumbnail",props:{thumbnailUrl:{default:""},videoUrl:{default:""},label:{default:""},labelVariant:{default:"default"},size:{default:"md"},viewsCount:{default:void 0},showViews:{type:Boolean,default:!1},showDuration:{type:Boolean,default:!0}},setup(N){const l=N,s=i(!1),n=i(!1),r=i(!1),t=i(null),v=i(null),g=i(0),w=i(0),m=i(0);let u=null;H();const B=e=>e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString(),R=V(()=>typeof l.size=="string"?`size-${l.size}`:""),P=V(()=>l.labelVariant!=="default"?`label-badge--${l.labelVariant}`:""),C=V(()=>{const e=s.value?m.value:w.value;if(!e)return"";const a=Math.floor(e),o=Math.floor(a/3600),T=Math.floor(a%3600/60),p=a%60;return o>0?`${o}:${T.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`:`${T}:${p.toString().padStart(2,"0")}`});function I(e){const a=e.target;m.value=a.currentTime}function S(e,a){if(!d.isSupported()){a.src=e;return}v.value&&v.value.destroy();const o=new d;o.loadSource(e),o.attachMedia(a),o.on(d.Events.ERROR,(T,p)=>{p.fatal&&(r.value=!0)}),v.value=o}function M(){var a;const e=document.createElement("video");if(e.style.display="none",document.body.appendChild(e),e.onloadedmetadata=()=>{w.value=e.duration,e.parentNode===document.body&&document.body.removeChild(e)},e.onerror=()=>{e.parentNode===document.body&&document.body.removeChild(e)},(a=l.videoUrl)!=null&&a.endsWith(".m3u8")){if(d.isSupported()){const o=new d;o.loadSource(l.videoUrl),o.attachMedia(e),o.on(d.Events.MANIFEST_PARSED,()=>{setTimeout(()=>{w.value=e.duration,o.destroy(),e.parentNode===document.body&&document.body.removeChild(e)},1e3)})}}else l.videoUrl&&(e.src=l.videoUrl)}function U(){g.value<oe?(g.value++,setTimeout(()=>{var e;return(e=t.value)==null?void 0:e.load()},1e3)):(r.value=!0,s.value=!1,n.value=!1)}function F(){s.value=!0,n.value=!1}function W(){!r.value&&l.videoUrl&&(u&&clearTimeout(u),u=window.setTimeout(async()=>{if(t.value)try{t.value.currentTime=0,t.value.muted=!0,n.value=!0;const e=t.value.play();e&&await e}catch{U()}},300))}function j(){u&&clearTimeout(u),s.value=!1,n.value=!1,m.value=0,t.value&&(t.value.pause(),t.value.currentTime=0)}return x(()=>{l.videoUrl&&(M(),t.value&&(l.videoUrl.endsWith(".m3u8")?S(l.videoUrl,t.value):t.value.src=l.videoUrl))}),G(()=>{u&&clearTimeout(u),v.value&&v.value.destroy()}),K(()=>l.videoUrl,e=>{e&&(r.value=!1,s.value=!1,n.value=!1,g.value=0,m.value=0,M(),t.value&&(e.endsWith(".m3u8")?S(e,t.value):t.value.src=e))}),(e,a)=>(c(),f("div",{class:k(["media-thumbnail",R.value]),onMouseenter:W,onMouseleave:j,onClick:a[2]||(a[2]=o=>e.$emit("click"))},[h("div",X,[h("div",Y,[$(h("video",{ref_key:"previewRef",ref:t,class:"preview-video",muted:"",loop:"",playsinline:"",crossorigin:"anonymous",onError:U,onPlaying:F,onWaiting:a[0]||(a[0]=o=>n.value=!0),onTimeupdate:I},null,544),[[E,s.value&&!r.value]]),$(y(Q,{src:e.thumbnailUrl||D,"lazy-src":D,class:"thumbnail-image",cover:"",onError:a[1]||(a[1]=o=>r.value=!0)},{placeholder:L(()=>[h("div",Z,[y(z,{indeterminate:"",color:"grey-lighten-5",size:"32"})])]),_:1},8,["src"]),[[E,!s.value||r.value]]),n.value?(c(),f("div",ee,[y(z,{indeterminate:"",color:"white",size:"32"})])):b("",!0),e.showViews&&e.viewsCount!==void 0?(c(),f("div",ae,[y(O,{start:"",icon:"mdi-eye-outline",size:"14",class:"mr-1"}),q(" "+_(B(e.viewsCount)),1)])):b("",!0),e.showDuration&&C.value?(c(),f("div",te,_(C.value),1)):b("",!0),e.label?(c(),f("div",{key:3,class:k(["label-badge",P.value])},_(e.label),3)):b("",!0)])])],34))}}),re=J(le,[["__scopeId","data-v-710e009a"]]);export{re as _};
