import{_ as mt}from"./Cw5ECwNl.js";import{_ as ut}from"./DL649WMo.js";import{_ as pt}from"./BWXQ7vJw.js";import{_ as dt}from"./DlHEyw4l.js";import{_ as yt}from"./Corpgyop.js";import{_ as ft}from"./jRUxZAus.js";import{_ as _t,a as gt}from"./s7l6FqLC.js";import{j,E as O,g as K,n as X,k as vt,u as Y,i as xt,l as Z,o,m as _,p as n,w as s,q as $,x as t,s as c,b as i,a as u,A as bt,v as d,V as kt,F as V,D as L,y as P,U as wt,_ as tt,c as T,Q as ht}from"./CGQimWOm.js";import{u as Vt}from"./BCoct7aH.js";import{u as Pt}from"./B3G4pkyN.js";import{u as Tt}from"./YfmytIFT.js";import{b as H,a as M}from"./BkTuXOR_.js";import{V as Q}from"./P_q-BwEt.js";import{V as Ct}from"./CRY4crBU.js";import{V as G}from"./CS8xUUzH.js";import{a as Dt}from"./DsvAftJq.js";import{V as J}from"./BvtSni_j.js";import{u as $t}from"./BW5EWlXk.js";import{u as jt}from"./D78L5r-E.js";import{V as St}from"./BhN2__aY.js";import"./BeQTM7t9.js";import"./xvVMJZi9.js";import"./BSH7BhKc.js";import"./tTgLLTve.js";import"./3SmzOII5.js";import"./DcSlHAeh.js";import"./f5lwX8SZ.js";/* empty css        */import"./2hEmiBig.js";const zt=()=>{const C=j(!1),y=j(null),f=async(b,g,w=!1)=>{var k,v;C.value=!0;try{const{$axios:e}=K(),p={transaction_id:g};w?p.depositId=b:p.tx_ref=b;const r=await e.post("/api/payments/verify",p);return y.value=r.data,r.data}catch(e){const p={success:!1,message:((v=(k=e.response)==null?void 0:k.data)==null?void 0:v.message)||"Payment verification failed"};return y.value=p,p}finally{C.value=!1}};return{isVerifying:O(C),verificationResult:O(y),verifyPayment:f}},Rt={class:"payment-status-container"},At={class:"text-h6"},It={class:"text-center text-medium-emphasis"},Nt={class:"text-h5 mb-4"},Bt={class:"text-body-1 mb-4"},Ut={class:"text-body-1"},Et={class:"text-caption text-medium-emphasis ml-2"},Lt={class:"text-subtitle-1 font-weight-bold mb-3"},qt={key:2,class:"text-body-1 text-medium-emphasis"},Ft={class:"mt-6"},Wt={class:"text-center mt-4"},Ot=X({__name:"UserPaymentDetailPage",setup(C){const y=vt(),f=Y();xt();const{formatRelativeDate:b,formatLocalDateTime:g}=Vt(),{currencyFormatter:w}=Pt(),{verifyPayment:k,isVerifying:v}=zt(),{currentPayment:e,loading:p,error:r,fetchPaymentDetail:q,initPaymentDetail:B,getStatusColor:F,getStatusIcon:et,getPaymentTypeTitle:at,getRecipientTitle:st,formatStatus:ot,projectPaymentTypes:nt,fetchPayments:Qt}=Tt(),S=j([]),z=j(!1),U=j(!0),rt=l=>{y.push(`/watch/${l}`)},W=l=>{y.push(`/studio/projects/${l}/edit_draft`)},it=async()=>{try{z.value=!0;const{data:l}=await K().$axios.get("/api/user/payments",{params:{page:1,per_page:5}});S.value=l.payments.data}catch(l){console.error("Error fetching recent transactions:",l)}finally{z.value=!1}},lt=async()=>{var D;const l=f.query.status,a=f.query.tx_ref,R=f.query.transaction_id,x=f.query.depositId;if(console.log("Auto-verify check:",{status:l,txRef:a,depositId:x,transactionId:R,paymentStatus:(D=e.value)==null?void 0:D.status}),l==="successful"&&a||x){const A=!!x,h=a||x,I=R||x;console.log("Starting auto-verification...",{referenceToUse:h,transactionIdToUse:I,isPawaPay:A});const N=await k(h,I,A);console.log("Verification result:",N),N.success&&(await q(h),await wt(),y.replace({path:f.path,query:{}}))}};return Z(async()=>{try{U.value=!0,await B(),await lt(),await it()}catch(l){console.error("Error loading payment details:",l)}finally{U.value=!1}}),(l,a)=>{const R=mt,x=ut,D=pt,A=dt,h=yt,I=ft,N=_t,ct=gt;return o(),_("div",null,[n(R,{title:"Payment Details","margin-bottom":24},{actionable:s(()=>[n($,{variant:"text","prepend-icon":"mdi-arrow-left",onClick:a[0]||(a[0]=m=>t(y).push("/payments")),class:"font-weight-medium"},{default:s(()=>a[4]||(a[4]=[c(" Back to Payments ")])),_:1})]),_:1}),i("div",Rt,[t(p)||t(v)||U.value?(o(),u(x,{key:0},{default:s(()=>[n(H,{class:"d-flex align-center pb-2"},{default:s(()=>[n(bt,{indeterminate:"",color:"primary",size:"32",class:"mr-2"}),i("div",At,d(t(v)?"Verifying Payment...":"Loading Payment Details..."),1)]),_:1}),n(M,null,{default:s(()=>[i("p",It,d(t(v)?"Please wait while we confirm your payment status with the gateway...":"Loading your payment information..."),1)]),_:1})]),_:1})):t(r)?(o(),u(Q,{key:1,type:"error",class:"mb-4"},{default:s(()=>[c(d(t(r)),1)]),_:1})):t(e)?(o(),u(x,{key:2},{default:s(()=>[n(H,{class:"d-flex align-center pb-2"},{default:s(()=>[n(kt,{color:t(F)(t(e).status),size:"32",class:"mr-2"},{default:s(()=>[c(d(t(et)(t(e).status)),1)]),_:1},8,["color"]),c(" "+d(t(at)(t(e).payment_type)),1)]),_:1}),n(M,null,{default:s(()=>[n(Ct,null,{default:s(()=>[n(G,{cols:"12",sm:"6"},{default:s(()=>[a[5]||(a[5]=i("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Amount",-1)),i("div",Nt,d(t(w)(t(e).amount,t(e).currency.symbol,t(e).currency.code)),1),a[6]||(a[6]=i("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Status",-1)),n(Dt,{color:t(F)(t(e).status),"text-color":"white"},{default:s(()=>[c(d(t(ot)(t(e).status)),1)]),_:1},8,["color"])]),_:1}),n(G,{cols:"12",sm:"6"},{default:s(()=>[a[7]||(a[7]=i("div",{class:"text-subtitle-1 font-weight-bold mb-2"}," Reference ",-1)),i("div",Bt,d(t(e).reference),1),a[8]||(a[8]=i("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Date",-1)),i("div",Ut,[c(d(t(g)(t(e).created_at))+" ",1),i("span",Et," ("+d(t(b)(t(e).created_at))+") ",1)])]),_:1})]),_:1}),n(J,{class:"my-4"}),i("div",Lt,d(t(st)(t(e).payment_type)),1),t(e).payment_type==="tip"?(o(),_(V,{key:0},[t(e).recipient?(o(),u(D,{key:0,user:t(e).recipient,size:"medium",layout:"compact"},null,8,["user"])):t(e).recipients&&t(e).recipients.length?(o(!0),_(V,{key:1},L(t(e).recipients,(m,E)=>(o(),_("div",{key:E,class:"mb-3"},[n(D,{user:m,size:"medium",layout:"compact"},null,8,["user"])]))),128)):P("",!0)],64)):t(nt).includes(t(e).payment_type)?(o(),_(V,{key:1},[t(e).projects&&t(e).projects.length>0?(o(!0),_(V,{key:0},L(t(e).projects,(m,E)=>(o(),_("div",{key:m.id,class:"mb-4"},[n(h,{project:m,size:"md"},{actions:s(()=>[t(e).payment_type==="project_watching"?(o(),u(A,{key:0,"access-uuid":m.access_uuid,size:"md"},{default:s(()=>a[9]||(a[9]=[c(" Start Watching ")])),_:2},1032,["access-uuid"])):t(e).payment_type==="project_premiering"?(o(),u($,{key:1,color:"primary",variant:"tonal",size:"small","prepend-icon":"mdi-pencil",onClick:Gt=>W(m.access_uuid)},{default:s(()=>a[10]||(a[10]=[c(" Edit Draft ")])),_:2},1032,["onClick"])):P("",!0)]),_:2},1032,["project"]),E<t(e).projects.length-1?(o(),u(J,{key:0,class:"my-3"})):P("",!0)]))),128)):t(e).project?(o(),u(h,{key:1,project:t(e).project,size:"md"},{actions:s(()=>[t(e).payment_type==="project_watching"?(o(),u($,{key:0,color:"primary",variant:"tonal",size:"small","prepend-icon":"mdi-play-circle-outline",onClick:a[1]||(a[1]=m=>rt(t(e).project.access_uuid))},{default:s(()=>a[11]||(a[11]=[c(" Watch Now ")])),_:1})):t(e).payment_type==="project_premiering"?(o(),u($,{key:1,color:"primary",variant:"tonal",size:"small","prepend-icon":"mdi-pencil",onClick:a[2]||(a[2]=m=>W(t(e).project.access_uuid))},{default:s(()=>a[12]||(a[12]=[c(" Edit Draft ")])),_:1})):P("",!0)]),_:1},8,["project"])):(o(),_("div",qt," No projects found for this payment. "))],64)):P("",!0)]),_:1})]),_:1})):P("",!0)]),i("div",Ft,[n(I,{tag:"h2",size:"h5","margin-bottom":4},{default:s(()=>a[13]||(a[13]=[c(" Recent Transactions ")])),_:1}),z.value&&!S.value.length?(o(),_(V,{key:0},L(3,m=>n(N,{key:m})),64)):S.value.length?(o(),_(V,{key:1},[n(ct,{payments:S.value,loading:z.value},null,8,["payments","loading"]),i("div",Wt,[n($,{color:"primary",variant:"outlined",onClick:a[3]||(a[3]=m=>t(y).push("/payments"))},{default:s(()=>a[14]||(a[14]=[c(" View All Transactions ")])),_:1})])],64)):(o(),u(Q,{key:2,type:"info",variant:"tonal",class:"text-center"},{default:s(()=>a[15]||(a[15]=[c(" No payment history found ")])),_:1}))])])}}}),Ht=tt(Ot,[["__scopeId","data-v-2840bb9c"]]),Mt=X({__name:"payment-[reference]",setup(C){const f=Y().params.reference,b=$t();Z(async()=>{await b.fetchTalaStageApp()});const g=T(()=>b.talastageApp),w=T(()=>{var r;return(r=g.value)!=null&&r.name?`Payment Detail - ${g.value.name}`:"Payment Detail - TalaStage"}),k=T(()=>{var r;return`View the details of your payment with reference ${f} on ${((r=g.value)==null?void 0:r.name)||"TalaStage"}. Track payment status and get updates.`}),v=T(()=>{var r;return((r=g.value)==null?void 0:r.logo_url)||"/default-payment-image.png"}),e=T(()=>`${ht().public.frontendUrl}/payments/payment-${f}`),p=T(()=>{var r;return((r=g.value)==null?void 0:r.name)||"TalaStage"});return jt({title:w,description:k,keywords:"payment, detail, track, status, TalaStage",image:v,url:e,type:"website",siteName:p,twitterUsername:"@talastage",structuredDataFactory:()=>({"@context":"https://schema.org","@type":"WebPage",name:w.value,description:k.value,url:e.value,publisher:{"@type":"Organization",name:p.value,logo:{"@type":"ImageObject",url:v.value}}})}),(r,q)=>{const B=Ht;return o(),u(St,{class:"payment-detail-page"},{default:s(()=>[n(B)]),_:1})}}}),Ve=tt(Mt,[["__scopeId","data-v-62ecc345"]]);export{Ve as default};
