import{f as p,g as v,i as d,j as f,c as m,_,k as g,u as h,l as w,N as y,o as x,m as E,b as S}from"./CGQimWOm.js";import{D as N}from"./xshauNgU.js";const U=p("profile",()=>{const i=v(),l=i.$axios||i.$api||null,r=d(),n=f(!1),o=f(null),t=f(null),c=m(()=>{var a,u,s;return((u=(a=r.user)==null?void 0:a.value)==null?void 0:u.username)===((s=t.value)==null?void 0:s.username)});return{loading:n,error:o,userProfile:t,isProfileOwner:c,fetchProfile:async a=>{var u,s;if(!a)return o.value="Username is required",!1;if(((u=t.value)==null?void 0:u.username)===a)return!0;n.value=!0,o.value=null;try{if(l&&typeof l.get=="function"){const{data:e}=await l.get(`/api/user/${a}`);t.value=(e==null?void 0:e.user)??(e==null?void 0:e.data)??e}else{const e=await i.$fetch(`/api/user/${a}`);t.value=(e==null?void 0:e.user)??(e==null?void 0:e.data)??e}return!0}catch(e){return((s=e==null?void 0:e.response)==null?void 0:s.status)===404||(o.value=e instanceof Error?e.message:"Failed to load profile",console.error("Error fetching profile:",e)),!1}finally{n.value=!1}},updateUserPhoto:async a=>{var u;if(!((u=r.user)!=null&&u.value))throw new Error("User must be logged in to update photo");try{await l.post("/api/profile/update-photo",{photo:a}),r.user&&r.user.value&&(r.user.value.profile_photo=a),t.value&&c.value&&(t.value.profile_photo=a);try{r.user&&r.user.value&&localStorage.setItem("user",JSON.stringify(r.user.value))}catch{}return!0}catch(s){throw console.error("Error updating user photo:",s),s}},updateUsername:async a=>{var u;if(!((u=r.user)!=null&&u.value))throw new Error("User must be logged in to update username");try{await l.post("/api/profile/update-username",{username:a});const s=new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0];r.user&&r.user.value&&(r.user.value.username=a,r.user.value.can_change_username=!1,r.user.value.next_username_change_date=s),t.value&&c.value&&(t.value.username=a);try{r.user&&r.user.value&&localStorage.setItem("user",JSON.stringify(r.user.value))}catch{}return!0}catch(s){throw console.error("Error updating username:",s),s}},clearProfile:()=>{t.value=null,o.value=null,n.value=!1}}}),$={class:"profile-redirect"},A={__name:"index",setup(i){const l=g(),r=h(),n=U();return w(async()=>{try{const o=r.params.username;if(y.includes(o)){await l.replace("/404");return}await n.fetchProfile(o)?await l.replace(`/${o}/${N}`):await l.replace("/user-not-found")}catch(o){console.error("Navigation error:",o),await l.replace("/error")}}),(o,t)=>(x(),E("div",$,t[0]||(t[0]=[S("div",{class:"loading-spinner"},null,-1)])))}},R=_(A,[["__scopeId","data-v-85bd2bd1"]]);export{R as default};
