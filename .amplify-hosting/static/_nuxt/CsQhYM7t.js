import{g as D,j as f,c as h,E as v,n as A,t as x,l as F,o as b,a as L,bL as T,w as s,p as n,s as $,v as M,A as Q,m as U,b as E,y as j,X as O,Y as R,_ as H}from"./CGQimWOm.js";import{a as I,V as C}from"./tTgLLTve.js";import{V as N}from"./BvtSni_j.js";import{V as P}from"./xvVMJZi9.js";import{V as z}from"./BSH7BhKc.js";import{V as X}from"./DbQnG3uQ.js";const Y=()=>{const{$axios:_}=D(),u=f([]),t=f(!1),i=f(null),a=f(""),o=f(0),c=f(!1),k=h(()=>{if(!a.value)return u.value;const e=a.value.toLowerCase();return u.value.filter(r=>r.name.toLowerCase().includes(e))}),d=async(e={})=>{var r,m;t.value=!0,i.value=null;try{const l=new URLSearchParams;e.search&&l.append("search",e.search),e.country_id&&l.append("country_id",e.country_id.toString()),e.limit&&l.append("limit",e.limit.toString()),e.offset&&l.append("offset",e.offset.toString());const p=await _.get(`/api/banks/search?${l.toString()}`);return!e.offset||e.offset===0?u.value=p.data.banks||[]:u.value.push(...p.data.banks||[]),o.value=p.data.total||0,c.value=p.data.has_more||!1,p.data}catch(l){throw i.value=((m=(r=l.response)==null?void 0:r.data)==null?void 0:m.message)||"Error searching banks",console.error("Error searching banks:",l),l}finally{t.value=!1}},y=async(e={})=>await d(e),B=async(e={})=>{if(t.value||!c.value)return;const r=u.value.length;return await d({...e,offset:r})},V=()=>{a.value="",u.value=[],o.value=0,c.value=!1,i.value=null};let g;const w=(e,r=300)=>{clearTimeout(g),a.value=e,g=setTimeout(async()=>{e.trim()?await d({search:e,limit:50}):await y({limit:50})},r)},S=e=>u.value.find(r=>r.id===e);return{banks:v(u),loading:v(t),error:v(i),searchQuery:v(a),totalCount:v(o),hasMore:v(c),filteredBanks:k,fetchBanks:y,searchBanks:d,loadMoreBanks:B,clearSearch:V,debouncedSearch:w,getBankById:S}},G={key:1},J={class:"d-flex align-center"},K=A({__name:"SelectBank",props:{modelValue:{},banks:{},label:{default:"Choose a bank"},placeholder:{default:"Type to search..."},disabled:{type:Boolean,default:!1},countryId:{},hint:{},errorMessage:{},searchable:{type:Boolean,default:!0},showLogo:{type:Boolean,default:!0},loadOnMount:{type:Boolean,default:!0},searchDelay:{default:300}},emits:["update:modelValue","search","load-more","error"],setup(_,{emit:u}){const t=_,i=u,a=t.banks?null:Y(),o=f(t.modelValue||null),c=f(""),k=h(()=>{if(t.banks){if(!c.value)return t.banks;const e=c.value.toLowerCase();return t.banks.filter(r=>r.name.toLowerCase().includes(e))}return(a==null?void 0:a.filteredBanks.value)||[]}),d=h(()=>(a==null?void 0:a.loading.value)||!1),y=h(()=>!t.banks&&(a==null?void 0:a.hasMore.value)&&!d.value),B=h(()=>!t.banks&&a&&(a.totalCount.value>0||a.error.value)),V=h(()=>{if(!a)return"";if(a.error.value)return`Error: ${a.error.value}`;const e=a.totalCount.value,r=a.banks.value.length;return c.value?`Found ${k.value.length} of ${e} banks`:`Showing ${r} of ${e} banks`}),g=e=>{c.value=e,i("search",e),!t.banks&&a&&t.searchable&&a.debouncedSearch(e,t.searchDelay)},w=async()=>{if(!(!a||t.banks))try{i("load-more"),await a.loadMoreBanks({search:c.value||void 0,country_id:t.countryId})}catch(e){i("error",e.message||"Failed to load more banks")}},S=e=>{o.value=e,i("update:modelValue",e)};return x(()=>t.modelValue,e=>{o.value=e}),x(()=>t.countryId,e=>{!t.banks&&a&&(a.clearSearch(),a.fetchBanks({country_id:e,limit:50}))}),F(async()=>{if(!t.banks&&a&&t.loadOnMount)try{await a.fetchBanks({country_id:t.countryId,limit:50})}catch(e){i("error",e.message||"Failed to load banks")}}),(e,r)=>(b(),L(X,{label:e.label,items:k.value,"item-value":"id","item-title":"name",modelValue:o.value,"onUpdate:modelValue":[r[0]||(r[0]=m=>o.value=m),S],"onUpdate:search":g,dense:"","return-object":"",clearable:"",loading:d.value,disabled:e.disabled||d.value,placeholder:e.placeholder,"error-messages":e.errorMessage,hint:e.hint,"persistent-hint":!!e.hint,autocomplete:"","menu-props":{maxHeight:300}},T({item:s(({props:m,item:l})=>[n(C,O(R(m)),T({default:s(()=>[n(I,null,{default:s(()=>[$(M(l.raw.name),1)]),_:2},1024)]),_:2},[l.raw.logo_url?{name:"prepend",fn:s(()=>[n(P,{size:"24",class:"mr-2"},{default:s(()=>[n(z,{src:l.raw.logo_url,alt:l.raw.name},null,8,["src","alt"])]),_:2},1024)]),key:"0"}:void 0]),1040)]),_:2},[B.value?{name:"prepend-item",fn:s(()=>[n(C,{class:"text-caption text-medium-emphasis"},{default:s(()=>[n(I,null,{default:s(()=>[$(M(V.value),1)]),_:1})]),_:1}),n(N)]),key:"0"}:void 0,y.value?{name:"append-item",fn:s(()=>[n(N),n(C,{onClick:w,disabled:d.value},{default:s(()=>[n(I,{class:"text-center text-primary"},{default:s(()=>[d.value?(b(),L(Q,{key:0,size:"16",indeterminate:""})):(b(),U("span",G,"Load more banks..."))]),_:1})]),_:1},8,["disabled"])]),key:"1"}:void 0,o.value?{name:"selection",fn:s(({item:m})=>[E("div",J,[o.value.logo_url?(b(),L(P,{key:0,size:"20",class:"mr-2"},{default:s(()=>[n(z,{src:o.value.logo_url,alt:o.value.name},null,8,["src","alt"])]),_:1})):j("",!0),E("span",null,M(o.value.name),1)])]),key:"2"}:void 0]),1032,["label","items","modelValue","loading","disabled","placeholder","error-messages","hint","persistent-hint"]))}}),re=H(K,[["__scopeId","data-v-7f4ff898"]]);export{re as S};
