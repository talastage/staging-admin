import{u as ue,_ as me}from"./CvtmPE-9.js";import{n as G,j as P,o as u,m as h,M as ce,G as O,C as W,b as r,_ as Z,k as pe,u as fe,x as t,a as F,y as k,w as n,s as V,q as T,p as s,v as p,V as M,O as oe,J as ie,U as ve,c as q,t as ge,F as le,D as _e,r as he,K as Ve}from"./CGQimWOm.js";import{u as xe}from"./D5wOIWMa.js";import{A as Ue}from"./DnYNupeP.js";import{u as Se}from"./DMBY-Kaj.js";import{V as ye,a as re}from"./bFKGpjcd.js";import{a as N}from"./DsvAftJq.js";import{a as de,V as E,c as ke}from"./BkTuXOR_.js";import{V as we,a as se}from"./D9lJKT5N.js";import{V as K}from"./BvtSni_j.js";import{_ as ze}from"./C2h-HXtC.js";import{u as Ce,a as be}from"./BIU2l3Eu.js";import{_ as De}from"./SDo9db-O.js";import{_ as Fe}from"./PJxxQmvY.js";import{V as Me,a as $e,b as Re}from"./BxLb44po.js";import{V as qe}from"./GXZRJwQ4.js";const Pe=G({__name:"FileDropZone",emits:["drop","click"],setup(x,{emit:$}){const f=$,a=P(!1);function v(w){var U,z;a.value=!1;const _=(z=(U=w.dataTransfer)==null?void 0:U.files)==null?void 0:z[0];_&&f("drop",_)}return(w,_)=>(u(),h("div",{class:O(["file-drop-zone",{dragover:a.value}]),onDrop:W(v,["prevent"]),onDragover:_[0]||(_[0]=W(U=>a.value=!0,["prevent"])),onDragleave:_[1]||(_[1]=W(U=>a.value=!1,["prevent"]))},[ce(w.$slots,"default",{isDragOver:a.value},()=>[_[2]||(_[2]=r("p",null,"Drag and drop your video here or click to browse",-1))],!0)],34))}}),ne=Z(Pe,[["__scopeId","data-v-0524649f"]]);function Te(){const x=P(null);function $(o){return new Promise((i,d)=>{const c=document.createElement("video");c.preload="metadata",c.onloadedmetadata=()=>{const b={duration:c.duration,width:c.videoWidth,height:c.videoHeight};window.URL.revokeObjectURL(c.src),i(b)},c.onerror=()=>{d(new Error("Could not load video metadata"))},c.src=URL.createObjectURL(o)})}function f(o){return $(o).then(i=>i.duration)}function a(o){if(o===0)return"0 B";const i=1024,d=["B","KB","MB","GB"],c=Math.floor(Math.log(o)/Math.log(i));return`${parseFloat((o/Math.pow(i,c)).toFixed(2))} ${d[c]}`}function v(o){if(o<60)return`${Math.ceil(o)}s`;const i=Math.floor(o/60),d=Math.ceil(o%60);return`${i}m ${d}s`}function w(o){if(o<60)return`${Math.ceil(o)}s remaining`;const i=Math.floor(o/60),d=Math.ceil(o%60);return`${i}m ${d}s remaining`}function _(o,i){return o<=i}function U(o,i){return i.some(d=>o.toLowerCase()===`video/${d.toLowerCase()}`)}function z(o,i){return o<=i}function S(o){const i=(o==null?void 0:o.toLowerCase())||"";if(i==="4k"||i==="2160p")return{maxWidth:4096,maxHeight:2160};if(o==="1440p")return{maxWidth:2560,maxHeight:1440};if(o==="1080p")return{maxWidth:1920,maxHeight:1080};if(o==="720p")return{maxWidth:1280,maxHeight:720};if(o==="480p")return{maxWidth:854,maxHeight:480};if(o==="360p")return{maxWidth:640,maxHeight:360};if(o==="240p")return{maxWidth:426,maxHeight:240};const d=o.match(/(\d+)p?/);if(d){const c=parseInt(d[1],10);return{maxWidth:Math.round(c*16/9),maxHeight:c}}return{maxWidth:0,maxHeight:0}}function y(o,i,d){const{maxWidth:c,maxHeight:b}=S(d);return o<=c&&i<=b}async function R(o,i){if(x.value=null,i.maxFileSize&&!_(o.size,i.maxFileSize))return x.value=`File size exceeds the maximum allowed (${a(i.maxFileSize)}).`,{isValid:!1,error:x.value};if(i.allowedFormats&&i.allowedFormats.length>0&&!U(o.type,i.allowedFormats))return x.value=`Invalid file format. Only ${i.allowedFormats.join(", ")} videos are allowed.`,{isValid:!1,error:x.value};if(i.maxDuration!==void 0||i.maxResolution!==void 0)try{const d=await $(o);if(i.maxDuration!==void 0&&!z(d.duration,i.maxDuration))return x.value=`Video duration exceeds the maximum allowed (${v(i.maxDuration)}).`,{isValid:!1,error:x.value};if(i.maxResolution&&!y(d.width,d.height,i.maxResolution))return x.value=`Video resolution (${d.width}x${d.height}) exceeds the maximum allowed (${i.maxResolution}).`,{isValid:!1,error:x.value}}catch{return x.value="Could not validate video metadata. Please try another file.",{isValid:!1,error:x.value}}return{isValid:!0,error:null}}return{validateVideo:R,validateFileSize:_,validateFormat:U,validateDuration:z,validateResolution:y,parseResolution:S,validationError:x,getVideoDuration:f,getVideoMetadata:$,formatSize:a,formatDuration:v,formatTimeRemaining:w}}const Ie={class:"video-uploader-container"},je={class:"tab-content"},We={class:"tab-content"},He={class:"upload-panel"},Be={key:0,class:"upload-initial-state"},Le={class:"upload-content"},Ne={key:0,class:"requirements-section"},Ee={key:1,class:"upload-progress-state"},Oe={class:"progress-content"},Ae={class:"compact-file-info"},Ke={class:"file-header"},Ge={class:"file-name text-truncate"},Ze={class:"file-meta"},Je={class:"progress-section"},Qe={class:"progress-stats pa-2"},Xe={class:"upload-details"},Ye={key:0},ea={key:1},aa={class:"status-section"},ta={class:"upload-panel"},oa={key:0,class:"upload-initial-state"},ia={class:"upload-content"},la={key:0,class:"requirements-section"},ra={key:1,class:"upload-progress-state"},sa={class:"progress-content"},na={class:"compact-file-info"},da={class:"file-header"},ua={class:"file-name text-truncate"},ma={class:"file-meta"},ca={class:"progress-section"},pa={class:"progress-stats pa-2"},fa={class:"upload-details"},va={key:0},ga={key:1},_a={class:"status-section"},ha=G({__name:"VideoUploader",props:{requirementsData:{}},emits:["upload-progress","upload-uploaded","upload-error","upload-cancelled"],setup(x,{emit:$}){const f=$,a=xe(),v=ue(),w=Se(),_=pe(),U=fe(),{validateVideo:z,validationError:S,formatSize:y,formatTimeRemaining:R}=Te(),o=P("main"),i=P(null),d=P(null);function c(l){const e=l==="main"?i.value:d.value;e==null||e.click()}function b(l,e){var g,C;const D=(C=(g=l.target)==null?void 0:g.files)==null?void 0:C[0];D&&(m(),I(D,e)),l.target.value=""}async function H(l,e){var X,Y,ee,ae,te;const D=(X=v.requirements)!=null&&X.max_file_size?v.requirements.max_file_size*1024*1024:void 0,g=e==="main"?(Y=v.requirements)==null?void 0:Y.main_duration_limit:(ee=v.requirements)==null?void 0:ee.trailer_duration_limit,C=(ae=v.requirements)!=null&&ae.encoding_format?[v.requirements.encoding_format]:["MP4"],j=(te=v.requirements)==null?void 0:te.resolution_limit,{isValid:J,error:Q}=await z(l,{maxFileSize:D,maxDuration:g,allowedFormats:C,maxResolution:j});return!J&&Q&&w.error(Q),J}async function I(l,e){if(await H(l,e)){if(e==="main"&&!a.project)try{await a.createProject({name:l.name,premiering_category_slug:U.params.premiering_category_slug,file_type:e})}catch{w.error(a.error||"Project creation error");return}if(e==="trailer"&&!a.project){a.error="Please upload a main video first.",w.error(a.error);return}f("upload-progress",e,0);try{await a.uploadFile(l,e),f("upload-uploaded",e)}catch(g){f("upload-error",e,g),w.error(a.error||"Upload error")}}}async function B(l){a.cancelUpload(l),f("upload-cancelled",l),m(),l==="main"&&i.value?i.value.value="":l==="trailer"&&d.value&&(d.value.value="");const e=l==="main"?a.mainUpload:a.trailerUpload;e.isUploading=!1,e.processingStatus="pending",e.progress=0,e.fileName=null,e.fileSize=0,e.uploadedSize=0,e.error=null,await ve()}function A(){_.push("/wallet/deposit")}function L(l){switch(l==null?void 0:l.toLowerCase()){case"completed":return"success";case"processing":return"info";case"failed":return"error";case"cancelled":return"warning";default:return"primary"}}function m(){S.value=null}return(l,e)=>{const D=me;return u(),h("div",Ie,[t(a).error||t(S)?(u(),F(Ue,{key:0,message:t(S)||t(a).error,type:"error",visible:!0},null,8,["message"])):k("",!0),t(a).insufficientFunds?(u(),F(T,{key:1,color:"primary",class:"mb-4",onClick:A},{default:n(()=>e[12]||(e[12]=[V(" Top Up ")])),_:1})):k("",!0),s(E,{elevation:"10"},{default:n(()=>[s(ye,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=g=>o.value=g),grow:"",class:"upload-tabs"},{default:n(()=>[s(re,{value:"main"},{default:n(()=>[r("div",je,[e[13]||(e[13]=r("span",null,"Main Video",-1)),t(a).mainUpload.isUploading?(u(),F(N,{key:0,size:"small",color:"primary",class:"ml-2"},{default:n(()=>[V(p(Math.ceil(t(a).mainUpload.progress))+"% ",1)]),_:1})):k("",!0)])]),_:1}),s(re,{value:"trailer",disabled:!t(a).canUploadTrailer},{default:n(()=>[r("div",We,[e[14]||(e[14]=r("span",null,"Trailer",-1)),t(a).trailerUpload.isUploading?(u(),F(N,{key:0,size:"small",color:"primary",class:"ml-2"},{default:n(()=>[V(p(Math.ceil(t(a).trailerUpload.progress))+"% ",1)]),_:1})):k("",!0)])]),_:1},8,["disabled"])]),_:1},8,["modelValue"]),s(de,null,{default:n(()=>[s(we,{modelValue:o.value,"onUpdate:modelValue":e[11]||(e[11]=g=>o.value=g)},{default:n(()=>[s(se,{value:"main"},{default:n(()=>{var g;return[r("div",He,[t(a).mainUpload.processingStatus==="pending"&&!t(a).mainUpload.isUploading?(u(),h("div",Be,[s(ne,{onDrop:e[3]||(e[3]=C=>I(C,"main")),onClick:e[4]||(e[4]=()=>c("main"))},{default:n(({isDragOver:C})=>[r("div",{class:O(["upload-zone",{"upload-zone--dragover":C}])},[r("input",{ref_key:"mainFileInput",ref:i,type:"file",accept:"video/mp4",class:"hidden-input",onChange:e[1]||(e[1]=j=>b(j,"main"))},null,544),r("div",Le,[s(M,{icon:"mdi-cloud-upload",color:"primary",size:"large",class:"upload-icon mb-4"}),e[17]||(e[17]=r("h3",{class:"upload-title"},"Upload Main Video",-1)),e[18]||(e[18]=r("p",{class:"upload-description"}," Drag and drop your video here or click to browse ",-1)),s(T,{color:"primary",class:"select-btn mt-4",elevation:"0",onClick:e[2]||(e[2]=W(()=>c("main"),["stop"]))},{default:n(()=>[s(M,{left:""},{default:n(()=>e[15]||(e[15]=[V("mdi-plus")])),_:1}),e[16]||(e[16]=V(" Select Video "))]),_:1})])],2)]),_:1}),(g=l.requirementsData)!=null&&g.main?(u(),h("div",Ne,[s(K,{class:"my-4"}),e[19]||(e[19]=r("h4",{class:"requirements-title"},"Upload Requirements",-1)),s(D,oe(l.requirementsData.main,{class:"mt-2"}),null,16)])):k("",!0)])):(u(),h("div",Ee,[t(a).mainUpload.processingStatus!=="completed"&&t(a).mainUpload.processingStatus!=="failed"?(u(),F(T,{key:0,variant:"outlined",color:"error",size:"small",onClick:e[5]||(e[5]=()=>B("main")),class:"cancel-btn"},{default:n(()=>e[20]||(e[20]=[V(" Cancel ")])),_:1})):k("",!0),r("div",Oe,[r("div",Ae,[r("div",Ke,[s(M,{size:"small",icon:"mdi-video",class:"mr-2"}),r("span",Ge,p(t(a).mainUpload.fileName),1)]),r("div",Ze,p(t(y)(t(a).mainUpload.fileSize)),1)]),r("div",Je,[s(ie,{"model-value":t(a).mainUpload.processingStatus==="completed"?100:t(a).mainUpload.progress,color:t(a).mainUpload.processingStatus==="completed"?"success":"primary",height:"6",rounded:"",striped:""},null,8,["model-value","color"]),r("div",Qe,[r("div",Xe,[r("span",null,p(t(y)(t(a).mainUpload.uploadedSize))+" / "+p(t(y)(t(a).mainUpload.fileSize)),1),t(a).mainUpload.speed?(u(),h("span",Ye,p(t(y)(t(a).mainUpload.speed))+"/s ",1)):k("",!0),t(a).mainUpload.estimatedTimeRemaining?(u(),h("span",ea,p(t(R)(t(a).mainUpload.estimatedTimeRemaining)),1)):k("",!0)]),r("div",aa,[s(N,{color:L(t(a).mainUpload.processingStatus),size:"small",class:"text-capitalize ml-2"},{default:n(()=>[V(p(t(a).mainUpload.processingStatus),1)]),_:1},8,["color"])])])])])]))])]}),_:1}),s(se,{value:"trailer"},{default:n(()=>{var g;return[r("div",ta,[t(a).trailerUpload.processingStatus==="pending"&&!t(a).trailerUpload.isUploading?(u(),h("div",oa,[s(ne,{onDrop:e[8]||(e[8]=C=>I(C,"trailer")),onClick:e[9]||(e[9]=()=>c("trailer"))},{default:n(({isDragOver:C})=>[r("div",{class:O(["upload-zone",{"upload-zone--dragover":C}])},[r("input",{ref_key:"trailerFileInput",ref:d,type:"file",accept:"video/mp4",class:"hidden-input",onChange:e[6]||(e[6]=j=>b(j,"trailer"))},null,544),r("div",ia,[s(M,{icon:"mdi-cloud-upload",color:"primary",size:"large",class:"upload-icon mb-4"}),e[23]||(e[23]=r("h3",{class:"upload-title"},"Upload Trailer Video",-1)),e[24]||(e[24]=r("p",{class:"upload-description"}," Drag and drop your video here or click to browse ",-1)),s(T,{color:"primary",class:"select-btn mt-4",elevation:"0",onClick:e[7]||(e[7]=W(()=>c("trailer"),["stop"]))},{default:n(()=>[s(M,{left:""},{default:n(()=>e[21]||(e[21]=[V("mdi-plus")])),_:1}),e[22]||(e[22]=V(" Select Video "))]),_:1})])],2)]),_:1}),(g=l.requirementsData)!=null&&g.trailer?(u(),h("div",la,[s(K,{class:"my-4"}),e[25]||(e[25]=r("h4",{class:"requirements-title"},"Upload Requirements",-1)),s(D,oe(l.requirementsData.trailer,{class:"mt-2"}),null,16)])):k("",!0)])):(u(),h("div",ra,[t(a).trailerUpload.processingStatus!=="completed"&&t(a).trailerUpload.processingStatus!=="failed"?(u(),F(T,{key:0,variant:"outlined",color:"error",size:"small",onClick:e[10]||(e[10]=()=>B("trailer")),class:"cancel-btn"},{default:n(()=>e[26]||(e[26]=[V(" Cancel ")])),_:1})):k("",!0),r("div",sa,[r("div",na,[r("div",da,[s(M,{size:"small",icon:"mdi-video",class:"mr-2"}),r("span",ua,p(t(a).trailerUpload.fileName),1)]),r("div",ma,p(t(y)(t(a).trailerUpload.fileSize)),1)]),r("div",ca,[s(ie,{"model-value":t(a).trailerUpload.processingStatus==="completed"?100:t(a).trailerUpload.progress,color:t(a).trailerUpload.processingStatus==="completed"?"success":"primary",height:"6",rounded:"",striped:""},null,8,["model-value","color"]),r("div",pa,[r("div",fa,[r("span",null,p(t(y)(t(a).trailerUpload.uploadedSize))+" / "+p(t(y)(t(a).trailerUpload.fileSize)),1),t(a).trailerUpload.speed?(u(),h("span",va,p(t(y)(t(a).trailerUpload.speed))+"/s ",1)):k("",!0),t(a).trailerUpload.estimatedTimeRemaining?(u(),h("span",ga,p(t(R)(t(a).trailerUpload.estimatedTimeRemaining)),1)):k("",!0)]),r("div",_a,[s(N,{color:L(t(a).trailerUpload.processingStatus),size:"small",class:"text-capitalize ml-2"},{default:n(()=>[V(p(t(a).trailerUpload.processingStatus),1)]),_:1},8,["color"])])])])])]))])]}),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])}}}),Ha=Z(ha,[["__scopeId","data-v-226979a3"]]),Va=["onClick"],xa={class:"text-caption"},Ua={key:1,class:"step-content"},Sa={class:"text-caption"},ya=G({__name:"PremieringProjectSteppers",props:{modelValue:{},project:{},mode:{}},emits:["update:modelValue","finish","payment-failed"],setup(x,{emit:$}){const f=x,a=$,v=Ce(),w=P(null),_=P(!0),U=P(1),z=q(()=>[{value:1,title:"Project Details",icon:"mdi-file-document-outline",component:ze},{value:2,title:"Investors",icon:"mdi-account-group",component:De},{value:3,title:"Credits",icon:"mdi-format-list-text",component:Fe},{value:4,title:"Premiering Settings",icon:"mdi-cog",component:be}]),S=q(()=>v.processingAction!==null),y=q(()=>f.modelValue===1),R=q(()=>f.modelValue===z.value.length),o=q(()=>{const m=z.value.find(l=>l.value===f.modelValue);return m?m.component:null}),i=q(()=>v.actionTitle),d=q(()=>v.actionIcon),c=q(()=>v.actionColor);ge(()=>f.modelValue,m=>{U.value=Math.max(U.value,m),_.value=!0},{immediate:!0});function b(m){return!S.value&&m<=U.value}function H(m){return f.modelValue===m?"primary":f.modelValue>m?"success":"grey"}function I(m){b(m)&&a("update:modelValue",m)}function B(){!y.value&&!S.value&&a("update:modelValue",f.modelValue-1)}async function A(){var m;if(!S.value)if(R.value){const l=w.value;if(!l)return;try{const e=l.getMissingRequiredFields();if(e.length>0){l.missingFields=e,l.showMissingFieldsDialog=!0;return}const D=(m=f.project)==null?void 0:m.access_uuid;switch(v.publishOption){case"schedule":await l.handleSchedule();break;case"draft":await l.handleDraft();break;default:await l.handlePremiereNow()}a("finish")}catch(e){console.error("Error in handleNext:",e)}}else{const l=f.modelValue+1;U.value=Math.max(U.value,l),a("update:modelValue",l)}}function L(m){a("payment-failed",m)}return(m,l)=>(u(),h("div",{class:O(["stepper-wrapper",{processing:S.value}])},[s(E,{elevation:"10",class:"mb-4"},{default:n(()=>[s(Me,{"model-value":m.modelValue,"alt-labels":"",density:"compact"},{default:n(()=>[s($e,null,{default:n(()=>[(u(!0),h(le,null,_e(z.value,(e,D)=>(u(),h(le,{key:e.value},[s(Re,{value:e.value,complete:m.modelValue>e.value,disabled:!b(e.value),class:"compact-step"},{default:n(()=>[b(e.value)?(u(),h("div",{key:0,class:"step-content clickable",onClick:g=>I(e.value)},[s(M,{size:"small",color:H(e.value)},{default:n(()=>[V(p(e.icon),1)]),_:2},1032,["color"]),r("div",xa,p(e.title),1)],8,Va)):(u(),h("div",Ua,[s(M,{size:"small",color:H(e.value)},{default:n(()=>[V(p(e.icon),1)]),_:2},1032,["color"]),r("div",Sa,p(e.title),1)]))]),_:2},1032,["value","complete","disabled"]),D<z.value.length-1?(u(),F(K,{key:0})):k("",!0)],64))),128))]),_:1})]),_:1},8,["model-value"])]),_:1}),s(E,{elevation:"10",class:"mb-4"},{default:n(()=>[s(de,{class:"pa-4"},{default:n(()=>[(u(),F(Ve,null,[(u(),F(he(o.value),{ref_key:"componentRef",ref:w,project:m.project,onPaymentFailed:L},null,40,["project"]))],1024))]),_:1})]),_:1}),s(E,{elevation:"10"},{default:n(()=>[s(ke,{class:"d-flex justify-space-between pa-3"},{default:n(()=>[y.value?k("",!0):(u(),F(T,{key:0,variant:"text",density:"comfortable",disabled:S.value,onClick:B},{default:n(()=>[s(M,{start:"",size:"small"},{default:n(()=>l[0]||(l[0]=[V("mdi-arrow-left")])),_:1}),l[1]||(l[1]=V(" Back "))]),_:1},8,["disabled"])),s(qe),s(T,{loading:S.value,disabled:S.value||!_.value,color:R.value?c.value:"primary",density:"comfortable",onClick:A},{default:n(()=>[V(p(R.value?i.value:"Continue")+" ",1),s(M,{end:"",size:"small"},{default:n(()=>[V(p(R.value?d.value:"mdi-arrow-right"),1)]),_:1})]),_:1},8,["loading","disabled","color"])]),_:1})]),_:1})],2))}}),Ba=Z(ya,[["__scopeId","data-v-ffaa6f83"]]);export{Ha as _,Ba as a};
