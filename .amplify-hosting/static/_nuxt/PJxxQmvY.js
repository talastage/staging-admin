import{_ as Ve}from"./Cw5ECwNl.js";import{u as we,_ as xe}from"./CIrzxJ5u.js";import{_ as he}from"./DyXR0ZQU.js";import{B as W}from"./COhe-ksk.js";import{n as Y,dX as Z,g as ee,j as u,c as L,l as J,o as A,a as H,w as e,b as C,p as t,q as E,V as j,s as d,v as T,m as K,dZ as ie,y as q,bL as de,O as ue,B as ce,F as je,_ as me,t as De}from"./CGQimWOm.js";import{u as fe}from"./Rg_xdRgE.js";import{V as Q}from"./BhN2__aY.js";import{V as te}from"./CRY4crBU.js";import{V as le}from"./CS8xUUzH.js";import{V as ve}from"./xvVMJZi9.js";import{V as pe}from"./BSH7BhKc.js";import{V as ge}from"./BvtSni_j.js";import{V as ye}from"./DbQnG3uQ.js";import{V as ae,a as ke}from"./BkTuXOR_.js";import{V as be}from"./dGPA57P0.js";import{a as _e}from"./DsvAftJq.js";import{V as Ce}from"./tTgLLTve.js";import{V as oe}from"./GXZRJwQ4.js";import{b as Se}from"./2hEmiBig.js";import{_ as Ee}from"./DM0UXmJz.js";import{u as Re}from"./De3D2xlH.js";const Ue={class:"d-flex align-center"},$e={class:"text-h6"},Be={class:"d-flex align-center mb-6"},Me={class:"text-h6"},Te={class:"text-body-2 text-medium-emphasis"},Ae={class:"role-selection"},Fe={key:0,class:"role-mode-selector mb-3"},Pe={class:"d-flex align-center mb-2"},Ie=Y({__name:"SelectRoleDialog",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","back","confirm"],setup(N,{emit:$}){const i=N,p=$,D=Z(),{$axios:R}=ee(),V=fe(),c=u(!1),b=u(!1),w=u(!1),v=u(null),r=u(null),S=u([]),x=u([]),n=u("existing"),h=L({get:()=>i.modelValue,set:s=>p("update:modelValue",s)}),g=L(()=>v.value&&r.value),U=async()=>{b.value=!0;try{const{data:s}=await R.get("/guest/talent/categories");S.value=s.data}catch(s){console.error("Error fetching categories:",s),D.error("Failed to load role categories")}finally{b.value=!1}},B=async s=>{if(s){w.value=!0;try{await V.fetchCategoryTalents(s),x.value=V.talents}catch(o){console.error("Error fetching talents:",o),D.error("Failed to load talents"),x.value=[]}finally{w.value=!1}}},M=async s=>{if(r.value=null,x.value=[],n.value="existing",s){const o=S.value.find(P=>P.id===s);o!=null&&o.slug&&await B(o.slug)}},_=s=>s?typeof s=="string"||typeof s=="object"&&!s.id:!1,F=s=>s?typeof s=="string"?s:typeof s=="object"&&s.name||"":"",z=()=>{if(!r.value||!v.value)return;const s={categoryId:v.value,...n.value==="custom"||typeof r.value=="string"?{customRole:typeof r.value=="string"?r.value:r.value.name}:{talent:r.value}};p("confirm",s)},G=()=>{p("back"),m()},m=()=>{v.value=null,r.value=null,x.value=[],n.value="existing"};return J(U),(s,o)=>{const P=W;return A(),H(P,{modelValue:h.value,"onUpdate:modelValue":o[3]||(o[3]=l=>h.value=l),"max-width":"600px","show-close-button":!1},{title:e(()=>[C("div",Ue,[t(E,{icon:"mdi-arrow-left",variant:"text",onClick:G,class:"mr-2",disabled:c.value},{default:e(()=>[t(j,null,{default:e(()=>o[4]||(o[4]=[d("mdi-arrow-left")])),_:1})]),_:1},8,["disabled"]),C("span",$e,"Add Role for "+T(s.user.display_name),1)])]),default:e(()=>[t(Q,{class:"pa-4"},{default:e(()=>[t(te,null,{default:e(()=>[t(le,{cols:"12"},{default:e(()=>[C("div",Be,[t(ve,{size:"48",class:"mr-4"},{default:e(()=>[t(pe,{src:s.user.profile_photo,alt:s.user.display_name},{placeholder:e(()=>[t(j,null,{default:e(()=>o[5]||(o[5]=[d("mdi-account")])),_:1})]),_:1},8,["src","alt"])]),_:1}),C("div",null,[C("div",Me,T(s.user.display_name),1),C("div",Te,T(s.user.talent||"No talent specified"),1)])]),t(ge,{class:"mb-6"}),C("div",Ae,[t(ye,{modelValue:v.value,"onUpdate:modelValue":[o[0]||(o[0]=l=>v.value=l),M],items:S.value,"item-title":"name","item-value":"id",label:"Select Category",variant:"outlined",density:"comfortable",class:"mb-4",loading:b.value,disabled:c.value,clearable:""},{prepend:e(()=>[t(j,{color:"primary"},{default:e(()=>o[6]||(o[6]=[d("mdi-shape-outline")])),_:1})]),_:1},8,["modelValue","items","loading","disabled"]),v.value?(A(),K("div",Fe,[t(ae,{variant:"flat",border:"",class:"pa-3 bg-grey-lighten-5"},{default:e(()=>[C("div",Pe,[t(j,{color:"info",class:"mr-2"},{default:e(()=>o[7]||(o[7]=[d("mdi-information-outline")])),_:1}),o[8]||(o[8]=C("span",{class:"text-body-2"},"Choose how you want to specify the role:",-1))]),t(ie,{modelValue:n.value,"onUpdate:modelValue":o[1]||(o[1]=l=>n.value=l),mandatory:"",color:"primary",rounded:"pill",class:"mb-1"},{default:e(()=>[t(E,{value:"existing",disabled:c.value},{default:e(()=>[t(j,{start:""},{default:e(()=>o[9]||(o[9]=[d("mdi-format-list-bulleted")])),_:1}),o[10]||(o[10]=d(" Select Existing Role "))]),_:1},8,["disabled"]),t(E,{value:"custom",disabled:c.value},{default:e(()=>[t(j,{start:""},{default:e(()=>o[11]||(o[11]=[d("mdi-pencil-plus")])),_:1}),o[12]||(o[12]=d(" Create Custom Role "))]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})])):q("",!0),t(be,{modelValue:r.value,"onUpdate:modelValue":o[2]||(o[2]=l=>r.value=l),items:n.value==="custom"?[]:x.value,"item-title":"name","return-object":"",label:n.value==="custom"?"Enter custom role name":"Select a role",variant:"outlined",density:"comfortable",loading:w.value,disabled:!v.value||c.value,hint:n.value==="custom"?"Type any role title you need":"Choose from available roles","persistent-hint":"",clearable:"","hide-no-data":n.value==="custom"},de({prepend:e(()=>[t(j,{color:n.value==="custom"?"secondary":"primary"},{default:e(()=>[d(T(n.value==="custom"?"mdi-pencil-plus":"mdi-account-tie"),1)]),_:1},8,["color"])]),selection:e(({item:l})=>[t(_e,{color:_(l.raw)?"secondary":"primary",variant:"flat"},{default:e(()=>[d(T(F(l.raw))+" ",1),_(l.raw)?(A(),H(j,{key:0,size:"small",class:"ml-1"},{default:e(()=>o[13]||(o[13]=[d(" mdi-pencil-outline ")])),_:1})):q("",!0)]),_:2},1032,["color"])]),item:e(({item:l,props:a})=>[t(Ce,ue(a,{title:l.raw.name}),null,16,["title"])]),_:2},[n.value==="custom"?{name:"append",fn:e(()=>[t(j,{color:"secondary"},{default:e(()=>o[14]||(o[14]=[d("mdi-pencil")])),_:1})]),key:"0"}:void 0]),1032,["modelValue","items","label","loading","disabled","hint","hide-no-data"])])]),_:1})]),_:1})]),_:1})]),actions:e(()=>[t(oe),t(E,{color:"grey-darken-1",variant:"text",onClick:G,disabled:c.value},{default:e(()=>o[15]||(o[15]=[d(" Cancel ")])),_:1},8,["disabled"]),t(E,{color:"primary",onClick:z,loading:c.value,disabled:!g.value},{default:e(()=>o[16]||(o[16]=[d(" Confirm Role ")])),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"])}}}),Le={key:0,class:"text-center text-medium-emphasis mt-4"},Ne=Y({__name:"AddProjectCreditDialog",props:{modelValue:Boolean,project:{type:Object,required:!0}},emits:["update:modelValue","credit-added"],setup(N,{emit:$}){const i=N,p=$,D=Z(),{$axios:R}=ee(),V=u(!1),c=u(null),b=u(!1),w=L({get:()=>i.modelValue,set:h=>p("update:modelValue",h)}),v=h=>{c.value=h,w.value=!1,b.value=!0},r=()=>{b.value=!1,w.value=!0},S=async({talent:h,categoryId:g,customRole:U})=>{var B,M;if(c.value){V.value=!0;try{const _={user_id:c.value.id,talent_category_id:g,...U?{custom_role:U}:{talent_id:h.id}},{data:F}=await R.post(`/api/projects/${i.project.access_uuid}/credits`,_);D.success("Member added successfully"),p("credit-added",F.data),x()}catch(_){console.error("Error adding member:",_),D.error(((M=(B=_==null?void 0:_.response)==null?void 0:B.data)==null?void 0:M.message)||"Failed to add member")}finally{V.value=!1}}},x=()=>{w.value=!1,b.value=!1,c.value=null},n=h=>{h.key==="Escape"&&(b.value?r():w.value&&x())};return J(()=>{window.addEventListener("keydown",n)}),ce(()=>{window.removeEventListener("keydown",n)}),(h,g)=>{const U=he,B=W,M=Ie;return A(),K(je,null,[t(B,{modelValue:w.value,"onUpdate:modelValue":g[0]||(g[0]=_=>w.value=_),title:"Add Cast & Crew Member","max-width":"700px",persistent:V.value},{default:e(()=>[t(Q,{class:"pa-4"},{default:e(()=>[t(te,null,{default:e(()=>[t(le,{cols:"12"},{default:e(()=>[t(ae,{variant:"flat",class:"mb-4"},{default:e(()=>[t(ke,null,{default:e(()=>[t(U,{onUserSelected:v,loading:V.value,placeholder:"Search for cast or crew member..."},{"user-action":e(({user:_,selectUser:F})=>[t(E,{color:"primary",variant:"tonal",size:"small",onClick:F,loading:V.value},{default:e(()=>g[2]||(g[2]=[d(" Select ")])),_:2},1032,["onClick","loading"])]),_:1},8,["loading"]),t(Se,null,{default:e(()=>[c.value?q("",!0):(A(),K("div",Le,[t(j,null,{default:e(()=>g[3]||(g[3]=[d("mdi-information-outline")])),_:1}),g[4]||(g[4]=C("div",{class:"text-body-2 mt-1"}," Search and select a user to add them to your project ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),actions:e(()=>[t(oe),t(E,{color:"grey-darken-1",variant:"text",onClick:x,disabled:V.value},{default:e(()=>g[5]||(g[5]=[d(" Cancel ")])),_:1},8,["disabled"])]),_:1},8,["modelValue","persistent"]),c.value?(A(),H(M,{key:0,modelValue:b.value,"onUpdate:modelValue":g[1]||(g[1]=_=>b.value=_),user:c.value,onBack:r,onConfirm:S},null,8,["modelValue","user"])):q("",!0)],64)}}}),ze=me(Ne,[["__scopeId","data-v-07167728"]]),Ge={class:"d-flex align-center"},qe={class:"text-h6"},Oe={class:"d-flex align-center mb-6"},He={class:"text-h6"},Ke={class:"text-body-2 text-medium-emphasis"},Xe={class:"role-selection"},Ye={key:0,class:"role-mode-selector mb-3"},Ze={class:"d-flex align-center mb-2"},Je=Y({__name:"EditProjectCreditDialog",props:{modelValue:{type:Boolean},credit:{},projectAccessUuid:{}},emits:["update:modelValue","credit-updated"],setup(N,{emit:$}){const i=N,p=$,D=Z(),{$axios:R}=ee(),V=fe(),c=u(!1),b=u(!1),w=u(!1),v=u(null),r=u(null),S=u([]),x=u([]),n=u("existing"),h=L({get:()=>i.modelValue,set:l=>p("update:modelValue",l)}),g=L(()=>v.value&&r.value&&U.value),U=L(()=>{var y,f;if(!i.credit)return!1;const l=v.value!==((f=(y=i.credit.role)==null?void 0:y.category)==null?void 0:f.id),a=B();return l||a}),B=()=>{var l,a,y,f;return!i.credit||!r.value?!1:typeof r.value=="string"?r.value!==((l=i.credit.role)==null?void 0:l.name):typeof r.value=="object"?(a=i.credit.role)!=null&&a.is_custom?r.value.name!==((y=i.credit.role)==null?void 0:y.name):r.value.id!==((f=i.credit.role)==null?void 0:f.id):!1},M=async()=>{b.value=!0;try{const{data:l}=await R.get("/guest/talent/categories");S.value=l.data}catch(l){console.error("Error fetching categories:",l),D.error("Failed to load role categories")}finally{b.value=!1}},_=async l=>{if(l){w.value=!0;try{await V.fetchCategoryTalents(l),x.value=V.talents}catch(a){console.error("Error fetching talents:",a),D.error("Failed to load talents"),x.value=[]}finally{w.value=!1}}},F=async l=>{if(r.value=null,x.value=[],l){const a=S.value.find(y=>y.id===l);a!=null&&a.slug&&await _(a.slug)}},z=l=>l?typeof l=="string"||typeof l=="object"&&!l.id:!1,G=l=>l?typeof l=="string"?l:typeof l=="object"&&l.name||"":"",m=async()=>{var l,a,y;if(i.credit){if(v.value=((a=(l=i.credit.role)==null?void 0:l.category)==null?void 0:a.id)||null,v.value){const f=S.value.find(I=>I.id===v.value);f!=null&&f.slug&&await _(f.slug)}if((y=i.credit.role)!=null&&y.is_custom)n.value="custom",r.value=i.credit.role.name;else{n.value="existing";const f=x.value.find(I=>{var O;return I.id===((O=i.credit.role)==null?void 0:O.id)});r.value=f||null}}},s=async()=>{var l,a;if(!(!i.credit||!r.value||!v.value)){c.value=!0;try{const y={talent_category_id:v.value,...n.value==="custom"||typeof r.value=="string"?{custom_role:typeof r.value=="string"?r.value:r.value.name,talent_id:null}:{talent_id:r.value.id,custom_role:null}},{data:f}=await R.patch(`/api/projects/${i.projectAccessUuid}/credits/${i.credit.id}`,y);D.success("Member role updated successfully"),p("credit-updated",f.data),o()}catch(y){console.error("Error updating credit:",y),D.error(((a=(l=y==null?void 0:y.response)==null?void 0:l.data)==null?void 0:a.message)||"Failed to update member role")}finally{c.value=!1}}},o=()=>{h.value=!1,P()},P=()=>{v.value=null,r.value=null,x.value=[],n.value="existing"};return De(()=>i.modelValue,async l=>{l&&i.credit&&await m()}),J(M),(l,a)=>{const y=W;return A(),H(y,{modelValue:h.value,"onUpdate:modelValue":a[3]||(a[3]=f=>h.value=f),"max-width":"600px",persistent:c.value},{title:e(()=>{var f,I;return[C("div",Ge,[C("span",qe,"Edit Role for "+T((I=(f=l.credit)==null?void 0:f.user)==null?void 0:I.display_name),1)])]}),default:e(()=>[t(Q,{class:"pa-4"},{default:e(()=>[t(te,null,{default:e(()=>[t(le,{cols:"12"},{default:e(()=>{var f,I,O,se;return[C("div",Oe,[t(ve,{size:"48",class:"mr-4"},{default:e(()=>{var k,X,re,ne;return[t(pe,{src:(X=(k=l.credit)==null?void 0:k.user)==null?void 0:X.profile_photo,alt:(ne=(re=l.credit)==null?void 0:re.user)==null?void 0:ne.display_name},{placeholder:e(()=>[t(j,null,{default:e(()=>a[4]||(a[4]=[d("mdi-account")])),_:1})]),_:1},8,["src","alt"])]}),_:1}),C("div",null,[C("div",He,T((I=(f=l.credit)==null?void 0:f.user)==null?void 0:I.display_name),1),C("div",Ke,T(((se=(O=l.credit)==null?void 0:O.user)==null?void 0:se.talent)||"No talent specified"),1)])]),t(ge,{class:"mb-6"}),C("div",Xe,[t(ye,{modelValue:v.value,"onUpdate:modelValue":[a[0]||(a[0]=k=>v.value=k),F],items:S.value,"item-title":"name","item-value":"id",label:"Select Category",variant:"outlined",density:"comfortable",class:"mb-4",loading:b.value,disabled:c.value,clearable:""},{prepend:e(()=>[t(j,{color:"primary"},{default:e(()=>a[5]||(a[5]=[d("mdi-shape-outline")])),_:1})]),_:1},8,["modelValue","items","loading","disabled"]),v.value?(A(),K("div",Ye,[t(ae,{variant:"flat",border:"",class:"pa-3 bg-grey-lighten-5"},{default:e(()=>[C("div",Ze,[t(j,{color:"info",class:"mr-2"},{default:e(()=>a[6]||(a[6]=[d("mdi-information-outline")])),_:1}),a[7]||(a[7]=C("span",{class:"text-body-2"},"Choose how you want to specify the role:",-1))]),t(ie,{modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=k=>n.value=k),mandatory:"",color:"primary",rounded:"pill",class:"mb-1"},{default:e(()=>[t(E,{value:"existing",disabled:c.value},{default:e(()=>[t(j,{start:""},{default:e(()=>a[8]||(a[8]=[d("mdi-format-list-bulleted")])),_:1}),a[9]||(a[9]=d(" Select Existing Role "))]),_:1},8,["disabled"]),t(E,{value:"custom",disabled:c.value},{default:e(()=>[t(j,{start:""},{default:e(()=>a[10]||(a[10]=[d("mdi-pencil-plus")])),_:1}),a[11]||(a[11]=d(" Create Custom Role "))]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})])):q("",!0),t(be,{modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=k=>r.value=k),items:n.value==="custom"?[]:x.value,"item-title":"name","return-object":"",label:n.value==="custom"?"Enter custom role name":"Select a role",variant:"outlined",density:"comfortable",loading:w.value,disabled:!v.value||c.value,hint:n.value==="custom"?"Type any role title you need":"Choose from available roles","persistent-hint":"",clearable:"","hide-no-data":n.value==="custom"},de({prepend:e(()=>[t(j,{color:n.value==="custom"?"secondary":"primary"},{default:e(()=>[d(T(n.value==="custom"?"mdi-pencil-plus":"mdi-account-tie"),1)]),_:1},8,["color"])]),selection:e(({item:k})=>[t(_e,{color:z(k.raw)?"secondary":"primary",variant:"flat"},{default:e(()=>[d(T(G(k.raw))+" ",1),z(k.raw)?(A(),H(j,{key:0,size:"small",class:"ml-1"},{default:e(()=>a[12]||(a[12]=[d(" mdi-pencil-outline ")])),_:1})):q("",!0)]),_:2},1032,["color"])]),item:e(({item:k,props:X})=>[t(Ce,ue(X,{title:k.raw.name}),null,16,["title"])]),_:2},[n.value==="custom"?{name:"append",fn:e(()=>[t(j,{color:"secondary"},{default:e(()=>a[13]||(a[13]=[d("mdi-pencil")])),_:1})]),key:"0"}:void 0]),1032,["modelValue","items","label","loading","disabled","hint","hide-no-data"])])]}),_:1})]),_:1})]),_:1})]),actions:e(()=>[t(oe),t(E,{color:"grey-darken-1",variant:"text",onClick:o,disabled:c.value},{default:e(()=>a[14]||(a[14]=[d(" Cancel ")])),_:1},8,["disabled"]),t(E,{color:"primary",onClick:s,loading:c.value,disabled:!g.value},{default:e(()=>a[15]||(a[15]=[d(" Update Role ")])),_:1},8,["loading","disabled"])]),_:1},8,["modelValue","persistent"])}}}),Qe={class:"cast-and-crew"},We=16,et=Y({__name:"AddProjectCredits",props:{project:{}},setup(N){const $=N,i=Z(),p=we(),D=u(!1),R=u(!1),V=u(!1),c=u(!1),b=u(null),w=u(null),v=u(!0),r=u(!1),S=u(!0),x=u(1),n=u(!1),h=L(()=>p.totalMembers);L(()=>p.categoryGroups);const g=async m=>{if(m===1&&n.value)return[];if(r.value&&m>1)return[];try{m>1&&(r.value=!0);const s=await p.fetchCredits($.project.access_uuid,m);return m===1&&(n.value=!0),S.value=p.hasMorePages,x.value=p.page,s.flatMap(o=>o.credits)}catch(s){return console.error("Error fetching credits:",s),i.error("Failed to load members"),[]}finally{m>1&&(r.value=!1),m===1&&(v.value=!1)}};Re(g,{threshold:200,throttle:300,initialLoadDelay:0});const U=()=>{D.value=!0},B=m=>{w.value=m,R.value=!0},M=async m=>{if(D.value=!1,m)p.addCreditToState(m),i.success("Member added successfully");else try{await p.fetchCredits($.project.access_uuid,1),i.success("Member added successfully")}catch{i.error("Failed to refresh member list")}},_=m=>{R.value=!1,w.value=null,p.updateCreditInState(m),i.success("Member role updated successfully")},F=m=>{b.value=m,V.value=!0},z=async()=>{var m,s;if(b.value){c.value=!0;try{if(await p.deleteCredit($.project.access_uuid,b.value.id),V.value=!1,b.value=null,i.success("Member removed successfully"),p.getTotalCredits<We&&p.hasMorePages)try{await p.fetchCredits($.project.access_uuid,p.page+1)}catch(P){console.error("Error loading more items after deletion:",P)}}catch(o){i.error(((s=(m=o==null?void 0:o.response)==null?void 0:m.data)==null?void 0:s.message)||"Failed to remove member")}finally{c.value=!1}}},G=()=>{V.value=!1,b.value=null};return J(async()=>{try{await g(1)}catch(m){console.error("Error during initial load:",m)}}),ce(()=>{p.resetState(),n.value=!1}),(m,s)=>{const o=Ve,P=xe,l=ze,a=Je,y=Ee;return A(),K("div",Qe,[t(Q,{class:"px-0"},{default:e(()=>[t(o,{title:"Cast & Crew",subtitle:`Showcase your project's talent - from lead actors to behind-the-scenes crew. ${h.value} ${h.value===1?"member":"members"} currently on your team.`},{actionable:e(()=>[t(E,{color:"primary","prepend-icon":"mdi-account-plus",onClick:U,disabled:v.value},{default:e(()=>s[3]||(s[3]=[d(" Add Member ")])),_:1},8,["disabled"])]),_:1},8,["subtitle"]),t(P,{"is-loading":v.value,"is-loading-more":r.value,"has-more":S.value,"show-actions":!0,"empty-state-title":"No Cast & Crew Members Yet","empty-state-message":"Start building your project team by adding cast and crew members.","show-empty-state-action":!0,"empty-state-action-text":"Add First Member",onDeleteCredit:F,onEditCredit:B,onEmptyStateAction:U},null,8,["is-loading","is-loading-more","has-more"]),t(l,{modelValue:D.value,"onUpdate:modelValue":s[0]||(s[0]=f=>D.value=f),project:m.project,onCreditAdded:M},null,8,["modelValue","project"]),t(a,{modelValue:R.value,"onUpdate:modelValue":s[1]||(s[1]=f=>R.value=f),credit:w.value,"project-access-uuid":m.project.access_uuid,onCreditUpdated:_},null,8,["modelValue","credit","project-access-uuid"]),t(y,{modelValue:V.value,"onUpdate:modelValue":s[2]||(s[2]=f=>V.value=f),title:"Delete Member",message:"Are you sure you want to remove this member? This action cannot be undone.",loading:c.value,onConfirm:z,onCancel:G},null,8,["modelValue","loading"])]),_:1})])}}}),wt=me(et,[["__scopeId","data-v-352354c3"]]);export{wt as _};
