import{u as y}from"./BCoct7aH.js";import{a as _}from"./DsvAftJq.js";import{V as N}from"./xvVMJZi9.js";import{n as C,c as f,o as k,a as v,bL as x,w as e,p as r,s as d,v as c,V,b as S,G as b,_ as A,f as D,g as l}from"./CGQimWOm.js";import{a as I,b as g,V as $}from"./tTgLLTve.js";const E={class:"text-caption text-grey"},F=C({__name:"NotificationItem",props:{notification:{}},emits:["read","action"],setup(a,{emit:i}){const t=a,o=i,{formatRelativeDate:s}=y(),u=f(()=>s(t.notification.created_at)),p=f(()=>({transfer:"primary",payment:"secondary",deposit:"success",withdrawal:"warning",refund:"error"})[t.notification.data.type]||"grey"),h=f(()=>({transfer:"mdi-bank-transfer",payment:"mdi-credit-card",deposit:"mdi-bank-transfer-in",withdrawal:"mdi-bank-transfer-out",refund:"mdi-cash-refund"})[t.notification.data.type]||"mdi-bell"),m=f(()=>({completed:"success",pending:"warning",failed:"error",reversed:"error"})[t.notification.data.status]||"grey"),w=()=>{t.notification.is_read||o("read",t.notification.id)};return(n,T)=>(k(),v($,{class:b([{unread:!n.notification.is_read},"notification-item"]),onClick:w},x({prepend:e(()=>[r(N,{color:p.value,size:"40"},{default:e(()=>[r(V,null,{default:e(()=>[d(c(h.value),1)]),_:1})]),_:1},8,["color"])]),default:e(()=>[r(I,{class:"text-subtitle-1 mb-1"},{default:e(()=>[d(c(n.notification.data.title),1)]),_:1}),r(g,null,{default:e(()=>[d(c(n.notification.data.message),1)]),_:1}),r(g,{class:"d-flex align-center mt-1"},{default:e(()=>[r(_,{size:"x-small",color:m.value,class:"me-2"},{default:e(()=>[d(c(n.notification.data.status),1)]),_:1},8,["color"]),S("span",E,c(u.value),1)]),_:1})]),_:2},[n.notification.data.order_id?{name:"append",fn:e(()=>[r(_,{size:"small",variant:"outlined",class:"text-caption"},{default:e(()=>[d(c(n.notification.data.order_id),1)]),_:1})]),key:"0"}:void 0]),1032,["class"]))}}),U=A(F,[["__scopeId","data-v-394349ca"]]),G=D("notification",{state:()=>({notifications:[],unreadCount:0,loading:!1,hasNewNotifications:!1,lastFetchTime:0,pagination:{current_page:1,last_page:1,per_page:10,total:0},error:null}),getters:{unreadNotifications(){return this.notifications.filter(a=>!a.is_read)},hasUnread(){return this.unreadCount>0},hasMorePages(){return this.pagination.current_page<this.pagination.last_page}},actions:{async fetchNotifications(a=1){if(a===1&&Date.now()-this.lastFetchTime<3e4)return;const{$axios:i}=l();this.loading=!0,this.error=null;try{const t=await i.get("/api/notifications",{params:{page:a,per_page:10}}),{notifications:o,unread_count:s,pagination:u}=t.data;if(a===1){const p=this.notifications.length>0&&o.some(h=>!this.notifications.find(m=>m.id===h.id));this.hasNewNotifications=p,this.notifications=o}else this.notifications=[...this.notifications,...o];this.unreadCount=s,this.pagination=u,this.lastFetchTime=Date.now()}catch(t){this.error=t instanceof Error?t.message:"Failed to fetch notifications",console.error("Error fetching notifications:",t)}finally{this.loading=!1}},async fetchUnreadCount(){const{$axios:a}=l();try{const i=await a.get("/api/notifications/unread-count");this.unreadCount=i.data.unread_count}catch(i){console.error("Error fetching unread count:",i)}},async markAsRead(a){const{$axios:i}=l();try{const t=await i.post(`/api/notifications/${a}/read`),o=this.notifications.find(s=>s.id===a);o&&(o.is_read=!0,o.read_at=new Date().toISOString()),this.unreadCount=t.data.unread_count}catch(t){console.error("Error marking notification as read:",t)}},async markAllAsRead(){const{$axios:a}=l();try{const i=await a.post("/api/notifications/mark-all-read");this.notifications=this.notifications.map(t=>({...t,is_read:!0,read_at:new Date().toISOString()})),this.unreadCount=i.data.unread_count,this.hasNewNotifications=!1}catch(i){console.error("Error marking all notifications as read:",i)}},async handleAction(a,i,t){const{$axios:o}=l();try{await o.post(`/api/notifications/${a}/action`,{action:i,payload:t}),await this.fetchNotifications(1)}catch(s){console.error("Error handling notification action:",s)}},setHasNewNotifications(a){this.hasNewNotifications=a},clearError(){this.error=null},resetStore(){this.$reset()}}});export{U as _,G as u};
